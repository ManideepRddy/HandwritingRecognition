'use strict';ze.App=function(){this.appStateLog="",this.appState=ze.App.APP_STATE.DEFAULT,this.isInitialized=!1,this.zipFilename=null,this.zipFileSize=null,this.zipEntryTree=null,this.zipBlob=null,this.currentArchiveTypeString="ZIP",this.isInZipEditMode=!1,this.wasZipFileCreatedLocally=!1,this.isSavingToDrive=!1,this.wasSaveToDriveCancelled=!1,this.hasDownloadBeenAutoRetried=!1,this.lastDownloadId=null,this.addFilesToZipOrEncryptZipCancelRequested=!1,this.doResumeOpenFromGoogleDriveAfterManualAuth=!1,this.doResumeExtractToGoogleDriveAfterManualAuth=!1,this.doResumeSavePreviewItemToGoogleDriveAfterManualAuth=!1,this.doResumeSaveZipToDriveAfterManualAuth=!1,this.undoAutoHeightInProgressMap={},this.fileIdToOpen=null,this.parentFolderId=null,this.asyncWorkQueue=new ze.AsyncWorkQueue(ze.App.MAX_WORKQUEUE_WORKERS),this.zipEntryStateMap={},this.zipEntriesInProcessMap={},this.createdZipSavedToDriveId=null,this.totalSessionSize=0,this.currentSessionProgress=0,this.isSessionClosed=!1,this.isSessionAborted=!1,this.sessionHasBeenRetried=!1,this.isProcessingOpenLocalZipFileInputEl=!1,this.isProcessingAddLocalFileInputEl=!1,this.createZipFromFileAssociatedExtension=null,this.previewedEntry=null,this.previewedBlob=null,this.previewType=null,this.sessionPropMap={},this.highestZipEntryIndexUploadedInSession=0,this.codePrettifyScriptLoaded=!1,this.aesCryptoScriptLoaded=!1,this.hasAutoProceededWithDirectNewFlow=!1,this.currentAutodetectedEncoding=null,this.autoRefreshTokenTimer=null},ze.App.NUM_BOTTOM_BANNERS=1,ze.App.NUM_INARTICLE_BANNERS=1,ze.App.AUTO_TOKEN_REFRESH_INTERVAL_MINUTES=29,ze.App.AUTO_TOKEN_REFRESH_INTERVAL_MILLIS=1e3*(60*ze.App.AUTO_TOKEN_REFRESH_INTERVAL_MINUTES),ze.App.TEXTDECODER_ASCII=null,ze.App.TEXTDECODER_UTF8=null;try{"TextDecoder"in window&&(ze.App.TEXTDECODER_ASCII=new TextDecoder("ascii"),ze.App.TEXTDECODER_UTF8=new TextDecoder("utf-8"))}catch(e){logImpression("text_decoder_instantiate_error","app_load",e)}ze.App.CODE_PRETTIFY_SCRIPT_NAME="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js?autorun=false",ze.App.CREATEZIPLIB_SCRIPT_NAME="createziplib-min5.js",ze.App.AESCRYPTO_SCRIPT_NAME="aescrypto-1.js",ze.App.HEIC_SCRIPT_NAME="heiclib2.js",ze.App.JSCHARDETLIB_SCRIPT_NAME="jschardet2-1-1.min.js",ze.App.CREATEZIPLIB_WINDOW_OBJECT_CHECK="zeCreateZipLib",ze.App.AESCRYPTOLIB_WINDOW_OBJECT_CHECK="aesCrypto",ze.App.JSCHARDETLIB_WINDOW_OBJECT_CHECK="jschardet",ze.App.DEFAULT_PAGE_TITLE="ZIP Extractor - Free App for Opening ZIP Files",ze.App.SUPPORTED_ARCHIVE_EXTENSIONS=["zip","zipx","tar","rar","7z","gz","gzip","tgz","lzma","tlz","bz","bz2","bzip","bzip2","tbz","tbz2","jar","war","ear","epub","apk"],ze.App.DOCUMENT_REFERENCES=["startPagePrompt","startPageIconImg","startPageIconImgDrive","startPageIconImgGmail","startPageIconImgGeneral","startPageDriveDetails","startPageGmailDetails","startPageGeneralDetails","checkingAuthSpinnerContainer","authButtonContainer","generalButtonContainer","authButtonDetails","profileImageDiv","profileImageImg","profileName","openLocalZipFileInputEl","addLocalFileInputEl","topBanner","startCard","appContent","mainWrapper","centeredBodyContent","mainApp","fileTableHeader","fileTableHeaderLabel","fileTableHeaderSize","fileTableContainer","mainLabel","secondaryLabel","secondaryLabelContainer","mainProgressBarContainer","mainProgressBar","selectAllCheckbox","rootStatus","rootStatusIcon","rootStatusIconContainer","rootStatusSpinner","addFilesFromComputerButton","addFilesFromGoogleDriveButton","addFilesButtonContainer","downloadZipButton","saveZipToDriveButton","openZipInDriveButton","editZipButton","fixEncodingButton","doneEditingZipButton","closeButton","openZipFromDriveButton","openZipFromComputerButton","createNewZipButton","viewFilesButton","authButton","retryButton","cancelButton","extractButton","checkPasswordButton","fileTableItems","preview","previewGenericContent","previewGen","previewImageContent","previewImg","previewAudioContent","previewAud","previewTextContent","previewTxt","previewVideoContent","previewVid","previewPdfContent","previewPdf","previewDriveContent","previewCloseButton","previewDownloadButton","previewOpenInDriveButton","previewSaveToDriveButton","previewCancelButton","previewNextButton","previewPrevButton","downloadAnchorEl","previewItemFilename","previewZipFilenameAndStatus","previewSpinner","previewItemIcon","previewItemIconImg","noPreviewIcon","previewItemSize","previewProgressBarContainer","previewProgressBar","previewErrorContent","previewErrorCaption","previewErrorDetails","zipTable","mainScrollableContent","mainAppHeader","buttonContainer","openButtonsContainer","mainIcon","mainSpinner","zipPasswordInputContainer","zipPasswordInput","zipFilenameInputContainer","zipFilenameInput","fileTableSubHeader","secondaryLabelLink","previewDriveSaveToDriveFirst","previewSaveToDriveDetails","secondaryLabelLinkCombo","mainAppHeaderContent","footer","textBlockHowToUse","mainAppSubTitle","addPasswordButton","setPasswordButton","encryptionPrompt","encryptionPromptCheckbox","showZipPasswordButton","hideZipPasswordButton"],ze.App.SESS_PROP={},ze.App.SESS_PROP.DIDAUTHORIZE="didAuthorize",ze.App.SESS_PROP.DIDPREVIEW="didPreview",ze.App.SESS_PROP.DIDDOWNLOADZIP="didDownloadZip",ze.App.SESS_PROP.DIDZIPDOWNLOAD="didZipDownloadSuccessfully",ze.App.SESS_PROP.DIDPICKEXTRACTLOCATION="didPickExtractLocation",ze.App.SESS_PROP.DIDPICKLOCALZIP="didPickLocalZip",ze.App.SESS_PROP.DIDDRAGDROPZIP="didDragDropZip",ze.App.SESS_PROP.DIDPICKDRIVEZIP="didPickDriveZip",ze.App.SESS_PROP.DIDDOWNLOADSUBITEM="didDownloadSubItem",ze.App.SESS_PROP.DIDOPENZIP="didOpenZip",ze.App.SESS_PROP.DIDZIPOPEN="didZipOpen",ze.App.SESS_PROP.DIDZIPRENDER="didZipRender",ze.App.SESS_PROP.DIDEXTRACTZIP="didExtractZip",ze.App.SESS_PROP.DIDZIPEXTRACT="didZipExtract",ze.App.SESS_PROP.DIDVIEWFILES="didViewFiles",ze.App.SESS_PROP.DIDCANCELDOWNLOAD="didCancelDownload",ze.App.SESS_PROP.DIDCANCELEXTRACTION="didCancelExtraction",ze.App.SESS_PROP.DIDRETRYDOWNLOAD="didRetryDownload",ze.App.SESS_PROP.DIDRETRYEXTRACTION="didRetryExtraction",ze.App.SESS_PROP.DIDCREATEZIP="didCreateZip",ze.App.SESS_PROP.DIDADDLOCALFILESTOZIP="didAddLocalFilesToZip",ze.App.APP_STATE={DEFAULT:"default",INIT:"init",UNSUPPORTED_BROWSER:"unsupportedBrowser",NEW_SESSION:"newSession",PENDING_ZIP_LIBRARY_LOAD:"pendingZipLibraryLoad",APP_CREATE:"appCreate",APP_CREATED:"appCreated",APP_INIT:"appInit",ENCRYPTING_ZIP:"encryptingZip",ADD_PASSWORD_TO_ZIP:"addPasswordToZip",PASSWORD_REQUIRED:"passwordRequired",PASSWORD_INCORRECT:"passwordIncorrect",PASSWORD_VERIFIED:"passwordVerified",PASSWORD_FORMAT_NOT_SUPPORTED:"passwordFormatNotSupported",AUTH_PENDING_AUTO:"authPendingAuto",AUTH_PENDING_USER:"authPendingUser",AUTH_REQUIRED:"authRequired",AUTH_ERROR:"authError",AUTH_MISMATCH:"authMisMatch",DOWNLOADING:"downloading",DOWNLOADING_METADATA:"downloadingMetadata",CANCEL_DOWNLOAD_REQUESTED:"cancelDownloadRequested",DOWNLOAD_CANCELED:"downloadCanceled",DOWNLOAD_ALL_BYTES_TRANSFERRED:"downloadAllBytesTransferred",DOWNLOAD_FIRST_BYTE_TRANSFERRED:"downloadFirstByteTransferred",DOWNLOADED:"downloaded",DOWNLOAD_ERROR:"downloadError",ZIP_READING:"zipReading",ZIP_READ_ERROR:"zipReadError",MODEL_BUILDING:"modelBuilding",MODEL_BUILT:"modelBuilt",EXTRACTING:"extracting",EXTRACTION_COMPLETE:"extractionComplete",API_LOADED:"apiLoaded",READY_TO_EXTRACT:"readyToExtract",SESSION_CANCELED:"sessionCanceled",EXTRACTION_CANCEL_REQUESTED:"extractionCancelRequested",EXTRACTION_CANCELED:"extractionCanceled",RENDER_ZIP_UI:"renderZipUi",COMPLETE_WITH_ERRORS:"completeWithErrors",RARDECODE_LIBRARY_LOADING:"rardecodeLibraryLoading",BZIP_LIBRARY_LOADING:"bzipdecodeLibraryLoading",CREATEZIP_LIBRARY_LOADING:"createzipLibraryLoading",AESCRYPTO_LIBRARY_LOADING:"aescryptoLibraryLoading",JSCHARDET_LIBRARY_LOADING:"jschardetLibraryLoading",EDIT_ZIP:"editZip",ADDING_FILES_TO_ZIP:"addingFilesToZip",FILES_ADDED_TO_ZIP:"filesAddedToZip",ZIP_CREATION_ERROR:"zipCreationError",ZIP_CREATION_CANCELLED:"zipCreationCancelled",ZIP_ENCRYPTION_ERROR:"zipEncryptionError",ZIP_ENCRYPTION_CANCELLED:"zipEncryptionCancelled"},ze.App.ESTATE={ADDED_TO_ZIP:"addedToZip",CREATED_ZIP_SAVED_TO_DRIVE:"createdZipSavedToDrive",DEFAULT:"default",QUEUED:"queued",QUEUED_PENDING_RETRY:"queuedPendingRetry",REQUEUED_AFTER_ERROR:"requeuedAfterError",SKIPPED:"skipped",PENDING:"pending",WAITING:"waiting",CANCELED:"canceled",BEGIN_DECOMPRESSION:"beginDecompression",DECOMPRESSION_PROGRESS:"decompressionProgress",DECOMPRESSION_COMPLETE:"decompressionComplete",DECOMPRESSION_ERROR:"decompressionError",BEGIN_UPLOAD:"beginUpload",UPLOAD_PROGRESS:"uploadProgress",UPLOAD_ERROR:"uploadError",UPLOAD_ALL_BYTES_TRANSFERRED:"uploadAllBytesTransferred",UPLOAD_COMPLETE:"uploadComplete",UPLOAD_ABORTED:"uploadAborted"},ze.App.SESSION_ITEM_STATE_TYPE={UPLOAD_ERROR:"uploadError",DECOMPRESSION_ERROR:"decompressionError",CANCELED:"canceled",AUTH_ERROR:"authError"},ze.App.MAIN_ICON_TYPE={SECURITY:"security",LOCKED:"locked",UNLOCKED:"unlocked",INFO:"info",WARNING:"warning",ERROR:"error",SPINNER:"spinner",CANCEL:"cancel",SUCCESS:"success"},ze.App.NAME="ZIP Extractor",ze.App.EXTRACTED_FOLDER_SUFFIX="(Unzipped Files)",ze.App.FILE_EXTENSION_REGEX="/\\.[^/.]+$/",ze.App.DRIVE_URL="https://drive.google.com/drive/",ze.App.FOLDER_SUFFIX="folders/",ze.App.DEFAULT_ZIP_FILENAME="Untitled.zip",ze.App.MAX_WORKQUEUE_WORKERS=4,ze.App.TRANSFER_DECOMPRESS_MULTIPLIER=1,ze.App.ENTRY_OVERHEAD_BYTES=1e5,ze.App.createDriveFolderLink=function(e){var t="u/"+CURRENT_AUTH_USER+"/";return ze.App.DRIVE_URL+t+(e?ze.App.FOLDER_SUFFIX+e:"")},ze.App.getFolderName=function(e){return ze.App.trimFileExtension(e)+" "+ze.App.EXTRACTED_FOLDER_SUFFIX},ze.App.endsWith=function(e,t){return-1!==e.indexOf(t,e.length-t.length)},ze.App.startsWith=function(e,t){return 0==e.indexOf(t,0)},ze.App.stringContains=function(e,t){return-1!=e.indexOf(t,0)},ze.App.trimFileExtension=function(e){return e.replace(ze.App.FILE_EXTENSION_REGEX,"")},ze.App.getFileExtension=function(e){if(null==e)return null;var t=e.trim().split(".");return 1==t.length?"":t.pop().toLowerCase().trim()},ze.App.trimLastFileExtension=function(e){var t=e.split(".");return 1==t.length?e:(t.pop(),t.join("."))},ze.App.execLater=function(e,t,r){window.setTimeout(function(){e(),t&&t()},r||0)},ze.App.prototype.initAfterHtmlReady=function(e){if(!this.isInitialized){this.isInitialized=!0,this.fileIdToOpen=e,this.addDocumentReferences(),this.addEventListeners(),logImpression("app_initialized","app_load",ze.VERSION),this.startSessionAfterInit();try{var t=this.isAdBlockerEnabled();logImpression("adblocker_enabled","app_load",t)}catch(e){logImpression("adblocker_enabled","app_load","error: "+e)}try{}catch(e){logImpression("undoAutoHeight_initwrapper","app_load","error: "+e)}}},ze.App.prototype.undoAutoHeight=function(e){if(!("MutationObserver"in window))return void logImpression("undoAutoHeight()","app_load","MutationObserver is not in the window");var t=e?e.id:"null";try{var r=e;r.style.height="",r.style.minHeight="",r.style.maxHeight="";var i=this,p=new MutationObserver(function(){!0==i.undoAutoHeightInProgressMap[r.id]||(i.undoAutoHeightInProgressMap[r.id]=!0,logImpression("undo_auto_height_activate","undo_auto_height","elem: "+t),r.style.height="",r.style.minHeight="",r.style.maxHeight="",i.undoAutoHeightInProgressMap[r.id]=!1)});p.observe(r,{attributes:!0,attributeFilter:["style"]})}catch(e){logImpression("undoAutoHeight()","app_load","elemId: "+t+"; error: "+e)}},ze.App.prototype.startSessionAfterInit=function(){isAuthorized()&&(this.updateUserInfoUi(),this.maybeEnableAutoRefreshTokenTimer()),this.fileIdToOpen?isAuthorized()?this.maybeDownloadAfterAuth():isFirstAuthPending()||this.updateStartPageButtons():(this.updateStartPageButtons(),isFirstAuthPending()?this.maybeProceedWithDirectNewFlow():(this.startNewManualSession(),this.maybeProceedWithDirectNewFlow()))},ze.App.prototype.handleCancelAddPasswordToZip=function(){this.zipPasswordInput.value="",this.hideAddPasswordPrompt(!0)},ze.App.prototype.hideAddPasswordPrompt=function(e){var t=e?"Creating new ZIP file":"Password set. Ready to add files to ZIP";this.updateLabelsAndProgress(t,""),e?this.setMainIcon(ze.App.MAIN_ICON_TYPE.INFO):this.setMainIcon(ze.App.MAIN_ICON_TYPE.LOCKED),this.showEl(this.zipPasswordInputContainer,!1),this.hideZipPasswordChars(),this.showEl(this.encryptionPrompt,!1),this.showEl(this.addFilesButtonContainer,!0),this.maybeShowAddPasswordButton(),this.showEl(this.doneEditingZipButton,!0),this.showEl(this.setPasswordButton,!1),this.showEl(this.downloadZipButton,!0),this.showEl(this.saveZipToDriveButton,!0),this.showEl(this.cancelButton,!1),this.showEl(this.closeButton,!1)},ze.App.prototype.handleAddPasswordToZip=function(){this.setAppState(ze.App.APP_STATE.ADD_PASSWORD_TO_ZIP)},ze.App.prototype.encryptZip=function(e){e?ze.App.prototype.ensureLibLoadedAndCallback(ze.App.AESCRYPTOLIB_WINDOW_OBJECT_CHECK,ze.App.AESCRYPTO_SCRIPT_NAME,ze.App.APP_STATE.AESCRYPTO_LIBRARY_LOADING,bindFn(this.doEncryptZip,this,e)):this.doEncryptZip(e)},ze.App.prototype.ensureLibLoadedAndCallback=function(e,t,r,i){this;null==window[e]?(this.setAppState(r),this.loadScriptAsync(t,i)):i()},ze.App.prototype.doEncryptZip=function(e){var t=e?ze.ZipLib.ENCRYPTION_MODE_WINZIPAES:ze.ZipLib.ENCRYPTION_MODE_PKZIPSTANDARD;return this.zipEntryTree.isEncrypted=!0,this.zipEntryTree.encryptionMode=t,this.hideAddPasswordPrompt(!1),this.zipEntryTree.originalEntries&&0==this.zipEntryTree.originalEntries.length?void this.maybeShowZipFileCommentOrEncryptedState():void(this.setAppState(ze.App.APP_STATE.ENCRYPTING_ZIP),this.addFilesToZipOrEncryptZipCancelRequested=!1,logImpression("do_encrypt_zip","encrypt_zip",this.createZipFromFileAssociatedExtension+" ("+t+")"),zeCreateZipLib.serializeZipFromEntries(this.zipEntryTree.originalEntries,this.zipBlob,[],bindFn(this.renderCreatedZip,this,!1,null,null,!0),bindFn(this.handleZipEncryptError,this),bindFn(this.checkAndHandleCreateOrEncryptZipFileCancelled,this,bindFn(this.handleZipEncryptError,this)),bindFn(this.handleZipCreateOrEncryptProgress,this),bindFn(this.updateLabelsAndProgress,this),this.zipEntryTree.zipFileComment,t,this.getZipPasswordCharCodeByteArray()))},ze.App.prototype.maybeProceedWithDirectNewFlow=function(){this.hasAutoProceededWithDirectNewFlow||isForDirectNewFlow()&&(this.hasAutoProceededWithDirectNewFlow=!0,logImpression("create_new_zip_direct_new","create_new_zip"),this.doCreateNewZip())},ze.App.prototype.checkStateUserAndLoggedInUserMatch=function(){var e=getLoggedInUserId();if(null==e)return!1;var t=getStateUserId();return!(null!=t)||!("{userId}"!=t)||t==e},ze.App.prototype.isAdBlockerEnabled=function(){var e=document.createElement("ins");e.className="AdSense",e.style.display="block",e.style.position="absolute",e.style.top="-1px",e.style.height="1px",document.body.appendChild(e);var t=!e.clientHeight;return document.body.removeChild(e),t},ze.App.prototype.handleStateUserIdMismatchError=function(){logImpression("auth_account_mismatch","auth","authUser: "+CURRENT_AUTH_USER),this.setAppState(ze.App.APP_STATE.AUTH_MISMATCH)},ze.App.prototype.handleFirstAuthError=function(){this.fileIdToOpen&&this.updateStartPageButtons()},ze.App.prototype.handleFirstAuthSuccess=function(){this.handleAppPostAuthorizationTasks(),this.maybeEnableAutoRefreshTokenTimer()},ze.App.prototype.handleAppPostAuthorizationTasks=function(){this.updateUserInfoUi(),this.fileIdToOpen?this.maybeDownloadAfterAuth():this.updateStartPageButtons()},ze.App.prototype.maybeDownloadAfterAuth=function(){this.downloadInProgress(this.fileIdToOpen)||(this.checkStateUserAndLoggedInUserMatch()?this.downloadFileById(this.fileIdToOpen):this.handleStateUserIdMismatchError())},ze.App.prototype.configureStartPageForNewManualSession=function(){this.authButtonDetails.textContent="",this.showEl(this.startPageIconImgGeneral,!0),this.showEl(this.startPageIconImgGmail,!1),this.showEl(this.startPageIconImgDrive,!1),this.showEl(this.generalButtonContainer,!0),this.showEl(this.authButtonContainer,!1),this.showEl(this.authButton,!1),this.showEl(this.authButtonDetails,!1),this.showEl(this.checkingAuthSpinnerContainer,!1),this.showEl(this.startPageGeneralDetails,!0),this.showEl(this.startPageGmailDetails,!1),this.showEl(this.startPageDriveDetails,!1),this.showEl(this.startPagePrompt,!0)},ze.App.prototype.updateStartPageButtons=function(){var e=null==this.fileIdToOpen?"general":getReferringSource();null!=this.fileIdToOpen&&"gmail"!=e&&(e="drive");var t="drive"==e,r="gmail"==e,i=!(t||r);this.showEl(this.authButtonContainer,!i),this.showEl(this.authButton,!i),this.showEl(this.authButtonDetails,!i),this.showEl(this.checkingAuthSpinnerContainer,!1),this.showEl(this.generalButtonContainer,i),this.showEl(this.startPageGeneralDetails,i),this.showEl(this.startPageGmailDetails,r),this.showEl(this.startPageDriveDetails,t)},ze.App.prototype.initiateManualAuth=function(){this.setAppState(ze.App.APP_STATE.AUTH_PENDING_USER),authorize(!1,bindFn(this.handleManualAuthSuccess,this),bindFn(this.handleManualAuthError,this),getStateUserId(),void 0,!1,"initiateManualAuth")},ze.App.prototype.handleManualAuthSuccess=function(){this.doResumeOpenFromGoogleDriveAfterManualAuth?(this.doResumeOpenFromGoogleDriveAfterManualAuth=!1,this.updateUserInfoUi(),this.setAuthText(""),this.showPicker(bindFn(this.handlePickerFileSelected,this))):this.doResumeExtractToGoogleDriveAfterManualAuth?(this.doResumeExtractToGoogleDriveAfterManualAuth=!1,this.enableEl(this.extractButton,!0),this.updateLabelsForReadyToExtract(),this.updateUserInfoUi(),this.setAuthText(""),this.doExtract(!1)):this.doResumeSavePreviewItemToGoogleDriveAfterManualAuth?(this.doResumeSavePreviewItemToGoogleDriveAfterManualAuth=!1,this.updateUserInfoUi(),this.setAuthText(""),this.handlePreviewSaveToDriveButtonClick()):this.doResumeSaveZipToDriveAfterManualAuth?(this.doResumeSaveZipToDriveAfterManualAuth=!1,this.updateUserInfoUi(),this.setAuthText(""),this.saveZipToDrive()):(this.setAuthText("Signed in as "+getUserEmail()),this.handleAppPostAuthorizationTasks())},ze.App.prototype.handleManualAuthError=function(e,t){this.setAppState(ze.App.APP_STATE.AUTH_ERROR,e,t)},ze.App.prototype.handleZipLibraryDelayedLoad=function(){this.appState==ze.App.APP_STATE.PENDING_ZIP_LIBRARY_LOAD&&this.startNewManualSession()},ze.App.prototype.updateUserInfoUi=function(){this.sessionPropMap[ze.App.SESS_PROP.DIDAUTHORIZE]=!0;var e=ze.App.htmlEscape(getUserEmail()),t=ze.App.htmlEscape(getUserFullName()),r=ze.App.htmlEscape(getUserGivenName());this.profileImageImg.src=getUserPicture()+"?size=72",this.profileName.textContent=r,this.showEl(this.profileImageDiv,!0),this.showEl(this.profileName,!0),this.profileImageImg.title="Switch Google Account",this.profileName.title=t+" ("+e+")"},ze.App.htmlEscape=function(e){return(e+"").replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},ze.App.prototype.setAppState=function(e,t,r,i){this.appState=e,this.appStateLog+=" "+e,this.updateViewFromAppState(t,r,i)},ze.App.prototype.downloadInProgress=function(e){return this.lastDownloadId==e&&(this.appState==ze.App.APP_STATE.DOWNLOADING_METADATA||this.appState==ze.App.APP_STATE.DOWNLOADING||this.appState==ze.App.APP_STATE.DOWNLOAD_ALL_BYTES_TRANSFERRED||this.appState==ze.App.APP_STATE.DOWNLOAD_FIRST_BYTE_TRANSFERRED||this.appState==ze.App.APP_STATE.DOWNLOAD_CANCELED||this.appState==ze.App.APP_STATE.CANCEL_DOWNLOAD_REQUESTED||this.appState==ze.App.APP_STATE.CANCEL_DOWNLOAD_ERROR)},ze.App.prototype.downloadFileById=function(e){logImpression("download_file_metadata","download","start. is_authorized="+isAuthorized()),this.sessionPropMap[ze.App.SESS_PROP.DIDDOWNLOADZIP]=!0,this.hideWelcomeText(),this.showEl(this.zipTable,!0),this.showEl(this.mainScrollableContent,!1),this.lastDownloadId=e,this.setAppState(ze.App.APP_STATE.DOWNLOADING_METADATA);var t=this,r=ze.Dapi.generateCallbacks(function(e){e.mimeType==ze.Dapi.MimeType.FOLDER?t.handleOpenWithOnFolder(e):t.downloadFile(e)},bindFn(this.onDownloadError,this),void 0,bindFn(this.onDownloadAborted,this));ze.Dapi.get(e,r)},ze.App.prototype.handleOpenWithOnFolder=function(e){logImpression("open_with_on_folder","misc"),this.closeSession();var t="Open ZIP from \""+e.name+"\"";this.showPicker(bindFn(this.handlePickerFileSelected,this),!1,e.id,t)},ze.App.prototype.downloadFile=function(e){logImpression("download_file_blob","download","start");var t=e.size?parseInt(e.size,10):-1;this.setAppState(ze.App.APP_STATE.DOWNLOADING,e.name,t);var r=ze.Dapi.generateCallbacks(bindFn(this.onDownloadSuccess,this,e),bindFn(this.onDownloadError,this),bindFn(this.onDownloadProgress,this,t),bindFn(this.onDownloadAborted,this));ze.Dapi.downloadFileBytes(e.id,r)},ze.App.prototype.onDownloadSuccess=function(e,t){logImpression("download_file_blob","download","success"),this.sessionPropMap[ze.App.SESS_PROP.DIDZIPDOWNLOAD]=!0,this.setAppState(ze.App.APP_STATE.DOWNLOADED),this.parentFolderId=ze.App.getParentIdOfDownloadedFile(e);var r=e.name.trim();this.isSupportedArchiveType(r)?this.readArchive(r,e.size,t):this.createNewZipFromFile(r,t,e.id)},ze.App.prototype.isSupportedArchiveType=function(e){var t=ze.App.getFileExtension(e.toLowerCase());return!(""!=t)||-1!=ze.App.SUPPORTED_ARCHIVE_EXTENSIONS.indexOf(t)},ze.App.getParentIdOfDownloadedFile=function(e){var t=e.parents;return t&&0<t.length?t[0]:null},ze.App.prototype.onDownloadError=function(e,t){var r="isAuthorized? "+isAuthorized()+" - isTokenExpired? "+isTokenExpired()+"; error: "+e,i="";i=this.appState==ze.App.APP_STATE.DOWNLOADING?"download_file_init_error":this.appState==ze.App.APP_STATE.DOWNLOAD_FIRST_BYTE_TRANSFERRED?"download_file_blob_error":this.appState==ze.App.APP_STATE.DOWNLOADING_METADATA?"download_file_metadata_error":"download_file_other_error",logImpression(i,"download",r);var p=this;this.hasDownloadBeenAutoRetried?this.setAppState(ze.App.APP_STATE.DOWNLOAD_ERROR,t):(this.hasDownloadBeenAutoRetried=!0,e==ze.Dapi.ErrType.AUTH_ERROR?(this.setAppState(ze.App.APP_STATE.AUTH_PENDING_AUTO),authorize(!0,bindFn(this.downloadFileById,this,this.lastDownloadId),function(){p.setAppState(ze.App.APP_STATE.DOWNLOAD_ERROR,"(Auth auto retry failed): "+t)},void 0,CURRENT_AUTH_USER,!1,"onDownloadError")):this.downloadFileById(this.lastDownloadId))},ze.App.prototype.onDownloadProgress=function(e,t,r){if(this.appState!=ze.App.APP_STATE.DOWNLOAD_CANCELED&&-1!=e){var i=Math.round(3+97*(t/r));this.updateLabelsAndProgress(null,"Opening ("+i.toString()+"%)",i),t===e?this.setAppState(ze.App.APP_STATE.DOWNLOAD_ALL_BYTES_TRANSFERRED):this.appState==ze.App.APP_STATE.DOWNLOADING&&0<t&&this.setAppState(ze.App.APP_STATE.DOWNLOAD_FIRST_BYTE_TRANSFERRED)}},ze.App.prototype.onDownloadAborted=function(){this.handleDownloadCanceled()},ze.App.prototype.handleDownloadCanceled=function(){this.setAppState(ze.App.APP_STATE.DOWNLOAD_CANCELED)},ze.App.prototype.maybeEnableAutoRefreshTokenTimer=function(){return console.log("maybeEnableAutoRefreshTokenTimer"),null==this.autoRefreshTokenTimer?void(console.log("maybeEnableAutoRefreshTokenTimer not yet set, setting"),this.autoRefreshTokenTimer=setTimeout(bindFn(this.doAutoRefreshToken,this),ze.App.AUTO_TOKEN_REFRESH_INTERVAL_MILLIS)):void console.log("maybeEnableAutoRefreshTokenTimer already set")},ze.App.prototype.doAutoRefreshToken=function(){console.log("IN doAutoRefreshToken isAuthorized: "+isAuthorized()+"; isTokenExpired: "+isTokenExpired()),logImpression("start","auto_refresh_token","isAuthorized: "+isAuthorized()+"; isTokenExpired: "+isTokenExpired()),clearTimeout(this.autoRefreshTokenTimer);var e=this;authorize(!0,function(){console.log("refresh token success."),console.log(CLAIM.exp),console.log(CLAIM),logImpression("success","auto_refresh_token","isAuthorized: "+isAuthorized()+"; isTokenExpired: "+isTokenExpired()),e.autoRefreshTokenTimer=setTimeout(bindFn(e.doAutoRefreshToken,e),ze.App.AUTO_TOKEN_REFRESH_INTERVAL_MILLIS)},function(e){logImpression("error","auto_refresh_token","err: "+e+"; isAuthorized: "+isAuthorized()+"; isTokenExpired: "+isTokenExpired())},void 0,CURRENT_AUTH_USER,!1,"autoRefreshToken")},ze.App.prototype.readArchive=function(e,t,r,i){this.hideWelcomeText();var p=ze.App.getFileExtension(e)||"";p=p.toLowerCase(),"tar"==p?(logImpression("read_tar","tar","start"),this.sessionPropMap[ze.App.SESS_PROP.DIDOPENZIP]=!0,this.currentArchiveTypeString="TAR",ze.App.updatePageTitle(e),this.setAppState(ze.App.APP_STATE.ZIP_READING),this.zipFilename=e,this.zipFileSize=t,this.doReadTar(!1,r)):"7z"==p?(logImpression("read_7z","7z","start"),this.sessionPropMap[ze.App.SESS_PROP.DIDOPENZIP]=!0,this.currentArchiveTypeString="7-Zip",ze.App.updatePageTitle(e),this.setAppState(ze.App.APP_STATE.ZIP_READING),this.zipFilename=e,this.zipFileSize=t,ze.BzipLib.isBzipLzmaSevenZDecoderLibLoaded()?this.doReadSevenZ(r):ze.BzipLib.loadBzipLzmaSevenZDecoderLib(bindFn(this.doReadSevenZ,this,r),void 0,!1,!0)):"lzma"==p||"tlz"==p?(logImpression("read_lzma","lzma","start"),this.sessionPropMap[ze.App.SESS_PROP.DIDOPENZIP]=!0,this.currentArchiveTypeString="LZMA",ze.App.updatePageTitle(e),this.setAppState(ze.App.APP_STATE.ZIP_READING),this.zipFilename=e,this.zipFileSize=t,ze.BzipLib.isBzipLzmaSevenZDecoderLibLoaded()?this.doReadLzma(r,e):ze.BzipLib.loadBzipLzmaSevenZDecoderLib(bindFn(this.doReadLzma,this,r,e),void 0,!0,!1)):"gz"==p||"gzip"==p||"tgz"==p?(logImpression("read_gzip","gzip","start"),this.sessionPropMap[ze.App.SESS_PROP.DIDOPENZIP]=!0,this.currentArchiveTypeString="GZIP",ze.App.updatePageTitle(e),this.setAppState(ze.App.APP_STATE.ZIP_READING),this.zipFilename=e,this.zipFileSize=t,this.doReadGzip(r,e)):"bz"==p||"bz2"==p||"bzip"==p||"bzip2"==p||"tbz"==p||"tbz2"==p?(logImpression("read_bzip","bzip","start"),this.sessionPropMap[ze.App.SESS_PROP.DIDOPENZIP]=!0,this.currentArchiveTypeString="BZIP",ze.App.updatePageTitle(e),this.setAppState(ze.App.APP_STATE.ZIP_READING),this.zipFilename=e,this.zipFileSize=t,ze.BzipLib.isBzipLzmaSevenZDecoderLibLoaded()?this.doReadBzip(r,e):ze.BzipLib.loadBzipLzmaSevenZDecoderLib(bindFn(this.doReadBzip,this,r,e))):"rar"==p?(logImpression("read_rar","rar","start"),this.sessionPropMap[ze.App.SESS_PROP.DIDOPENZIP]=!0,this.currentArchiveTypeString="RAR",ze.App.updatePageTitle(e),this.setAppState(ze.App.APP_STATE.ZIP_READING),this.zipFilename=e,this.zipFileSize=t,this.doReadRar(r)):(logImpression("read_zip","zip","start. this.zipEntryTree: "+this.zipEntryTree),this.sessionPropMap[ze.App.SESS_PROP.DIDOPENZIP]=!0,this.currentArchiveTypeString="ZIP",ze.App.updatePageTitle(e),this.setAppState(ze.App.APP_STATE.ZIP_READING),this.zipFilename=e,this.zipFileSize=t,this.doReadZip(r,this.currentAutodetectedEncoding,i))},ze.App.prototype.doReadZip=function(e,t,r){var i=this;ze.ZipLib.readHeaderMetadataFromEocdr(e,e.size,function(p){p.encoding=t,ze.ZipLib.readEntriesFromCentralDirectory(p,e,bindFn(i.zipReadSuccess,i,e,p.zipFileComment,r),bindFn(i.zipReadError,i,r))},bindFn(this.zipReadError,this,r))},ze.App.prototype.zipReadSuccess=function(e,t,r,i){logImpression("read_zip","zip","success"),this.sessionPropMap[ze.App.SESS_PROP.DIDZIPOPEN]=!0,this.buildEntryTree(i,bindFn(this.entryTreeBuildComplete,this,e,r),t)},ze.App.prototype.zipReadError=function(e,t){logImpression("read_zip","zip","error: "+t),this.setAppState(ze.App.APP_STATE.ZIP_READ_ERROR,t),e&&e(!1)},ze.App.prototype.doReadSevenZ=function(e,t){ze.SevenZLibCore.verifySevenZFile(e,bindFn(ze.SevenZLibCore.getSevenZEntries,this,e,bindFn(this.sevenZReadSuccess,this,e),bindFn(this.sevenZReadError,this),bindFn(this.handleGeneralArchiveReadProgress,this),t),bindFn(this.sevenZReadError,this))},ze.App.prototype.sevenZReadSuccess=function(e,t){logImpression("read_7z","7z","success"),this.sessionPropMap[ze.App.SESS_PROP.DIDZIPOPEN]=!0,this.buildEntryTree(t,bindFn(this.entryTreeBuildComplete,this,e))},ze.App.prototype.sevenZReadError=function(e){logImpression("read_7z","7z","error: "+e),this.setAppState(ze.App.APP_STATE.ZIP_READ_ERROR,e)},ze.App.prototype.doReadTar=function(e,t){e&&this.updateLabelsAndProgress("Reading embedded TAR file..."),ze.TarLib.verifyTarFile(t,bindFn(ze.TarLib.getTarEntries,this,t,bindFn(this.tarReadSuccess,this,t),bindFn(this.tarReadError,this),bindFn(this.handleGeneralArchiveReadProgress,this)),bindFn(this.tarReadError,this))},ze.App.prototype.tarReadSuccess=function(e,t){logImpression("read_tar","tar","success"),this.sessionPropMap[ze.App.SESS_PROP.DIDZIPOPEN]=!0,this.buildEntryTree(t,bindFn(this.entryTreeBuildComplete,this,e))},ze.App.prototype.tarReadError=function(e){logImpression("read_tar","tar","error: "+e),this.setAppState(ze.App.APP_STATE.ZIP_READ_ERROR,e)},ze.App.prototype.handleGeneralArchiveReadProgress=function(e,t,r){var i=Math.round(3+97*(e/t));this.setProgressBarPercent(i),r&&this.updateLabelsAndProgress(null,"Reading ("+i.toString()+"%)",i)},ze.App.prototype.doReadBzip=function(e,t){ze.BzipLib.verifyBzipFile(e,bindFn(ze.BzipLib.getBzipEntry,this,t,bindFn(this.bzipReadSuccess,this,e,bindFn(this.bzipReadError,this)),bindFn(this.bzipReadError,this)),bindFn(this.bzipReadError,this))},ze.App.prototype.bzipReadSuccess=function(e,t,r){logImpression("read_bzip","bzip","success"),this.sessionPropMap[ze.App.SESS_PROP.DIDZIPOPEN]=!0;var i=r.filename;i&&ze.App.endsWith(i.toLowerCase(),".tar")?ze.ZipLib.decompressEntry(e,r,!0,bindFn(this.doReadTar,this,!0),t,bindFn(this.handleGeneralArchiveReadProgress,this)):this.buildEntryTree([r],bindFn(this.entryTreeBuildComplete,this,e))},ze.App.prototype.bzipReadError=function(e){logImpression("read_bzip","bzip","error: "+e),this.setAppState(ze.App.APP_STATE.ZIP_READ_ERROR,e)},ze.App.prototype.doReadGzip=function(e,t){ze.GzipLib.verifyGzipFile(e,bindFn(ze.GzipLib.getGzipEntry,this,e,t,bindFn(this.gzipReadSuccess,this,e,bindFn(this.gzipReadError,this)),bindFn(this.gzipReadError,this)),bindFn(this.gzipReadError,this))},ze.App.prototype.gzipReadSuccess=function(e,t,r,i){logImpression("read_gzip","gzip","success"),this.sessionPropMap[ze.App.SESS_PROP.DIDZIPOPEN]=!0,i&&ze.App.endsWith(i,".tar")?ze.ZipLib.decompressEntry(e,r,!0,bindFn(this.doReadTar,this,!0),t,bindFn(this.handleGeneralArchiveReadProgress,this)):this.buildEntryTree([r],bindFn(this.entryTreeBuildComplete,this,e))},ze.App.prototype.gzipReadError=function(e){logImpression("read_gzip","gzip","error: "+e),this.setAppState(ze.App.APP_STATE.ZIP_READ_ERROR,e)},ze.App.prototype.doReadLzma=function(e,t){ze.LzmaLib.verifyLzmaFile(e,bindFn(ze.LzmaLib.getLzmaEntry,this,e,t,bindFn(this.lzmaReadSuccess,this,e,bindFn(this.lzmaReadError,this)),bindFn(this.lzmaReadError,this)),bindFn(this.lzmaReadError,this))},ze.App.prototype.lzmaReadSuccess=function(e,t,r){logImpression("read_lzma","lzma","success"),this.sessionPropMap[ze.App.SESS_PROP.DIDZIPOPEN]=!0,this.buildEntryTree([r],bindFn(this.entryTreeBuildComplete,this,e))},ze.App.prototype.lzmaReadError=function(e){logImpression("read_lzma","lzma","error: "+e),this.setAppState(ze.App.APP_STATE.ZIP_READ_ERROR,e)},ze.App.prototype.doReadRar=function(e){ze.RarLib.verifyRarFile(e,bindFn(ze.RarLib.getRarEntries,this,e,bindFn(this.rarReadSuccess,this,e),bindFn(this.rarReadError,this),bindFn(this.handleGeneralArchiveReadProgress,this)),bindFn(this.rarReadError,this))},ze.App.prototype.rarReadSuccess=function(e,t){logImpression("read_rar","rar","success"),this.sessionPropMap[ze.App.SESS_PROP.DIDZIPOPEN]=!0,this.buildEntryTree(t,bindFn(this.entryTreeBuildComplete,this,e))},ze.App.prototype.rarReadError=function(e){logImpression("read_rar","rar","error: "+e),this.setAppState(ze.App.APP_STATE.ZIP_READ_ERROR,e)},ze.App.prototype.entryTreeBuildComplete=function(e,t){this.zipBlob=e,this.renderZipTableUi(bindFn(this.zipUiRenderComplete,this,t))},ze.App.prototype.zipUiRenderComplete=function(e){if(null==this.zipEntryTree)return void(e&&e(!1));if(this.maybeShowZipFileCommentOrEncryptedState(),this.isInZipEditMode){var t=this.zipEntryTree&&this.zipEntryTree.originalEntries&&0<this.zipEntryTree.originalEntries.length;this.configureUiForZipEditMode(t)}else this.zipEntryTree.isEncrypted?this.configurePasswordPrompt():this.setReadyToExtract();var r=this.zipEntryTree&&this.zipEntryTree.filenameHasExtendedChar,i=r&&null==this.currentAutodetectedEncoding;this.showEl(this.fixEncodingButton,i),i&&this.enableEl(this.fixEncodingButton,!0),this.preloadOptionalLibraries(),e&&e(!0)},ze.App.prototype.setReadyToExtract=function(e,t){this.setAppState(ze.App.APP_STATE.READY_TO_EXTRACT,e,t),this.sessionPropMap[ze.App.SESS_PROP.DIDZIPRENDER]=!0,logImpression("ready_to_extract",this.currentArchiveTypeString.toLowerCase(),"correctPassword: "+!!e)},ze.App.prototype.preloadOptionalLibraries=function(){"RAR"==this.currentArchiveTypeString?!ze.RarLib.isRarDecoderLibLoaded()&&ze.RarLib.loadRarDecoderLib(void 0,!0):"BZIP"==this.currentArchiveTypeString?!ze.BzipLib.isBzipLzmaSevenZDecoderLibLoaded()&&ze.BzipLib.loadBzipLzmaSevenZDecoderLib(void 0,!0):"LZMA"==this.currentArchiveTypeString?!ze.BzipLib.isBzipLzmaSevenZDecoderLibLoaded()&&ze.BzipLib.loadBzipLzmaSevenZDecoderLib(void 0,!0,!0):"7-Zip"==this.currentArchiveTypeString&&!ze.BzipLib.isBzipLzmaSevenZDecoderLibLoaded()&&ze.BzipLib.loadBzipLzmaSevenZDecoderLib(void 0,!0,!1,!0),this.codePrettifyScriptLoaded||(this.codePrettifyScriptLoaded=!0,this.loadScriptAsync(ze.App.CODE_PRETTIFY_SCRIPT_NAME)),this.zipEntryTree&&this.zipEntryTree.isEncrypted&&this.zipEntryTree.encryptionMode==ze.ZipLib.ENCRYPTION_MODE_WINZIPAES&&!this.aesCryptoScriptLoaded&&(this.aesCryptoScriptLoaded=!0,this.loadScriptAsync(ze.App.AESCRYPTO_SCRIPT_NAME))},ze.App.prototype.maybeShowZipFileCommentOrEncryptedState=function(){var e=this.zipEntryTree.zipFileComment&&!ze.App.startsWith(this.zipEntryTree.zipFileComment,"Created by ZIP Extractor")?"<b>ZIP Comment:</b> "+ze.App.htmlEscape(this.zipEntryTree.zipFileComment):"";if(this.zipEntryTree.empty){var t="(This "+this.currentArchiveTypeString+" file does not contain any files)";e=e?e+"<br>"+t:t}if(this.zipEntryTree.isEncrypted&&this.wasZipFileCreatedLocally){var r="(This "+this.currentArchiveTypeString+" file is encrypted with a password";r+=this.zipEntryTree.encryptionMode==ze.ZipLib.ENCRYPTION_MODE_WINZIPAES?" using strong encryption)":")",e=e?e+"<br>"+r:r}e?(this.fileTableSubHeader.innerHTML=e,this.showEl(this.fileTableSubHeader,!0)):(this.fileTableSubHeader.textContent="",this.showEl(this.fileTableSubHeader,!1))},ze.App.prototype.checkPassword=function(){var e=this.zipEntryTree.passwordCheckEntry;return e?void(logImpression("check_password","pwd_flow","begin_decompress"),ze.ZipLib.decompressEntry(this.zipBlob,e,!0,bindFn(this.checkPasswordSuccess,this,e),bindFn(this.checkPasswordError,this,e),bindFn(this.handleGeneralArchiveReadProgress,this),this.getZipPasswordCharCodeByteArray())):void this.checkPasswordError(null,"no check entry available")},ze.App.prototype.checkPasswordSuccess=function(){logImpression("check_password","pwd_flow","success"),this.setAppState(ze.App.APP_STATE.PASSWORD_VERIFIED)},ze.App.prototype.checkPasswordError=function(e,t){logImpression("check_password","pwd_flow","error: "+t),this.setAppState(ze.App.APP_STATE.PASSWORD_INCORRECT)},ze.App.prototype.doExtract=function(e){return"RAR"!=this.currentArchiveTypeString||ze.RarLib.isRarDecoderLibLoaded()?"LZMA"!=this.currentArchiveTypeString&&"BZIP"!=this.currentArchiveTypeString&&"7-Zip"!=this.currentArchiveTypeString||ze.BzipLib.isBzipLzmaSevenZDecoderLibLoaded()?void(logImpression("extract_"+this.currentArchiveTypeString.toLowerCase(),this.currentArchiveTypeString.toLowerCase(),"is_for_auto_retry="+e),this.sessionPropMap[ze.App.SESS_PROP.DIDEXTRACTZIP]=!0,this.setAppState(ze.App.APP_STATE.EXTRACTING),this.executeSession(e)):void ze.BzipLib.loadBzipLzmaSevenZDecoderLib(bindFn(this.doExtract,this,e),!1,"LZMA"==this.currentArchiveTypeString,"7-Zip"==this.currentArchiveTypeString):void ze.RarLib.loadRarDecoderLib(bindFn(this.doExtract,this,e))},ze.App.prototype.handleExtractionComplete=function(e){var t=this.currentArchiveTypeString.toLowerCase();if(logImpression(t+"_extracted",t),this.zipEntryTree&&this.zipEntryTree.isEncrypted&&logImpression("encrypted_"+t+"_extraction_complete","crypto"),e)return void this.setAppState(ze.App.APP_STATE.EXTRACTION_CANCELED);var r=this.getNumFilesWithUploadErrors(),i=0<r;if(i&&!this.sessionHasBeenRetried){this.parentFolderId=null,this.queueEntry(this.zipEntryTree),this.queueEntryChildren(this.zipEntryTree);var p=this;this.doExtract(!0)}else{var o=i?ze.App.APP_STATE.COMPLETE_WITH_ERRORS:ze.App.APP_STATE.EXTRACTION_COMPLETE;this.setAppState(o)}},ze.App.prototype.getNewParentId=function(){return this.zipEntryTree?this.zipEntryTree.driveFileId:null},ze.App.prototype.buildEntryTree=function(e,t,r){this.setAppState(ze.App.APP_STATE.MODEL_BUILDING),this.buildEntryTreeInternal(e,r),t()},ze.App.prototype.buildEntryTreeInternal=function(e,t){if(this.zipEntryTree)throw new Error("Existing ZIP Entry Tree must be cleared before being built (log: "+this.appStateLog+")");var r=ze.App.getFolderName(this.zipFilename);this.zipEntryTree={directory:!0,root:!0,name:r,path:r,children:{},state:ze.App.APP_STATE.DEFAULT,passwordCheckEntry:null,originalEntries:e},t&&(this.zipEntryTree.zipFileComment=t),null==e?(logImpression("error_null_entries",this.currentArchiveTypeString.toLowerCase()),e=[],this.zipEntryTree.empty=!0):0==e.length&&(this.zipEntryTree.empty=!0);for(var p=Number.MAX_SAFE_INTEGER,o=0,n;o<e.length;o++)n=e[o],n.isEncrypted&&(this.zipEntryTree.isEncrypted=!0,this.zipEntryTree.encryptionMode=n.encryptionMode),n.isZip64&&(this.zipEntryTree.isZip64=!0),n.filenameHasExtendedChar&&(this.zipEntryTree.filenameHasExtendedChar=!0),!n.directory&&0<n.compressedSize&&n.compressedSize<p&&(p=n.compressedSize,this.zipEntryTree.passwordCheckEntry=n),this.insertZipEntry(this.zipEntryTree,n)},ze.App.prototype.insertZipEntry=function(e,t){var r=t.filename||"";t.error&&(r+=" (ERROR: "+ze.App.htmlEscape(t.error).replace("/","--")+")"),ze.App.endsWith(r,"/")&&(r=r.substring(0,r.length-1));for(var p=r.split("/"),o=e,n=null,a=0,s;a<p.length;a++){s=p[a],n=null===n?s:n+"/"+s;var E=o.children[s];E||(a<p.length-1||t.directory?(E={},E.directory=!0,E.children={},t.zipTreeEntry=E):E=t,E.state=ze.App.ESTATE.DEFAULT,E.path=n,E.name=s,E.parentEntry=o,o.children[s]=E),o=E}},ze.App.prototype.addDocumentReferences=function(){for(var e=0;e<ze.App.DOCUMENT_REFERENCES.length;e++)this[ze.App.DOCUMENT_REFERENCES[e]]=document.getElementById(ze.App.DOCUMENT_REFERENCES[e])},ze.App.prototype.addEventListeners=function(){this.addButtonListeners(),this.openLocalZipFileInputEl.onchange=bindFn(this.handleOpenLocalZipFileInputElChange,this),this.addLocalFileInputEl.onchange=bindFn(this.handleAddLocalFileInputElChange,this),this.selectAllCheckbox.onclick=bindFn(this.handleSelectAllCheckboxClick,this),this.encryptionPromptCheckbox.onclick=bindFn(this.handleEncryptionPromptCheckboxClick,this),this.previewCloseButton.onclick=bindFn(this.handlePreviewCloseButtonClick,this),this.previewDownloadButton.onclick=bindFn(this.handlePreviewDownloadButtonClick,this),this.previewOpenInDriveButton.onclick=bindFn(this.handlePreviewOpenInDriveButtonClick,this),this.previewSaveToDriveButton.onclick=bindFn(this.handlePreviewSaveToDriveButtonClick,this),this.previewPrevButton.onclick=bindFn(this.handlePreviewPrevButtonClick,this),this.previewNextButton.onclick=bindFn(this.handlePreviewNextButtonClick,this),this.secondaryLabelLink.onclick=bindFn(this.handleSecondaryLabelLinkClick,this),this.profileImageImg.onclick=bindFn(this.handleProfileImageImgClick,this),document.addEventListener("keydown",bindFn(this.handleBodyKeydown,this)),this.zipPasswordInput.addEventListener("keydown",bindFn(this.handleZipPasswordKeyDown,this)),this.zipFilenameInput.addEventListener("keydown",bindFn(this.handleZipFilenameKeyDown,this)),this.zipPasswordInput.addEventListener("input",bindFn(this.handleZipFilenameInputChange,this)),window.addEventListener("beforeunload",bindFn(this.handleBeforeUnload,this)),this.zipFilenameInput.addEventListener("focus",function(){this.select()}),this.zipFilenameInput.addEventListener("blur",bindFn(this.handleZipFilenameInputBlur,this))},ze.App.prototype.handleProfileImageImgClick=function(){this.switchAccount()},ze.App.prototype.isGapiLibraryLoaded=function(){return"gapi"in window},ze.App.prototype.switchAccount=function(){if(logImpression("switch_account","auth","start. currentAuthUser="+CURRENT_AUTH_USER),!(this.isGapiLibraryLoaded()&&gapi.auth2))return void logImpression("switch_account","auth","error: gapi_auth2_not_loaded");var e=this;this.setAuthText("Choose the Google account you would like to use with ZIP Extractor."),authorize(!1,function(){logImpression("switch_account","auth","success. currentAuthUser="+CURRENT_AUTH_USER),e.setAuthText("Signed in as "+getUserEmail()),e.updateUserInfoUi()},function(t){e.setAuthText(""),logImpression("switch_account","auth","error: "+t)},void 0,void 0,!0,"switchAccount")},ze.App.prototype.handleBeforeUnload=function(t){if(this.sendFinalSessionState(),!this.areAllStatesTerminal()||this.isSavingToDrive){return t.returnValue="ZIP Extraction is still in process. Are you sure you want to leave?","ZIP Extraction is still in process. Are you sure you want to leave?"}},ze.App.prototype.sendFinalSessionState=function(){for(var e in logImpression("final_state_recorded","session_state2",!0,void 0,void 0,!0),logImpression(this.appStateLog,"app_state_log",void 0,void 0,void 0,!0),logImpression("recorded","final_app_state",!0,void 0,void 0,!0),logImpression(this.appState,"final_app_state",void 0,void 0,void 0,!0),ze.App.SESS_PROP)if(ze.App.SESS_PROP.hasOwnProperty(e)){var t=this.sessionPropMap[ze.App.SESS_PROP[e]];null!=t&&logImpression(ze.App.SESS_PROP[e],"session_state2",t,void 0,void 0,!0)}},ze.App.prototype.handleZipFilenameInputBlur=function(){this.zipFilenameInput.value=""==this.zipFilenameInput.value?ze.App.DEFAULT_ZIP_FILENAME:this.zipFilenameInput.value.trim(),ze.App.endsWith(this.zipFilenameInput.value.toLowerCase(),".zip")||(this.zipFilenameInput.value+=".zip"),this.zipFilename=this.zipFilenameInput.value,this.fileTableHeaderLabel.textContent=this.zipFilenameInput.value;var e=ze.App.getFolderName(this.zipFilename);this.zipEntryTree.name=e,this.zipEntryTree.path=e,ze.App.updatePageTitle(this.zipFilename)},ze.App.prototype.handleZipPasswordKeyDown=function(t){if("Escape"===t.key||"Esc"===t.key)return""==this.zipPasswordInput.value?void 0:(t.stopPropagation(),t.preventDefault(),this.zipPasswordInput.value="",this.zipPasswordInput.focus(),!1);return"Enter"===t.key?(t.stopPropagation(),t.preventDefault(),this.isElementShown(this.zipPasswordInputContainer)&&(this.isElementShown(this.setPasswordButton)&&this.isElementEnabled(this.setPasswordButton)?this.setPasswordButton.click():this.isElementShown(this.checkPasswordButton)&&this.isElementEnabled(this.checkPasswordButton)&&this.checkPasswordButton.click()),!1):void 0},ze.App.prototype.handleZipFilenameInputChange=function(){this.isElementShown(this.zipPasswordInputContainer)&&(this.isElementShown(this.setPasswordButton)?this.enableEl(this.setPasswordButton,0<this.zipPasswordInput.value.length):this.isElementShown(this.checkPasswordButton)&&this.enableEl(this.checkPasswordButton,0<this.zipPasswordInput.value.length))},ze.App.prototype.handleZipFilenameKeyDown=function(t){return"Escape"===t.key||"Esc"===t.key?(t.stopPropagation(),t.preventDefault(),""==this.zipFilenameInput.value?(this.zipFilenameInput.value=this.zipFilename||"",this.zipFilenameInput.blur(),!1):(this.zipFilenameInput.value="",!1)):"Enter"===t.key?(t.stopPropagation(),t.preventDefault(),this.zipFilenameInput.blur(),!1):void 0},ze.App.prototype.handleBodyKeydown=function(t){"Escape"===t.key||"Esc"===t.key?this.isPreviewShown()?(t.preventDefault(),this.isElementShown(this.previewCancelButton)&&this.isElementEnabled(this.previewCancelButton)?this.handleCancelPreview():this.closePreview()):this.appState==ze.App.APP_STATE.ADDING_FILES_TO_ZIP?(t.preventDefault(),this.addFilesToZipOrEncryptZipCancelRequested=!0,this.enableEl(this.cancelButton,!1)):this.isElementShown(this.zipPasswordInputContainer)&&this.isElementShown(this.setPasswordButton)?this.handleCancelAddPasswordToZip():this.isInZipEditMode?(t.preventDefault(),this.closeZipEditMode(),this.zipEntryTree&&this.zipEntryTree.originalEntries&&0==this.zipEntryTree.originalEntries.length&&this.canCloseSession()&&(t.preventDefault(),this.closeSession(),this.mainScrollableContent.scrollTop=0)):this.canCancel()?(t.preventDefault(),this.handleButtonClick("cancelButton")):this.canCloseSession()&&(logImpression("close","user_button"),t.preventDefault(),this.closeSession(),this.mainScrollableContent.scrollTop=0):"ArrowUp"===t.key||"Up"===t.key||"ArrowLeft"===t.key||"Left"===t.key?this.isPreviewShown()&&(t.preventDefault(),this.isElementShown(this.previewPrevButton)&&this.isElementEnabled(this.previewPrevButton)&&this.handlePreviewPrevButtonClick()):"ArrowDown"===t.key||"Down"===t.key||"ArrowRight"===t.key||"Right"===t.key?this.isPreviewShown()&&(t.preventDefault(),this.isElementShown(this.previewNextButton)&&this.isElementEnabled(this.previewNextButton)&&this.handlePreviewNextButtonClick()):"Enter"===t.key&&(this.isPreviewShown()&&this.isElementShown(this.previewDownloadButton)&&this.isElementEnabled(this.previewDownloadButton)&&!this.isElementShown(this.previewErrorContent)?(t.preventDefault(),this.handlePreviewDownloadButtonClick()):this.canRetry())},ze.App.prototype.addButtonListeners=function(){for(var e=0,t;e<ze.App.DOCUMENT_REFERENCES.length;e++)t=ze.App.DOCUMENT_REFERENCES[e],t&&ze.App.endsWith(t,"Button")&&(this[t].onclick=bindFn(this.handleButtonClick,this,t))},ze.App.prototype.showEl=function(e,t){e.style.display=t?"":"none"},ze.App.prototype.enableEl=function(e,t){e.disabled=!t},ze.App.prototype.isElementShown=function(e){return"none"!=e.style.display},ze.App.prototype.isElementEnabled=function(e){return!e.disabled},ze.App.prototype.handleButtonClick=function(e){switch(e){case"checkPasswordButton":if(0==this.zipPasswordInput.value.length)return this.zipPasswordInput.select(),void this.zipPasswordInput.focus();logImpression("check_password","pwd_flow"),this.updateLabelsAndProgress("Checking password..."),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER),this.checkPassword();break;case"authButton":logImpression("manual_authorize_button","user_button"),this.initiateManualAuth();break;case"addFilesFromComputerButton":logImpression("add_files_from_computer","user_button"),this.addLocalFileInputEl.click();break;case"addFilesFromGoogleDriveButton":break;case"downloadZipButton":var t=this.zipEntryTree?this.zipEntryTree.encryptionMode:"null zipEntryTree";logImpression("download_zip","create_zip","encryptionMode: "+t),this.downloadBlobToBrowser(this.zipFilename,new Blob([this.zipBlob],{type:"application/zip"}));break;case"saveZipToDriveButton":this.saveZipToDrive();break;case"openZipInDriveButton":null!=this.createdZipSavedToDriveId&&ze.App.openItemInDrive(this.createdZipSavedToDriveId);break;case"editZipButton":this.configureUiForZipEditMode();break;case"doneEditingZipButton":this.closeZipEditMode();break;case"fixEncodingButton":this.fixEncoding();break;case"extractButton":!isAuthorized()||isTokenExpired()?(this.setAppState(ze.App.APP_STATE.AUTH_PENDING_USER),this.doResumeOpenFromGoogleDriveAfterManualAuth=!1,this.doResumeSavePreviewItemToGoogleDriveAfterManualAuth=!1,this.doResumeExtractToGoogleDriveAfterManualAuth=!0,this.doResumeSaveZipToDriveAfterManualAuth=!1,this.initiateManualAuth()):(this.sessionHasBeenRetried=!1,this.doExtract(!1));break;case"viewFilesButton":logImpression("view_files","user_button"),this.sessionPropMap[ze.App.SESS_PROP.DIDVIEWFILES]=!0;var r=ze.App.createDriveFolderLink(this.getNewParentId()),i=window.open(r,"_blank");i&&i.focus&&i.focus();break;case"previewCancelButton":this.handleCancelPreview();break;case"cancelButton":this.appState==ze.App.APP_STATE.EXTRACTING?(logImpression("cancel_extraction","user_button"),this.sessionPropMap[ze.App.SESS_PROP.DIDCANCELEXTRACTION]=!0,this.setAppState(ze.App.APP_STATE.EXTRACTION_CANCEL_REQUESTED),this.abortSession()):this.appState==ze.App.APP_STATE.DOWNLOADING||this.appState==ze.App.APP_STATE.DOWNLOAD_FIRST_BYTE_TRANSFERRED||this.appState==ze.App.APP_STATE.DOWNLOAD_ALL_BYTES_TRANSFERRED||this.appState==ze.App.APP_STATE.DOWNLOADING_METADATA?(logImpression("cancel_download","user_button","app_state: "+this.appState),this.sessionPropMap[ze.App.SESS_PROP.DIDCANCELDOWNLOAD]=!0,this.setAppState(ze.App.APP_STATE.CANCEL_DOWNLOAD_REQUESTED),ze.Dapi.abortDownload()):this.appState==ze.App.APP_STATE.ADDING_FILES_TO_ZIP?(this.addFilesToZipOrEncryptZipCancelRequested=!0,this.enableEl(this.cancelButton,!1)):this.isSavingToDrive&&(this.enableEl(this.cancelButton,!1),this.wasSaveToDriveCancelled=!0,ze.Dapi.abortAllRequests());break;case"closeButton":logImpression("close","user_button"),this.isElementShown(this.zipPasswordInputContainer)&&this.isElementShown(this.setPasswordButton)?this.handleCancelAddPasswordToZip():(this.closeSession(),this.mainScrollableContent.scrollTop=0);break;case"retryButton":this.appState==ze.App.APP_STATE.COMPLETE_WITH_ERRORS?(logImpression("retry_errors","user_button"),this.sessionPropMap[ze.App.SESS_PROP.DIDRETRYEXTRACTION]=!0,this.sessionHasBeenRetried=!1,this.doExtract(!1)):this.appState==ze.App.APP_STATE.EXTRACTION_CANCELED?(logImpression("retry_after_extraction_canceled","user_button"),this.sessionPropMap[ze.App.SESS_PROP.DIDRETRYEXTRACTION]=!0,this.sessionHasBeenRetried=!1,this.doExtract(!1)):(this.appState==ze.App.APP_STATE.DOWNLOAD_ERROR||this.appState==ze.App.APP_STATE.DOWNLOAD_CANCELED)&&(logImpression("retry_download","user_button"),this.sessionPropMap[ze.App.SESS_PROP.DIDRETRYDOWNLOAD]=!0,this.hasDownloadBeenAutoRetried=!1,this.downloadFileById(this.lastDownloadId));break;case"openZipFromDriveButton":logImpression("open_zip_from_drive","user_button","is_authorized="+isAuthorized()),!isAuthorized()||isTokenExpired()?(this.doResumeSavePreviewItemToGoogleDriveAfterManualAuth=!1,this.doResumeOpenFromGoogleDriveAfterManualAuth=!0,this.doResumeExtractToGoogleDriveAfterManualAuth=!1,this.doResumeSaveZipToDriveAfterManualAuth=!1,this.initiateManualAuth()):this.showPicker(bindFn(this.handlePickerFileSelected,this));break;case"openZipFromComputerButton":logImpression("open_zip_from_computer","user_button","is_authorized="+isAuthorized()),this.openLocalZipFileInputEl.click();break;case"createNewZipButton":logImpression("create_new_zip","user_button","is_authorized="+isAuthorized()),logImpression("create_new_zip_button_press","create_new_zip"),this.doCreateNewZip();break;case"addPasswordButton":var p=this.zipEntryTree&&this.zipEntryTree.originalEntries?this.zipEntryTree.originalEntries.length:-1;logImpression("add_password_button","encrypt_zip","entryCount: "+p),this.handleAddPasswordToZip();break;case"setPasswordButton":this.hideZipPasswordChars();var o=ze.App.isCheckboxIconButtonChecked(this.encryptionPromptCheckbox);logImpression("set_password_button","encrypt_zip","useAes: "+o),this.encryptZip(o);break;case"showZipPasswordButton":this.showZipPasswordChars();break;case"hideZipPasswordButton":this.hideZipPasswordChars();break;default:}},ze.App.prototype.showZipPasswordChars=function(){this.zipPasswordInput.type="text",this.showEl(this.hideZipPasswordButton,!0),this.showEl(this.showZipPasswordButton,!1)},ze.App.prototype.hideZipPasswordChars=function(){this.zipPasswordInput.type="password",this.showEl(this.hideZipPasswordButton,!1),this.showEl(this.showZipPasswordButton,!0)},ze.App.prototype.doCreateNewZip=function(){this.isInZipEditMode=!0,this.createNewEmptyZip()},ze.App.prototype.canCancel=function(){return this.isElementShown(this.cancelButton)&&this.isElementEnabled(this.cancelButton)},ze.App.prototype.canRetry=function(){return this.isElementShown(this.retryButton)&&this.isElementEnabled(this.retryButton)},ze.App.prototype.canCloseSession=function(){return this.isElementShown(this.closeButton)},ze.App.prototype.configureUiForZipEditMode=function(e){this.isInZipEditMode=!0,this.setAppState(ze.App.APP_STATE.EDIT_ZIP,e)},ze.App.prototype.closeZipEditMode=function(){this.isInZipEditMode=!1,this.setAppState(ze.App.APP_STATE.READY_TO_EXTRACT,void 0,this.wasZipFileCreatedLocally)},ze.App.prototype.handleCancelPreview=function(){logImpression("preview_cancel","user_button"),this.enableEl(this.previewCancelButton,!1),this.wasSaveToDriveCancelled=!0,ze.Dapi.abortAllRequests()},ze.App.prototype.updateViewFromAppState=function(e,t,r){if(this.isInitialized)switch(this.appState){case ze.App.APP_STATE.API_LOADED:break;case ze.App.APP_STATE.ADD_PASSWORD_TO_ZIP:var i="phone"==detectDevice()?"Add password":"Add password to ZIP file";this.updateLabelsAndProgress(i,""),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SECURITY),this.showEl(this.secondaryLabelLinkCombo,!1),this.showEl(this.zipPasswordInputContainer,!0),this.showEl(this.setPasswordButton,!0),this.hideZipPasswordChars(),this.enableEl(this.setPasswordButton,!1),this.showEl(this.encryptionPrompt,!0),this.showEl(this.addFilesButtonContainer,!1),this.showEl(this.addPasswordButton,!1),this.showEl(this.downloadZipButton,!1),this.showEl(this.saveZipToDriveButton,!1),this.showEl(this.openZipInDriveButton,!1),this.showEl(this.editZipButton,!1),this.showEl(this.doneEditingZipButton,!1),this.showEl(this.cancelButton,!1),this.showEl(this.closeButton,!0);break;case ze.App.APP_STATE.ENCRYPTING_ZIP:var i="phone"==detectDevice()?"Encrypting ZIP file...":"Encrypting ZIP file with Password...";this.updateLabelsAndProgress(i,""),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER),this.showEl(this.addPasswordButton,!1),this.showEl(this.setPasswordButton,!1),this.showEl(this.addFilesButtonContainer,!1),this.showEl(this.saveZipToDriveButton,!1),this.showEl(this.downloadZipButton,!1),this.showEl(this.doneEditingZipButton,!1),this.showEl(this.zipPasswordInputContainer,!1),this.showEl(this.encryptionPrompt,!1),this.showEl(this.secondaryLabelLinkCombo,!0),this.showEl(this.cancelButton,!0);break;case ze.App.APP_STATE.ADDING_FILES_TO_ZIP:this.updateLabelsAndProgress("Adding files to ZIP...","Preparing files..."),this.setProgressBarPercent(0),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER),this.showEl(this.addFilesButtonContainer,!1),this.showEl(this.addPasswordButton,!1),this.showEl(this.secondaryLabelLinkCombo,!0),this.showEl(this.downloadZipButton,!1),this.showEl(this.saveZipToDriveButton,!1),this.showEl(this.cancelButton,!0),this.enableEl(this.cancelButton,!0),this.showEl(this.doneEditingZipButton,!1),this.showEl(this.openZipInDriveButton,!1);break;case ze.App.APP_STATE.FILES_ADDED_TO_ZIP:var p=r?"Password set":"Files added to ZIP";this.updateLabelsAndProgress(p,"",100),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SUCCESS),this.showEl(this.secondaryLabelLinkCombo,!1),this.showEl(this.addFilesButtonContainer,!0),this.showEl(this.cancelButton,!1),this.enableEl(this.cancelButton,!0);var o=e,n=t;this.zipEntryTree=null,ze.App.clearTable(this.fileTableItems),this.readArchive(this.zipFilename,o.size,o,n);break;case ze.App.APP_STATE.ZIP_CREATION_ERROR:this.updateLabelsAndProgress("Error when adding files to ZIP",e,100),this.setMainIcon(ze.App.MAIN_ICON_TYPE.ERROR),this.maybeShowAddPasswordButton(),this.showEl(this.secondaryLabelLinkCombo,!0),this.showEl(this.cancelButton,!1),this.enableEl(this.cancelButton,!0),this.showEl(this.saveZipToDriveButton,!0),this.showEl(this.downloadZipButton,!0);break;case ze.App.APP_STATE.ZIP_CREATION_CANCELLED:this.updateLabelsAndProgress("Adding files to ZIP was canceled","",100),this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING),this.showEl(this.secondaryLabelLinkCombo,!1),this.showEl(this.addFilesButtonContainer,!0),this.maybeShowAddPasswordButton(),this.enableEl(this.cancelButton,!0),this.showEl(this.cancelButton,!1),this.showEl(this.saveZipToDriveButton,!0),this.showEl(this.downloadZipButton,!0);break;case ze.App.APP_STATE.ZIP_ENCRYPTION_ERROR:this.updateLabelsAndProgress("Error when adding password to ZIP",e,100),this.setMainIcon(ze.App.MAIN_ICON_TYPE.ERROR);break;case ze.App.APP_STATE.ZIP_ENCRYPTION_CANCELLED:this.updateLabelsAndProgress("Adding password to ZIP was canceled","",100);break;case ze.App.APP_STATE.EDIT_ZIP:var a="";if(!!e)a="Files added to ZIP",this.zipEntryTree&&this.zipEntryTree.isEncrypted;else{var s=this.zipEntryTree&&this.zipEntryTree.originalEntries,E=s?this.zipEntryTree.originalEntries.length:0;a=0==E?"Creating new ZIP file":"Ready to add files to ZIP"}this.updateLabelsAndProgress(a,"",100),this.setMainIcon(ze.App.MAIN_ICON_TYPE.INFO);var d=null!=this.createdZipSavedToDriveId;this.showEl(this.saveZipToDriveButton,!d),this.showEl(this.openZipInDriveButton,d),this.showEl(this.secondaryLabelLinkCombo,!1),this.showEl(this.closeButton,!0),this.showEl(this.addFilesButtonContainer,!0),this.maybeShowAddPasswordButton(),this.showEl(this.downloadZipButton,!0),this.showEl(this.extractButton,!1),this.showEl(this.editZipButton,!1),this.showEl(this.doneEditingZipButton,!0),this.showEl(this.closeButton,!1),this.showEl(this.cancelButton,!1),this.showEl(this.zipFilenameInputContainer,!0),this.showEl(this.fileTableHeaderLabel,!1),""==this.zipFilenameInput.value&&(this.zipFilename=this.zipFilenameInput.value,this.zipFilenameInput.focus());break;case ze.App.APP_STATE.PASSWORD_REQUIRED:var i="This "+this.currentArchiveTypeString+" file requires a password";"phone"==detectDevice()||(i+=" to open"),this.updateLabelsAndProgress(i,""),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SECURITY),this.showEl(this.closeButton,!0),this.showEl(this.secondaryLabelLinkCombo,!1),this.showEl(this.zipPasswordInputContainer,!0),this.hideZipPasswordChars(),this.showEl(this.checkPasswordButton,!0),this.enableEl(this.checkPasswordButton,!1),this.showEl(this.addFilesButtonContainer,!1),this.showEl(this.addPasswordButton,!1),this.showEl(this.downloadZipButton,!1),this.showEl(this.saveZipToDriveButton,!1),this.showEl(this.editZipButton,!1);break;case ze.App.APP_STATE.PASSWORD_FORMAT_NOT_SUPPORTED:this.updateLabelsAndProgress("Unsupported ZIP password format","ZIP Extractor can't open this password-protected ZIP format yet. Extraction cannot proceed"),this.showEl(this.closeButton,!0),this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING);break;case ze.App.APP_STATE.PASSWORD_INCORRECT:this.updateLabelsAndProgress("Incorrect password. Please try again",void 0,100),this.showEl(this.closeButton,!0),this.zipPasswordInput.select(),this.zipPasswordInput.focus(),this.flashElement(this.zipPasswordInput,"#d00000",2,100),this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING);break;case ze.App.APP_STATE.PASSWORD_VERIFIED:this.showEl(this.zipPasswordInputContainer,!1),this.hideZipPasswordChars(),this.showEl(this.checkPasswordButton,!1),this.showEl(this.secondaryLabelLinkCombo,!0),this.setReadyToExtract(!0),this.refreshZipEntryTreeItemState(void 0,!0);break;case ze.App.APP_STATE.AUTH_PENDING_AUTO:break;case ze.App.APP_STATE.AUTH_PENDING_USER:this.setAuthText("Authorization is pending your approval. Click \"Allow\" in the popup window to use ZIP Extractor.");break;case ze.App.APP_STATE.AUTH_MISMATCH:this.setAuthText("The account you authorized ("+getUserEmail()+") does not match the account you used to open the file. Please try again.");break;case ze.App.APP_STATE.AUTH_ERROR:var l="";"popup_closed_by_user"==e?l="You closed the popup window before completing authorization. Please try again.":("idpiframe_initialization_failed"==e?l="There was a problem showing the authorization screen; please try again.":"popup_blocked_by_browser"==e?l="Your web browser blocked the Google authorization popup window. Please enable popups.":"access_denied"==e?(l="You chose not grant access to ZIP Extractor. You may try again with the button above.",t=""):l="General authorization error; please try again.",t&&(l+=" (Details: "+t+")")),this.setAuthText(l),this.doResumeOpenFromGoogleDriveAfterManualAuth?this.doResumeOpenFromGoogleDriveAfterManualAuth=!1:this.doResumeExtractToGoogleDriveAfterManualAuth?(this.doResumeExtractToGoogleDriveAfterManualAuth=!1,this.enableEl(this.extractButton,!0)):this.doResumeSavePreviewItemToGoogleDriveAfterManualAuth?(this.doResumeSavePreviewItemToGoogleDriveAfterManualAuth=!1,this.enableEl(this.previewSaveToDriveButton,!0)):this.doResumeSaveZipToDriveAfterManualAuth?(this.doResumeSaveZipToDriveAfterManualAuth=!1,this.enableEl(this.saveZipToDriveButton,!0)):(this.showEl(this.authButton,!0),this.showEl(this.authButtonDetails,!0));break;case ze.App.APP_STATE.CANCEL_DOWNLOAD_REQUESTED:this.enableEl(this.cancelButton,!1);break;case ze.App.APP_STATE.DOWNLOAD_CANCELED:this.showEl(this.cancelButton,!1),this.enableEl(this.cancelButton,!0),this.showEl(this.retryButton,!0),this.showEl(this.closeButton,!0),this.updateLabelsAndProgress("Opening canceled","Click Retry to open this file again"),this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING),this.setProgressBarPercent(100);break;case ze.App.APP_STATE.DOWNLOADING_METADATA:this.showEl(this.buttonContainer,!0);this.updateDownloadingFilename(""),this.showEl(this.selectAllCheckbox,!1),this.showEl(this.rootStatusSpinner,!0),this.showEl(this.rootStatusIconContainer,!1),this.showEl(this.cancelButton,!0),this.enableEl(this.cancelButton,!0),this.showEl(this.retryButton,!1),this.showEl(this.closeButton,!1),this.showEl(this.editZipButton,!1),this.updateLabelsAndProgress("Checking file in Google Drive...","This may take a few moments"),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER);break;case ze.App.APP_STATE.DOWNLOADING:e&&(this.updateDownloadingFilename(e,t),this.showEl(this.rootStatusSpinner,!1),this.showEl(this.selectAllCheckbox,!1),this.rootStatusIcon.textContent="cloud_download",this.rootStatusIcon.style.color="",this.showEl(this.rootStatusIconContainer,!0));break;case ze.App.APP_STATE.DOWNLOAD_ALL_BYTES_TRANSFERRED:break;case ze.App.APP_STATE.DOWNLOAD_FIRST_BYTE_TRANSFERRED:this.updateLabelsAndProgress("Opening file from Google Drive..."),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER);break;case ze.App.APP_STATE.DOWNLOADED:this.showEl(this.cancelButton,!1),this.updateLabelsAndProgress("File downloaded",null,100),this.setMainIcon(ze.App.MAIN_ICON_TYPE.INFO);break;case ze.App.APP_STATE.DOWNLOAD_ERROR:this.updateUiForDownloadError(e);break;case ze.App.APP_STATE.INIT:break;case ze.App.APP_STATE.ZIP_READ_ERROR:var A=e;if(A&&A.target){var c=A.target.toString();c&&-1!=c.indexOf("Worker")&&(A="ZIP Worker Error")}this.updateLabelsAndProgress("Error reading "+this.currentArchiveTypeString+" file","Error details: "+A),this.showEl(this.buttonContainer,!0),this.showEl(this.closeButton,!0),this.showEl(this.cancelButton,!1),this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING);break;case ze.App.APP_STATE.MODEL_BUILDING:this.updateLabelsAndProgress("Processing "+this.currentArchiveTypeString+" file...","");break;case ze.App.APP_STATE.SESSION_CANCELED:break;case ze.App.APP_STATE.EXTRACTION_CANCEL_REQUESTED:this.updateUiForExtractionCancelRequested();break;case ze.App.APP_STATE.EXTRACTION_CANCELED:this.updateUiForExtractionComplete(!0);break;case ze.App.APP_STATE.RENDER_ZIP_UI:this.updateLabelsAndProgress("Displaying "+this.currentArchiveTypeString+" file...","");break;case ze.App.APP_STATE.READY_TO_EXTRACT:this.promptToExtract(e,t);break;case ze.App.APP_STATE.ZIP_READING:this.updateLabelsAndProgress("Reading "+this.currentArchiveTypeString+" file..."),this.showEl(this.buttonContainer,!0),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER);break;case ze.App.APP_STATE.EXTRACTING:this.updateUiForExtractionStart(),this.handleProgress(0,100);break;case ze.App.APP_STATE.JSCHARDET_LIBRARY_LOADING:case ze.App.APP_STATE.AESCRYPTO_LIBRARY_LOADING:case ze.App.APP_STATE.CREATEZIP_LIBRARY_LOADING:case ze.App.APP_STATE.BZIP_LIBRARY_LOADING:case ze.App.APP_STATE.PENDING_ZIP_LIBRARY_LOAD:this.updateLabelsAndProgress("Loading ZIP library..."),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER);break;case ze.App.APP_STATE.RARDECODE_LIBRARY_LOADING:this.updateLabelsAndProgress("Loading RAR library..."),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER);break;case ze.App.APP_STATE.NEW_SESSION:break;case ze.App.APP_STATE.EXTRACTION_COMPLETE:this.updateUiForExtractionComplete(!1);break;case ze.App.APP_STATE.COMPLETE_WITH_ERRORS:this.updateUiForExtractionComplete(!1);break;default:throw new Error("Unexpected state: "+this.appState);}},ze.App.prototype.maybeShowAddPasswordButton=function(){this.zipEntryTree&&this.zipEntryTree.isEncrypted||this.showEl(this.addPasswordButton,!0)},ze.App.prototype.setMainIcon=function(e){if(e==ze.App.MAIN_ICON_TYPE.SPINNER)this.mainLabel.style.color="",this.showEl(this.mainIcon,!1),this.showEl(this.mainSpinner,!0),this.mainAppHeaderContent.style.backgroundColor="";else{var t=this.getMainHeaderConfigByType(e);this.mainIcon.textContent=t.iconKey,this.mainIcon.style.color=t.color,this.mainLabel.style.color=t.color,this.mainAppHeaderContent.style.backgroundColor=t.backgroundColor||"",this.showEl(this.mainIcon,!0),this.showEl(this.mainSpinner,!1)}},ze.App.prototype.getMainHeaderConfigByType=function(e){var t={};switch(e){case ze.App.MAIN_ICON_TYPE.WARNING:t.iconKey="warning",t.color="#d00000",t.backgroundColor="lightyellow";break;case ze.App.MAIN_ICON_TYPE.ERROR:t.iconKey="error_outline",t.color="#d00000",t.backgroundColor="lightyellow";break;case ze.App.MAIN_ICON_TYPE.CANCEL:t.iconKey="warning",t.color="#d00000";break;case ze.App.MAIN_ICON_TYPE.SUCCESS:t.iconKey="check_circle",t.color="#1a73e8";break;case ze.App.MAIN_ICON_TYPE.SECURITY:t.iconKey="security",t.color="#1a73e8",t.backgroundColor="lightyellow";break;case ze.App.MAIN_ICON_TYPE.LOCKED:t.iconKey="lock",t.color="",t.backgroundColor="";break;case ze.App.MAIN_ICON_TYPE.UNLOCKED:t.iconKey="lock_open",t.color="",t.backgroundColor="";break;case ze.App.MAIN_ICON_TYPE.ADD:t.iconKey="add_circle_outline",t.backgroundColor="",t.color="";break;case ze.App.MAIN_ICON_TYPE.INFO:t.iconKey="info_outline",t.backgroundColor="",t.color="";break;default:t.iconKey="info_outline",t.color="",t.backgroundColor="";}return t},ze.App.prototype.handleProgress=function(e,t){var r=Math.round(3+97*(e/t));return this.updateLabelsAndProgress(null,null,r),r},ze.App.updatePageTitle=function(e){document.title=e?e+" - "+ze.App.NAME:ze.App.NAME},ze.App.resetPageTitle=function(){document.title=ze.App.DEFAULT_PAGE_TITLE},ze.App.prototype.updateUiForFileComplete=function(e){if(!e.root){var t=ze.App.getFilenameCell(e);t.style.color="#1a73e8";var r=ze.App.getIconCell(e);r.style.color="#1a73e8",r.style.opacity="0.8"}},ze.App.prototype.handleEncryptionPromptCheckboxClick=function(){var e=ze.App.isCheckboxIconButtonChecked(this.encryptionPromptCheckbox);ze.App.setCheckboxIconButtonChecked(this.encryptionPromptCheckbox,!e)},ze.App.prototype.handleSelectAllCheckboxClick=function(){var e=ze.App.isCheckboxIconButtonChecked(this.selectAllCheckbox);ze.App.setCheckboxIconButtonChecked(this.selectAllCheckbox,!e),ze.App.setChildEntriesCheckState(this.zipEntryTree,!e)},ze.App.prototype.handleSecondaryLabelLinkClick=function(){logImpression("choose_folder","user_button","app_state: "+this.appState),this.showPicker(bindFn(this.handlePickerFolderSelected,this),!0)},ze.App.prototype.setProgressBarPercent=function(e){ze.App.doSetProgressBarPercent(e,this.mainProgressBar)},ze.App.prototype.setPreviewProgressBarPercent=function(e){ze.App.doSetProgressBarPercent(e,this.previewProgressBar)},ze.App.doSetProgressBarPercent=function(e,t){-1===e||(t.firstElementChild.style.width=e.toString()+"%")},ze.App.prototype.setAuthText=function(e){this.authButtonDetails.textContent=e;this.showEl(this.authButtonDetails,!!e)},ze.App.prototype.updateLabelsAndProgress=function(e,t,r){null!=e&&(this.showEl(this.mainAppHeader,!0),this.mainLabel.textContent=e),null==t?this.setSecondaryLabelLinkText(""):(this.secondaryLabel.childNodes[0].nodeValue=t,""===t&&this.setSecondaryLabelLinkText("")),null!=r&&this.setProgressBarPercent(r)},ze.App.prototype.updateDownloadingFilename=function(e,t){this.fileTableHeaderLabel.textContent=e,this.showEl(this.fileTableHeaderLabel,!0);var r=null!=t&&""!==t?ze.App.formatSize(t):"";this.fileTableHeaderSize.textContent=r,this.showEl(this.fileTableContainer,!0)},ze.App.prototype.isTableEntrySelected=function(e){return!!e.root||ze.App.isChecked(e)},ze.App.prototype.renderZipTableUi=function(e){this.setAppState(ze.App.APP_STATE.RENDER_ZIP_UI),this.fileTableHeaderLabel.textContent=this.zipFilename,this.fileTableHeaderSize.textContent=null==this.zipFileSize?"":ze.App.formatSize(this.zipFileSize),ze.App.generateZipTable(this.fileTableItems,this.zipEntryTree,bindFn(this.zipTableUiRendered,this,e))},ze.App.prototype.configurePasswordPrompt=function(){var e=this.isArchivePasswordFormatSupported(this.zipEntryTree.encryptionMode);logImpression("render_password_prompt","crypto","supported="+e+"; mode="+this.zipEntryTree.encryptionMode),e?this.setAppState(ze.App.APP_STATE.PASSWORD_REQUIRED):this.setAppState(ze.App.APP_STATE.PASSWORD_FORMAT_NOT_SUPPORTED,this.zipEntryTree.encryptionMode),this.refreshZipEntryTreeItemState(ze.App.ESTATE.DEFAULT)},ze.App.prototype.isArchivePasswordFormatSupported=function(e){return e==ze.ZipLib.ENCRYPTION_MODE_PKZIPSTANDARD||e==ze.RarLib.ENCRYPTION_MODE_RAR||e==ze.ZipLib.ENCRYPTION_MODE_WINZIPAES},ze.App.prototype.zipTableUiRendered=function(e){this.showEl(this.fileTableContainer,!0),this.fileTableContainer.scrollTop=0,this.showEl(this.selectAllCheckbox,!0),this.showEl(this.rootStatusSpinner,!1),this.showEl(this.rootStatusIconContainer,!1),e()},ze.App.prototype.getEntriesByState=function(e){return this.zipEntryStateMap[e]},ze.App.prototype.getFirstEntryByState=function(e){var t=this.getEntriesByState(e);if(t){var r=Object.keys(t);if(r&&0<r.length)return t[r[0]]}return null},ze.App.prototype.getNumEntriesByState=function(e){var t=this.getEntriesByState(e);if(t){var r=Object.keys(t);if(r&&null!=r.length)return r.length}return 0},ze.App.prototype.getNumFilesExtracted=function(){return Math.max(this.getNumEntriesByState(ze.App.ESTATE.UPLOAD_COMPLETE)-1,0)},ze.App.prototype.getNumFilesWithUploadErrors=function(){return this.getNumEntriesByState(ze.App.ESTATE.UPLOAD_ERROR)},ze.App.prototype.getFirstErrorInfo=function(){var e=this.getFirstEntryByState(ze.App.ESTATE.UPLOAD_ERROR);if(e||(e=this.getFirstEntryByState(ze.App.ESTATE.DECOMPRESSION_ERROR)),e){var t=e.error||"",r=e.message;return r&&(t+=" - "+r),t}return""},ze.App.prototype.getNumFilesWithDecompressionErrors=function(){return this.getNumEntriesByState(ze.App.ESTATE.DECOMPRESSION_ERROR)},ze.App.prototype.getNumFilesSkipped=function(){return this.getNumEntriesByState(ze.App.ESTATE.SKIPPED)},ze.App.prototype.getNumFilesCanceled=function(){return this.getNumEntriesByState(ze.App.ESTATE.CANCELED)+this.getNumEntriesByState(ze.App.ESTATE.UPLOAD_ABORTED)},ze.App.prototype.updateUiForExtractionComplete=function(e){if(null!=this.zipEntryTree){this.sessionPropMap[ze.App.SESS_PROP.DIDZIPEXTRACT]=!0,this.setProgressBarPercent(100),this.fileTableContainer.scrollTop=0;var t=this.getNumFilesExtracted(),r=this.getNumFilesWithUploadErrors(),i=this.getNumFilesWithDecompressionErrors(),p=this.getNumFilesCanceled(),o=this.getNumFilesSkipped(),n=r+i,a=0<n,s="",E="";if(this.updateRootEntryUi(this.zipEntryTree),this.showEl(this.closeButton,!0),this.showEl(this.viewFilesButton,!0),this.showEl(this.cancelButton,!1),this.wasZipFileCreatedLocally){var d=null!=this.createdZipSavedToDriveId;this.showEl(this.saveZipToDriveButton,!d),this.showEl(this.openZipInDriveButton,d),this.showEl(this.downloadZipButton,!0)}else this.showEl(this.saveZipToDriveButton,!1),this.showEl(this.openZipInDriveButton,!1);e?(s="Extraction canceled",this.showEl(this.retryButton,!0),this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING)):(s=a?"Extraction complete, but with errors":"Extraction complete",this.showEl(this.extractButton,!1),this.showEl(this.retryButton,0<r),this.showEl(this.editZipButton,!1),this.showEl(this.zipFilenameInputContainer,!1),this.showEl(this.secondaryLabelLinkCombo,!0),this.showEl(this.fileTableHeaderLabel,!0)),E=1==t?"1 file extracted. ":t+" files extracted. ",this.setMainIcon(ze.App.MAIN_ICON_TYPE.SUCCESS),0<p&&(E+=1==p?"1 file was canceled. ":p+" files were canceled. ",this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING)),a&&(E+=1==n?"1 file had an error. ":n+" files had errors. ",this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING)),0<o&&(1==o?E+="1 file was skipped. ":E+=o+" files were skipped. "),E=E.trim(),ze.App.endsWith(E,".")&&(E=E.substring(0,E.length-1)),this.updateLabelsAndProgress(s,E)}},ze.App.prototype.updateUiForExtractionStart=function(){this.showEl(this.extractButton,!1),this.showEl(this.cancelButton,!0),this.enableEl(this.cancelButton,!0),this.showEl(this.editZipButton,!1),this.showEl(this.retryButton,!1),this.showEl(this.viewFilesButton,!1),this.showEl(this.closeButton,!1),this.showEl(this.saveZipToDriveButton,!1),this.showEl(this.openZipInDriveButton,!1),this.showEl(this.downloadZipButton,!1),this.showEl(this.fixEncodingButton,!1),this.showEl(this.zipFilenameInputContainer,!1),this.showEl(this.secondaryLabelLinkCombo,!0),this.showEl(this.fileTableHeaderLabel,!0),this.setSecondaryLabelLinkText(""),this.updateLabelsAndProgress("Extracting "+this.currentArchiveTypeString+" file to Google Drive...","",0),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER)},ze.App.prototype.updateSecondaryProgressString=function(e){this.updateLabelsAndProgress(void 0,this.getNumItemsUploadedString(e))},ze.App.prototype.getItemsRemainingString=function(e){var t=this.getNumItemsRemaining(),r=t.toString()+" "+(1==t?"file":"files")+" remaining";return null!=e&&-1!=e&&(r+=" ("+e+"%)"),r},ze.App.prototype.getNumItemsUploadedString=function(e){var t=this.getNumEntriesByState(ze.App.ESTATE.UPLOAD_COMPLETE);this.zipEntryTree&&null!=this.zipEntryTree.driveFileId&&t--;var r=t+this.getNumItemsRemaining(),i=t.toString()+" of "+r+" "+(1==r?"file":"files")+" extracted";return null!=e&&-1!=e&&(i+=" ("+e+"%)"),i},ze.App.prototype.getNumItemsRemaining=function(){var e=Object.keys(this.zipEntriesInProcessMap).length;return this.zipEntryTree&&null==this.zipEntryTree.driveFileId?e-1:e},ze.App.prototype.startNewManualSession=function(e){this.setAppState(ze.App.APP_STATE.NEW_SESSION),e||this.showEl(this.mainAppHeader,!1),this.mainAppSubTitle.textContent="Free app for opening ZIP files",this.showEl(this.zipTable,!1),this.fileTableContainer.scrollTop=0,this.zipPasswordInput.value="",this.zipFilenameInput.value="",this.showEl(this.extractButton,!1),this.showEl(this.cancelButton,!1),this.showEl(this.viewFilesButton,!1),this.showEl(this.retryButton,!1),this.showEl(this.closeButton,!1),this.showEl(this.editZipButton,!1),this.showEl(this.cancelButton,!1),this.showEl(this.fileTableSubHeader,!1),this.showEl(this.secondaryLabelLink,!1),this.showEl(this.zipFilenameInputContainer,!1),this.showEl(this.checkPasswordButton,!1),this.showEl(this.secondaryLabelLinkCombo,!0),this.showEl(this.fileTableHeaderLabel,!0),this.showEl(this.addFilesButtonContainer,!1),this.showEl(this.addPasswordButton,!1),this.showEl(this.downloadZipButton,!1),this.showEl(this.editZipButton,!1),this.showEl(this.doneEditingZipButton,!1),this.showEl(this.openZipInDriveButton,!1),this.showEl(this.saveZipToDriveButton,!1),this.showEl(this.fixEncodingButton,!1),this.secondaryLabel.childNodes[0].nodeValue="",this.mainLabel.textContent="",this.showEl(this.zipPasswordInputContainer,!1),this.hideZipPasswordChars(),this.showEl(this.fileTableContainer,!1),this.showEl(this.buttonContainer,!1),this.showEl(this.selectAllCheckbox,!1),ze.App.setCheckboxIconButtonChecked(this.selectAllCheckbox,!0),this.setProgressBarPercent(0),this.highestZipEntryIndexUploadedInSession=0,e||this.configureStartPageForNewManualSession(),this.showEl(this.mainScrollableContent,!0)},ze.App.prototype.promptToExtract=function(e,t){this.showEl(this.closeButton,!0),this.showEl(this.cancelButton,!1),this.showEl(this.extractButton,!0),this.enableEl(this.extractButton,!0),this.showEl(this.addFilesButtonContainer,!1),this.showEl(this.addPasswordButton,!1),this.showEl(this.editZipButton,!0),this.showEl(this.doneEditingZipButton,!1),this.showEl(this.secondaryLabelLinkCombo,!0),this.showEl(this.buttonContainer,!0),this.showEl(this.editZipButton,!!t),this.cancelButton.style.visibility="",this.updateLabelsForReadyToExtract(e)},ze.App.prototype.hideWelcomeText=function(){this.showEl(this.generalButtonContainer,!1),this.showEl(this.authButtonContainer,!1),this.showEl(this.startPagePrompt,!1)},ze.App.prototype.updateLabelsForReadyToExtract=function(e){var t=e?"Password correct. ":"",r="Ready to extract ",i=detectDevice();"phone"==i&&e||(r+=this.currentArchiveTypeString+" file"),"phone"!=i&&this.currentAutodetectedEncoding&&(r+=" (encoding: \""+this.currentAutodetectedEncoding+"\")"),this.updateLabelsAndProgress(t+r,"Location for extracted files: ",100),this.setSecondaryLabelLinkText("Google Drive"),e?this.setMainIcon(ze.App.MAIN_ICON_TYPE.UNLOCKED):this.setMainIcon(ze.App.MAIN_ICON_TYPE.INFO)},ze.App.prototype.setSecondaryLabelLinkText=function(e){e?(this.secondaryLabelLink.textContent=e,this.showEl(this.secondaryLabelLink,!0)):(this.secondaryLabelLink.textContent="",this.showEl(this.secondaryLabelLink,!1))},ze.App.prototype.updateUiForExtractionCancelRequested=function(){this.enableEl(this.cancelButton,!1),this.updateLabelsAndProgress("Canceling extraction..."),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER)},ze.App.prototype.updateUiForDownloadError=function(e){this.showEl(this.cancelButton,!1),this.showEl(this.retryButton,!0),this.showEl(this.closeButton,!0),this.showEl(this.fileTableContainer,!1);this.updateLabelsAndProgress("Unable to open ZIP file",e||"Unknown error"),this.setMainIcon(ze.App.MAIN_ICON_TYPE.WARNING)},ze.App.prototype.handlePreviewCloseButtonClick=function(){this.closePreview()},ze.App.prototype.isPreviewShown=function(){return null!=this.previewedEntry},ze.App.prototype.closePreview=function(){this.showEl(this.previewDownloadButton,!1),this.showEl(this.previewSaveToDriveButton,!1),this.showEl(this.previewOpenInDriveButton,!1),this.showEl(this.preview,!1),this.mainScrollableContent.scrollTop=0,this.showEl(this.zipTable,!0),this.resetPreview()},ze.App.prototype.handlePreviewDownloadButtonClick=function(){logImpression("preview_download","user_button","previewed_entry_is_null: "+(null==this.previewedEntry)),this.sessionPropMap[ze.App.SESS_PROP.DIDDOWNLOADSUBITEM]=!0;var e=this;this.previewedBlob?(this.enableEl(this.previewDownloadButton,!1),this.downloadBlobToBrowser(this.previewedEntry.name,new Blob([this.previewedBlob],{type:"application/octet-stream"})),this.enableEl(this.previewDownloadButton,!0)):this.decompressPreviewedBlob(this.previewedEntry,function(){e.updatePreviewFilenameLabel(),e.downloadBlobToBrowser(e.previewedEntry.name,new Blob([e.previewedBlob],{type:"application/octet-stream"})),e.configurePreviewActionButtonsForWorkingOperation(!1)},bindFn(this.previewDecompressionError,this,this.previewedEntry),bindFn(this.previewDecompressionProgressFunction,this,this.previewedEntry,!0))},ze.App.prototype.updatePreviewFilenameLabel=function(){this.previewZipFilenameAndStatus.textContent=this.zipFilename},ze.App.prototype.storeDecompressedPreviewedBlob=function(e,t){var r=ze.App.getFileExtension(e.name),i={};"pdf"==r&&(i.type="application/pdf"),this.previewedBlob=new Blob([t],i)},ze.App.prototype.decompressPreviewedBlob=function(e,t,r,i){this.configurePreviewActionButtonsForWorkingOperation(!0,!1),e.isEncrypted&&i&&(this.previewZipFilenameAndStatus.textContent="Decrypting...");var p=this;ze.ZipLib.decompressEntry(this.zipBlob,e,!0,function(r){p.storeDecompressedPreviewedBlob(e,r),t()},r,i,this.getZipPasswordCharCodeByteArray())},ze.App.prototype.handlePreviewNextButtonClick=function(){if(this.previewedEntry){var e=this.getNextOrPrevEntry(this.previewedEntry,!0);e&&this.updateCurrentPreview(e)}},ze.App.prototype.handlePreviewPrevButtonClick=function(){if(this.previewedEntry){var e=this.getNextOrPrevEntry(this.previewedEntry,!1);e&&this.updateCurrentPreview(e)}},ze.App.prototype.getNextOrPrevEntry=function(e,t){var r=e.tableRow;if(r){var i=t?r.nextElementSibling:r.previousElementSibling;if(i){var p=i.entry;return p.directory?this.getNextOrPrevEntry(p,t):p}var o=t?r.parentElement.firstElementChild:r.parentElement.lastElementChild;if(o&&o.entry!=e){var n=o.entry;return n.directory?this.getNextOrPrevEntry(n,t):n}return null}return null},ze.App.prototype.updateCurrentPreview=function(e){this.resetPreview(),this.previewItem(e)},ze.App.prototype.handlePreviewSaveToDriveButtonClick=function(){logImpression("preview_save_to_drive","user_button"),!isAuthorized()||isTokenExpired()?(this.doResumeOpenFromGoogleDriveAfterManualAuth=!1,this.doResumeExtractToGoogleDriveAfterManualAuth=!1,this.doResumeSavePreviewItemToGoogleDriveAfterManualAuth=!0,this.doResumeSaveZipToDriveAfterManualAuth=!1,this.initiateManualAuth()):this.previewedBlob?this.savePreviewedBlobToDrive():this.decompressPreviewedBlob(this.previewedEntry,bindFn(this.savePreviewedBlobToDrive,this,this.previewedEntry),bindFn(this.previewDecompressionError,this,this.previewedEntry),bindFn(this.previewDecompressionProgressFunction,this,this.previewedEntry,!0))},ze.App.prototype.configurePreviewActionButtonsForWorkingOperation=function(e,t,r){this.showEl(this.previewDownloadButton,!e),this.showEl(this.previewNextButton,!e),this.showEl(this.previewPrevButton,!e),this.showEl(this.previewCloseButton,!e),this.showEl(this.previewSpinner,e),this.showEl(this.previewItemIcon,!e),this.showEl(this.previewOpenInDriveButton,!e&&!!r),this.showEl(this.previewSaveToDriveButton,!e&&!r),t?(this.showEl(this.previewCancelButton,e),this.enableEl(this.previewCancelButton,e)):this.showEl(this.previewCancelButton,!1)},ze.App.prototype.fixEncoding=function(){this.enableEl(this.fixEncodingButton,!1),ze.App.prototype.ensureLibLoadedAndCallback(ze.App.JSCHARDETLIB_WINDOW_OBJECT_CHECK,ze.App.JSCHARDETLIB_SCRIPT_NAME,ze.App.APP_STATE.AESCRYPTO_LIBRARY_LOADING,bindFn(this.doFixEncoding,this))},ze.App.prototype.doFixEncoding=function(){logImpression("fix_encoding","encoding");var e=this.autodetectEncoding();if(logImpression("detected_encoding","encoding",e),null!=e){var t=this.zipFilename,r=this.zipBlob;this.closeSession(),this.currentAutodetectedEncoding=e,this.loadArchiveSessionFromLocal(t,r.size,r)}},ze.App.prototype.autodetectEncoding=function(){if(!(this.zipEntryTree&&this.zipEntryTree.originalEntries&&0<this.zipEntryTree.originalEntries.length))return null;for(var e="",t=0,r;t<this.zipEntryTree.originalEntries.length;t++){r=this.zipEntryTree.originalEntries[t];for(var p=0;p<r.rawFilenameBytes.length;p++)e+=String.fromCharCode(r.rawFilenameBytes[p]);e+=" "}var o=jschardet.detect(e);return window.console.log(o),o&&o.encoding?o.encoding.toLowerCase():null},ze.App.prototype.saveZipToDrive=function(){if(!isAuthorized()||isTokenExpired())this.doResumeOpenFromGoogleDriveAfterManualAuth=!1,this.doResumeExtractToGoogleDriveAfterManualAuth=!1,this.doResumeSavePreviewItemToGoogleDriveAfterManualAuth=!1,this.doResumeSaveZipToDriveAfterManualAuth=!0,this.initiateManualAuth();else{var e=this.zipEntryTree?this.zipEntryTree.encryptionMode:"null zipEntryTree";logImpression("save_zip_to_drive","create_zip","start. encryptionMode: "+e),this.updateLabelsAndProgress("Saving ZIP file to Google Drive...","Saving..."),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SPINNER),this.isSavingToDrive=!0,this.wasSaveToDriveCancelled=!1,this.showEl(this.doneEditingZipButton,!1),this.showEl(this.retryButton,!1),this.showEl(this.viewFilesButton,!1),this.enableEl(this.saveZipToDriveButton,!1),this.showEl(this.saveZipToDriveButton,!1),this.showEl(this.downloadZipButton,!1),this.showEl(this.openZipInDriveButton,!1),this.showEl(this.addFilesButtonContainer,!1),this.showEl(this.addPasswordButton,!1),this.showEl(this.secondaryLabelLinkCombo,!0),this.showEl(this.cancelButton,!0),this.enableEl(this.cancelButton,!0),this.setProgressBarPercent(0);var t=ze.Dapi.generateCallbacks(bindFn(this.saveZipToDriveUploadComplete,this),bindFn(this.saveZipToDriveUploadError,this),bindFn(this.saveZipToDriveUploadProgress,this),bindFn(this.saveZipToDriveUploadAborted,this));ze.Dapi.uploadFile(t,this.zipBlob,this.zipFilename,this.parentFolderId)}},ze.App.prototype.saveZipToDriveUploadComplete=function(e){logImpression("save_zip_to_drive","create_zip","success"),this.setProgressBarPercent(100),this.createdZipSavedToDriveId=e.id,this.isSavingToDrive=!1,this.showEl(this.cancelButton,!1),this.showEl(this.doneEditingZipButton,!0),this.showEl(this.downloadZipButton,!0),this.showEl(this.saveZipToDriveButton,!1),this.enableEl(this.saveZipToDriveButton,!1),this.showEl(this.openZipInDriveButton,!0),this.enableEl(this.openZipInDriveButton,!0),this.updateLabelsAndProgress("ZIP file saved to Google Drive"),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SUCCESS),this.showEl(this.secondaryLabelLinkCombo,!1),this.showEl(this.addFilesButtonContainer,!0),this.maybeShowAddPasswordButton(),this.refreshZipEntryTreeItemState(ze.App.ESTATE.CREATED_ZIP_SAVED_TO_DRIVE)},ze.App.prototype.saveZipToDriveUploadProgress=function(e,t){var r=Math.round(3+97*(e/t));this.setProgressBarPercent(r),this.updateLabelsAndProgress(null,"Saving... ("+r.toString()+"%)",r)},ze.App.prototype.saveZipToDriveUploadError=function(e,t){logImpression("save_zip_to_drive","create_zip","error: "+t),this.enableEl(this.saveZipToDriveButton,!0),this.showEl(this.saveZipToDriveButton,!0),this.setProgressBarPercent(100),this.isSavingToDrive=!1,this.showEl(this.cancelButton,!1),this.updateLabelsAndProgress("Error when saving ZIP file"),this.setMainIcon(ze.App.MAIN_ICON_TYPE.ERROR),this.showEl(this.doneEditingZipButton,!0),this.showEl(this.downloadZipButton,!0),this.updateLabelsAndProgress(null,"Error details: "+(t||""))},ze.App.prototype.saveZipToDriveUploadAborted=function(e,t){logImpression("save_zip_to_drive","create_zip","aborted. message: "+(t||"")),this.enableEl(this.saveZipToDriveButton,!0),this.showEl(this.saveZipToDriveButton,!0),this.setProgressBarPercent(100),this.isSavingToDrive=!1,this.showEl(this.cancelButton,!1),this.showEl(this.doneEditingZipButton,!0),this.showEl(this.downloadZipButton,!0);var r=this.wasSaveToDriveCancelled?"Save ZIP to Drive canceled":"Error when saving ZIP file. ",i=this.wasSaveToDriveCancelled?"You may try again with the \"Save ZIP to Drive\" button. ":"There was a network problem. "+(t||"");this.updateLabelsAndProgress(r,i);var p=this.wasSaveToDriveCancelled?ze.App.MAIN_ICON_TYPE.WARNING:ze.App.MAIN_ICON_TYPE.ERROR;this.setMainIcon(p)},ze.App.prototype.savePreviewedBlobToDrive=function(e){if((logImpression("preview_upload_file","preview","start"),null!=this.previewedEntry&&null!=this.previewedBlob)&&(null==e||e==this.previewedEntry)){this.configurePreviewActionButtonsForWorkingOperation(!0,!0),this.previewZipFilenameAndStatus.textContent="Saving to Drive...",this.isSavingToDrive=!0,this.wasSaveToDriveCancelled=!1,this.setPreviewProgressBarPercent(0);var t=ze.Dapi.generateCallbacks(bindFn(this.previewFileUploadComplete,this,this.previewedEntry),bindFn(this.previewFileUploadError,this,this.previewedEntry),bindFn(this.previewFileUploadProgress,this,this.previewedEntry,!0),bindFn(this.previewFileUploadAborted,this,this.previewedEntry));ze.Dapi.uploadFile(t,this.previewedBlob,this.previewedEntry.name,null)}},ze.App.prototype.previewFileUploadComplete=function(e,t){logImpression("preview_upload_file","preview","success"),this.setPreviewProgressBarPercent(100),this.configurePreviewActionButtonsForWorkingOperation(!1),this.updatePreviewFilenameLabel(),this.isSavingToDrive=!1,e.driveFileId=t.id,this.showEl(this.previewOpenInDriveButton,!0),this.showEl(this.previewSaveToDriveButton,!1),this.previewType&&ze.App.startsWith(this.previewType,"drive")?(this.showEl(this.previewDriveSaveToDriveFirst,!1),this.showEl(this.previewSaveToDriveDetails,!1),this.doEmbeddedDrivePreview(e.driveFileId)):(this.showEl(this.previewSpinner,!1),this.showEl(this.previewItemIcon,!0))},ze.App.prototype.previewFileUploadError=function(e,t,r){logImpression("preview_upload_file_error","preview","error: "+r),this.isSavingToDrive=!1,this.previewZipFilenameAndStatus.textContent="Save to Drive error: "+r,this.setPreviewProgressBarPercent(100),this.configurePreviewActionButtonsForWorkingOperation(!1)},ze.App.prototype.previewFileUploadAborted=function(e,t,r){logImpression("preview_upload_file_aborted","preview","message: "+r),this.isSavingToDrive=!1,this.wasSaveToDriveCancelled?this.updatePreviewFilenameLabel():this.previewZipFilenameAndStatus.textContent="Save to Drive error (network problem)",this.setPreviewProgressBarPercent(100),this.configurePreviewActionButtonsForWorkingOperation(!1)},ze.App.prototype.previewFileUploadProgress=function(e,t,r,i){var p=Math.round(3+97*(r/i));this.setPreviewProgressBarPercent(p),t&&(this.previewZipFilenameAndStatus.textContent="Saving to Drive... ("+p+"%)")},ze.App.prototype.handlePreviewOpenInDriveButtonClick=function(){null!=this.previewedEntry.driveFileId&&ze.App.openEntryInDrive(this.previewedEntry)},ze.App.prototype.downloadBlobToBrowser=function(e,t){logImpression("download_blob_to_browser_start","download_blob_to_browser");var r=window.URL||window.webkitURL,i=this.downloadAnchorEl,p=r.createObjectURL(t);i.setAttribute("href",p),i.setAttribute("download",e),i.setAttribute("target","_blank"),i.textContent=e;try{i.click(),logImpression("download_blob_to_browser_success","download_blob_to_browser")}catch(e){logImpression("download_blob_to_browser_error","download_blob_to_browser",e)}},ze.App.prototype.downloadZipToBrowser_newWindowMethod=function(e,t){var r=new FileReader,i=new Blob([t],{type:"application/zip"});r.onload=function(){var t=window.open(e,"_self");t.location.href=r.result},r.readAsDataURL(i)},ze.App.prototype.handlePickerFileSelected=function(e){this.sessionPropMap[ze.App.SESS_PROP.DIDPICKDRIVEZIP]=!0,this.closeSession(!0),this.downloadFileById(e.id)},ze.App.prototype.handlePickerFolderSelected=function(e){this.sessionPropMap[ze.App.SESS_PROP.DIDPICKEXTRACTLOCATION]=!0,this.parentFolderId=e.id,this.setSecondaryLabelLinkText(e.name)},ze.App.prototype.handleAddLocalFileInputElChange=function(t){if(!this.isProcessingAddLocalFileInputEl){this.isProcessingAddLocalFileInputEl=!0;var e=t.target.files;e&&0<e.length&&(this.sessionPropMap[ze.App.SESS_PROP.DIDADDLOCALFILESTOZIP]=!0,this.addFilesToZip(e)),this.addLocalFileInputEl.value="",this.isProcessingAddLocalFileInputEl=!1}},ze.App.prototype.handleOpenLocalZipFileInputElChange=function(t){if(!this.isProcessingOpenLocalZipFileInputEl){this.isProcessingOpenLocalZipFileInputEl=!0;var e=t.target.files[0];if(this.openLocalZipFileInputEl.value="",e){this.sessionPropMap[ze.App.SESS_PROP.DIDPICKLOCALZIP]=!0,this.closeSession(!0);var r=e.name.trim();this.loadArchiveSessionFromLocal(r,e.size,e)}else;this.isProcessingOpenLocalZipFileInputEl=!1}},ze.App.prototype.loadArchiveSessionFromLocal=function(e,t,r){this.showEl(this.zipTable,!0),this.showEl(this.mainScrollableContent,!1),this.updateDownloadingFilename(e,t),this.showEl(this.rootStatusSpinner,!1),this.showEl(this.selectAllCheckbox,!1),this.rootStatusIcon.textContent="cloud_download",this.rootStatusIcon.style.color="",this.showEl(this.rootStatusIconContainer,!0),this.readArchive(e,t,r)},ze.App.prototype.createNewZipFromFile=function(e,t,r){var i=ze.App.getFileExtension(e).toUpperCase();this.mainAppSubTitle.textContent="Create ZIP file from "+i+" file",logImpression("create_new_zip_from_file","create_zip",i),this.createZipFromFileAssociatedExtension=i,ze.App.prototype.ensureLibLoadedAndCallback(ze.App.CREATEZIPLIB_WINDOW_OBJECT_CHECK,ze.App.CREATEZIPLIB_SCRIPT_NAME,ze.App.APP_STATE.CREATEZIP_LIBRARY_LOADING,bindFn(this.doCreateNewZipFromFile,this,e,t,r))},ze.App.prototype.doCreateNewZipFromFile=function(e,t,r){logImpression("create_new_zip_from_file","create_zip","init + lib_loaded");var i=ze.App.getZipExtractorCreateZipCommentString(),p=e+".zip",o=zeCreateZipLib.createEmptyZipBlob(i);this.zipFilenameInput.value=p,this.fileTableHeaderLabel.textContent=p;var n={name:ze.App.sanitizeDriveFilename(e),uncompressedFileBlob:t};this.wasZipFileCreatedLocally=!0,this.showEl(this.zipTable,!0),this.showEl(this.mainScrollableContent,!1),this.isInZipEditMode=!0,this.readArchive(p,o.size,o,bindFn(this.addManualItemToEmptyZip,this,o,[n],r))},ze.App.prototype.addManualItemToEmptyZip=function(e,t,r){this.setAppState(ze.App.APP_STATE.ADDING_FILES_TO_ZIP),this.addFilesToZipOrEncryptZipCancelRequested=!1,this.refreshZipEntryTreeItemState(ze.App.ESTATE.ADDED_TO_ZIP),zeCreateZipLib.serializeZipFromEntries([],e,t,bindFn(this.renderCreatedZip,this,!1,r,t[0].name,!1),bindFn(this.handleZipCreateError,this),bindFn(this.checkAndHandleCreateOrEncryptZipFileCancelled,this,bindFn(this.handleZipCreateError,this)),bindFn(this.handleZipCreateOrEncryptProgress,this),bindFn(this.updateLabelsAndProgress,this),this.zipEntryTree.zipFileComment)},ze.App.getZipExtractorCreateZipCommentString=function(){return"Created by ZIP Extractor v"+ze.VERSION+" on "+ze.App.getCurrentDateFormatted()},ze.App.getCurrentDateFormatted=function(){var e=new Date,t=""+(e.getMonth()+1),r=""+e.getDate(),i=e.getFullYear();return 2>t.length&&(t="0"+t),2>r.length&&(r="0"+r),[i,t,r].join("-")},ze.App.prototype.createNewEmptyZip=function(e){this.sessionPropMap[ze.App.SESS_PROP.DIDCREATEZIP]=!0,this.closeSession(!0),this.mainAppSubTitle.textContent="Free app for creating ZIP files",this.wasZipFileCreatedLocally=!0,this.showEl(this.zipTable,!0),this.showEl(this.mainScrollableContent,!1),ze.App.prototype.ensureLibLoadedAndCallback(ze.App.CREATEZIPLIB_WINDOW_OBJECT_CHECK,ze.App.CREATEZIPLIB_SCRIPT_NAME,ze.App.APP_STATE.CREATEZIP_LIBRARY_LOADING,bindFn(this.doCreateNewEmptyZip,this,e))},ze.App.prototype.doCreateNewEmptyZip=function(e){var t=ze.App.getZipExtractorCreateZipCommentString(),r=zeCreateZipLib.createEmptyZipBlob(t);this.isInZipEditMode=!0;var i=this;this.readArchive(e||ze.App.DEFAULT_ZIP_FILENAME,r.size,r,function(){i.refreshZipEntryTreeItemState(ze.App.ESTATE.ADDED_TO_ZIP),i.updateSaveZipAndDownloadZipButtonEnablementAfterZipEntryTreeRender()})},ze.App.sanitizeDriveFilename=function(e){return null==e?null:e.replace("/","_").replace("?","_").replace("*","_").replace("+","_").replace(",","_").replace(":","_").replace(";","_").replace("<","_").replace("=","_").replace(">","_").replace("\\","_").replace("[","_").replace("]","_")},ze.App.prototype.addFilesToZip=function(e){if(null!=this.zipEntryTree){var t=this.zipEntryTree&&this.zipEntryTree.originalEntries&&0<this.zipEntryTree.originalEntries.length;t?logImpression("create_zip_add_entries","create_zip","num_files_to_add: "+e.length):logImpression("create_zip_start_new","create_zip","num_files_to_add: "+e.length),this.setAppState(ze.App.APP_STATE.ADDING_FILES_TO_ZIP),this.addFilesToZipOrEncryptZipCancelRequested=!1;for(var r=[],p=0;p<e.length;p++){var o=e[p],n=ze.App.sanitizeDriveFilename(o.name);if(null==this.zipEntryTree.children[n]){var a={name:n,lastModifiedDate:o.lastModifiedDate,uncompressedFileBlob:o};r.push(a)}}zeCreateZipLib.serializeZipFromEntries(this.zipEntryTree.originalEntries,this.zipBlob,r,bindFn(this.renderCreatedZip,this,!1,null,null,!1),bindFn(this.handleZipCreateError,this),bindFn(this.checkAndHandleCreateOrEncryptZipFileCancelled,this,bindFn(this.handleZipCreateError,this)),bindFn(this.handleZipCreateOrEncryptProgress,this),bindFn(this.updateLabelsAndProgress,this),this.zipEntryTree.zipFileComment,this.zipEntryTree.encryptionMode,this.getZipPasswordCharCodeByteArray())}},ze.App.prototype.checkAndHandleCreateOrEncryptZipFileCancelled=function(e){return!!this.addFilesToZipOrEncryptZipCancelRequested&&(e("Adding files to ZIP canceled",!0),!0)},ze.App.prototype.renderCreatedZip=function(e,t,r,i,p){logImpression("create_zip_success","create_zip");var o=bindFn(this.handlePostCreatedZipRenderActions,this,e,t,r,i);this.setAppState(ze.App.APP_STATE.FILES_ADDED_TO_ZIP,p,o,i),this.createdZipSavedToDriveId=null,this.showEl(this.saveZipToDriveButton,!0),this.showEl(this.openZipInDriveButton,!1),this.enableEl(this.openZipInDriveButton,!1)},ze.App.prototype.updateSaveZipAndDownloadZipButtonEnablementAfterZipEntryTreeRender=function(){var e=this.zipEntryTree&&this.zipEntryTree.originalEntries&&0<this.zipEntryTree.originalEntries.length;this.enableEl(this.saveZipToDriveButton,e),this.enableEl(this.downloadZipButton,e),this.enableEl(this.extractButton,e)},ze.App.prototype.handlePostCreatedZipRenderActions=function(e,t,r,i){if(t){var p="Created ZIP file";r&&(p+=" from "+r),this.updateLabelsAndProgress(p),this.setMainIcon(ze.App.MAIN_ICON_TYPE.SUCCESS)}else;this.updateSaveZipAndDownloadZipButtonEnablementAfterZipEntryTreeRender(),this.refreshZipEntryTreeItemState(ze.App.ESTATE.ADDED_TO_ZIP),t&&this.zipEntryTree.originalEntries&&1==this.zipEntryTree.originalEntries.length&&(this.zipEntryTree.originalEntries[0].driveFileId=t),e&&this.zipEntryTree.originalEntries&&0<this.zipEntryTree.originalEntries.length&&this.previewItem(this.zipEntryTree.originalEntries[0],!0),i&&(this.updateLabelsAndProgress("Password set"),this.setMainIcon(ze.App.MAIN_ICON_TYPE.LOCKED))},ze.App.prototype.refreshZipEntryTreeItemState=function(e,t){if(this.zipEntryTree&&(e?this.updateEntryState(this.zipEntryTree,e):this.updateZipEntryUi(this.zipEntryTree,t),this.zipEntryTree.originalEntries))for(var r=0,p;r<this.zipEntryTree.originalEntries.length;r++)p=this.zipEntryTree.originalEntries[r],e?this.updateEntryState(p,e):this.updateZipEntryUi(p,t)},ze.App.prototype.handleZipCreateError=function(e,t){logImpression("create_zip_error","create_zip","error: "+e),t?this.setAppState(ze.App.APP_STATE.ZIP_CREATION_CANCELLED):this.setAppState(ze.App.APP_STATE.ZIP_CREATION_ERROR,e),this.showEl(this.doneEditingZipButton,!0)},ze.App.prototype.handleZipEncryptError=function(e,t){t?(this.setAppState(ze.App.APP_STATE.ZIP_ENCRYPTION_CANCELLED),logImpression("encrypt_zip_canceled","encrypt_zip")):(this.setAppState(ze.App.APP_STATE.ZIP_ENCRYPTION_ERROR,e),logImpression("encrypt_zip_error","encrypt_zip","error: "+e)),this.showEl(this.doneEditingZipButton,!0)},ze.App.prototype.handleZipCreateOrEncryptProgress=function(e,t){var r=Math.round(3+97*(e/t));this.setProgressBarPercent(r)},ze.App.isTextFileType=function(e,t){return!("text"!=t&&"code"!=t&&"csv"!=t)||"README"==(e||"").toUpperCase()||"LICENSE"==(e||"").toUpperCase()||"INSTALL"==(e||"").toUpperCase()||"COPYING"==(e||"").toUpperCase()||"NEWS"==(e||"").toUpperCase()||"THANKS"==(e||"").toUpperCase()},ze.App.isSystemFile=function(e,t,r){if(null==e)return!1;var i=null==t?ze.App.getFileExtension(e).toLowerCase():t;return ze.App.startsWith(e,"._")||ze.App.startsWith(e,"__MACOSX")&&ze.App.stringContains(e,"._")||ze.App.startsWith(e,"__MACOSX")&&r||"ds_store"==i.toLowerCase()||"thumbs.db"==e.toLowerCase()},ze.App.prototype.previewItem=function(e,t){if(this.appState==ze.App.APP_STATE.PASSWORD_REQUIRED&&this.isElementShown(this.checkPasswordButton)){var r=0<this.zipPasswordInput.value.length?this.checkPasswordButton:this.zipPasswordInput;return void this.flashElement(r,"#d00000",2,100)}if(this.appState==ze.App.APP_STATE.PASSWORD_INCORRECT&&this.isElementShown(this.zipPasswordInput))return void this.flashElement(this.zipPasswordInput,"#d00000",2,100);if(this.appState!=ze.App.APP_STATE.PASSWORD_FORMAT_NOT_SUPPORTED&&this.areAllStatesTerminal()&&!this.isSavingToDrive&&!e.directory){logImpression("preview_item","user_button"),this.sessionPropMap[ze.App.SESS_PROP.DIDPREVIEW]=!0;var i=ze.App.getFileExtension(e.name).toLowerCase(),p=!0,o=null,n="";if(ze.App.isSystemFile(e.name,i,e.directory))n="nopreview-"+i,p=!1,o=bindFn(this.renderGenericPreview,this);else{var a=ze.App.getTypesMapKeyNameByExtension(i),s=ze.App.getPreviewableState(a,i);if(2==s)"pdf"==a?(n="pdf",o=bindFn(this.renderPdfPreview,this)):"archive"==a?n="archive-"+i:ze.App.isTextFileType(e.name,a)?(n="text-"+i,o=bindFn(this.renderTextPreview,this)):"image"==a?(n="image-"+i,o=bindFn(this.renderImagePreview,this)):"video"==a?(n="video-"+i,o=bindFn(this.renderVideoPreview,this)):"audio"==a&&(n="audio-"+i,o=bindFn(this.renderAudioPreview,this));else if(3==s)n="drive-"+i,p=!1,o=bindFn(this.renderDrivePreview,this);else{if(t)return;n="generic-"+i,p=!1,o=bindFn(this.renderGenericPreview,this)}}this.previewType=n,logImpression("preview_render","preview","renderer="+n),o?(this.configurePreviewForDisplay(e),this.previewedEntry=e,p?this.decompressPreviewedBlob(e,bindFn(this.previewReadyForRender,this,o,e,!1),bindFn(this.previewDecompressionError,this,e),bindFn(this.previewDecompressionProgressFunction,this,e,!0)):this.previewReadyForRender(o,e,!1)):ze.App.startsWith(this.previewType,"archive")&&ze.ZipLib.decompressEntry(this.zipBlob,e,!0,bindFn(this.jumpToZipSuccess,this,e),bindFn(this.jumpToZipError,this,e),bindFn(this.handleGeneralArchiveReadProgress,this),this.getZipPasswordCharCodeByteArray())}},ze.App.prototype.configurePreviewForDisplay=function(e){this.configurePreviewHeader(e),this.configurePreviewForLoading(e),this.showEl(this.zipTable,!1),this.showEl(this.preview,!0)},ze.App.prototype.getZipPasswordCharCodeByteArray=function(){var e=[];try{for(var t=0;t<this.zipPasswordInput.value.length;t++)e.push(255&this.zipPasswordInput.value.charCodeAt(t))}catch(e){}return e},ze.App.prototype.jumpToZipSuccess=function(e,t){this.closeSession(),this.closePreview(),this.readArchive(e.name,t.size,t)},ze.App.prototype.jumpToZipError=function(e,t){logImpression("jump_to_zip_error","zip","error: "+t),this.configurePreviewForDisplay(e),this.setProgressBarPercent(100),this.renderErrorPreview(e,t)},ze.App.prototype.previewDecompressionError=function(e,t){logImpression("preview_render_error","preview","decompression error: "+t),logImpression("preview_decompress_error",this.currentArchiveTypeString.toLowerCase(),t),this.configurePreviewActionButtonsForWorkingOperation(!1),this.hideAllPreviewDivs(),this.renderErrorPreview(e,t)},ze.App.prototype.renderErrorPreview=function(e,t){this.showEl(this.previewErrorContent,!0),this.showEl(this.previewDownloadButton,!1),this.showEl(this.previewCloseButton,!0),this.showEl(this.previewNextButton,!0),this.showEl(this.previewPrevButton,!0),this.showEl(this.previewOpenInDriveButton,!1),this.showEl(this.previewSaveToDriveButton,!1),this.enableEl(this.previewNextButton,!0),this.enableEl(this.previewPrevButton,!0),this.setPreviewProgressBarPercent(100),this.previewErrorCaption.textContent="An error occurred when extracting this item from the "+this.currentArchiveTypeString+" file",this.previewErrorDetails.textContent=t},ze.App.prototype.getBlobMimeTypeByExtension=function(e){if(null==e)return"";if(""===e)return"";var t=ze.App.EXTENSION_TO_MIMETYPE_MAP[e];return t||""},ze.App.prototype.previewReadyForRender=function(e,t,r){this.updatePreviewFilenameLabel(),this.showEl(this.previewDownloadButton,!0);var i=null!=t.driveFileId;this.configurePreviewActionButtonsForWorkingOperation(!1,!1,i),e(t,this.previewedBlob),r||this.handlePreviewRenderComplete()},ze.App.prototype.handlePreviewRenderComplete=function(){this.setPreviewProgressBarPercent(100)},ze.App.prototype.renderImagePreview=function(e,t){var r=window.URL||window.webkitURL,i=ze.App.getFileExtension(e.name),p=this;if("svg"==i){var o=new FileReader;o.addEventListener("loadend",function(){var t=o.result;e.cachedObjectUrl=t;var r=t.split(",")[1];p.previewImg.src="data:image/svg+xml;base64,"+r,p.showEl(p.previewImageContent,!0)}),o.readAsDataURL(t)}else if("heic"==i||"heif"==i)this.showEl(this.previewSpinner,!0),this.showEl(this.previewItemIcon,!1),"heic2any"in window?ze.App.execLater(bindFn(this.renderHeicPreview,this,e,t)):this.loadScriptAsync(ze.App.HEIC_SCRIPT_NAME,function(){ze.App.execLater(bindFn(p.renderHeicPreview,p,e,t))});else{var n=r.createObjectURL(t);e.cachedObjectUrl=n,this.previewImg.src=n,this.showEl(this.previewImageContent,!0)}},ze.App.prototype.renderHeicPreview=function(e,t){var r=window.URL||window.webkitURL;try{var i=heic2any({blob:t,toType:"image/jpeg",quality:.8}),p=this;i.then(function(t){var i=r.createObjectURL(t);e.cachedObjectUrl=i,p.previewImg.src=i,p.showEl(p.previewImageContent,!0),p.showEl(p.previewSpinner,!1),p.showEl(p.previewItemIcon,!0)})}catch(e){logImpression("heic_error","preview","error: "+e),this.showEl(this.previewSpinner,!1),this.showEl(this.previewItemIcon,!0)}},ze.App.prototype.renderTextPreview=function(e,t){var r=new FileReader,i=this;r.addEventListener("loadend",function(t){var r="";t.srcElement?r=t.srcElement.result:t.target&&(r=t.target.result);var p=!1,o=2e4,n="";if(r&&r.length>o?(p=!0,n=r.substring(0,o)):n=r,i.previewTxt.textContent=n,i.showEl(i.previewTextContent,!0),i.previewTextContent.scrollTop=0,p){100000>r.length&&i.prettyPrintTextPreview(!1),ze.App.execLater(bindFn(i.handleSecondPhasePreviewTextLoad,i,r,e),void 0,500)}else i.prettyPrintTextPreview(!0)}),r.readAsText(t)},ze.App.prototype.handleSecondPhasePreviewTextLoad=function(e,t){this.previewedEntry!=t||(this.previewTxt.textContent=e,this.prettyPrintTextPreview(!0))},ze.App.prototype.prettyPrintTextPreview=function(e){if(null!=this.previewedEntry){var t=ze.App.getFileExtension(this.previewedEntry.name);if("txt"!=t&&"log"!=t&&"md"!=t&&""!=t){var r="PR"in window;if(r){100000>this.previewTxt.textContent.length&&(this.previewTxt.classList.remove("prettyprinted"),e?ze.App.execLater(bindFn(PR.prettyPrint,this),void 0,0):PR.prettyPrint())}}}},ze.App.prototype.renderPdfPreview=function(e,t){var r=window.URL||window.webkitURL,i=new Blob([t],{type:"application/pdf"}),p=r.createObjectURL(i);e.cachedObjectUrl=p,this.previewPdf.setAttribute("src",p),this.showEl(this.previewPdfContent,!0)},ze.App.prototype.renderDrivePreview=function(e){var t=e.driveFileId;null==t?(isAuthorized()?this.showEl(this.previewSaveToDriveDetails,!1):this.showEl(this.previewSaveToDriveDetails,!0),this.showEl(this.previewDriveContent,!0),this.showEl(this.previewDriveSaveToDriveFirst,!0),this.previewDrv&&this.showEl(this.previewDrv,!1),this.handlePreviewRenderComplete(),this.showEl(this.previewSpinner,!1),this.showEl(this.previewItemIcon,!0)):(this.showEl(this.previewDriveSaveToDriveFirst,!1),this.showEl(this.previewSaveToDriveDetails,!1),this.doEmbeddedDrivePreview(t),this.showEl(this.previewDriveContent,!0))},ze.App.prototype.doEmbeddedDrivePreview=function(e){this.showEl(this.previewSpinner,!0),this.showEl(this.previewItemIcon,!1),this.previewDrv?this.showEl(this.previewDrv,!0):(this.previewDrv=document.createElement("iframe"),this.previewDrv.className="previewDrv",this.previewDriveContent.appendChild(this.previewDrv)),this.previewDrv.onload=bindFn(this.previewDriveEmbeddedViewerLoaded,this),this.previewDrv.src="https://docs.google.com/file/d/"+e+"/preview?authuser="+CURRENT_AUTH_USER},ze.App.prototype.previewDriveEmbeddedViewerLoaded=function(){this.handlePreviewRenderComplete(),this.showEl(this.previewOpenInDriveButton,!0),this.showEl(this.previewSaveToDriveButton,!1),this.showEl(this.previewSpinner,!1),this.showEl(this.previewItemIcon,!0),this.previewDrv.onload=null},ze.App.prototype.renderVideoPreview=function(e,t){var r=window.URL||window.webkitURL,i=r.createObjectURL(t);e.cachedObjectUrl=i,this.previewVid.src=i,this.showEl(this.previewVideoContent,!0)},ze.App.prototype.renderGenericPreview=function(){this.noPreviewIcon.textContent=this.previewItemIconImg.textContent,this.showEl(this.previewGenericContent,!0)},ze.App.prototype.renderAudioPreview=function(e,t){var r=window.URL||window.webkitURL,i=r.createObjectURL(t);e.cachedObjectUrl=i,this.previewAud.src=i,this.showEl(this.previewAudioContent,!0)},ze.App.prototype.configurePreviewHeader=function(e){this.previewItemFilename.textContent=e.name||"",this.updatePreviewFilenameLabel(),this.previewItemIconImg.textContent=ze.App.getMaterialIconIdForEntry(e),this.previewItemSize.textContent=ze.App.formatSize(e.uncompressedSize),this.previewItemFilename.innerHTML+=" <small>("+this.previewItemSize.textContent+")</small>"},ze.App.prototype.configurePreviewForLoading=function(){this.setPreviewProgressBarPercent(0)},ze.App.prototype.previewDecompressionProgressFunction=function(e,t,r,i){var p=Math.round(3+97*(r/i));this.setPreviewProgressBarPercent(p),t&&(this.previewZipFilenameAndStatus.textContent="Opening... ("+p+"%)")},ze.App.prototype.hideAllPreviewDivs=function(){this.showEl(this.previewTextContent,!1),this.showEl(this.previewImageContent,!1),this.showEl(this.previewVideoContent,!1),this.showEl(this.previewPdfContent,!1),this.showEl(this.previewAudioContent,!1),this.showEl(this.previewGenericContent,!1),this.showEl(this.previewErrorContent,!1),this.showEl(this.previewDriveContent,!1)},ze.App.prototype.resetPreview=function(){if(this.hideAllPreviewDivs(),this.clearAllPreviewObjects(),this.previewedEntry&&this.previewedEntry.cachedObjectUrl){var e=window.URL||window.webkitURL;try{e.revokeObjectURL(this.previewedEntry.cachedObjectUrl)}catch(e){logImpression("revokeObjectURL()","misc",e)}}this.previewedEntry=null,this.previewedBlob=null,this.previewType=null},ze.App.prototype.clearAllPreviewObjects=function(){this.previewTxt.textContent="",this.previewImg.src="",this.previewDrv&&(this.previewDrv.src="about:blank");try{this.previewPdf.src="",this.previewPdf.removeAttribute("src");var e=this.previewPdf.cloneNode(!0);e.setAttribute("src",""),this.previewPdf.parentNode.replaceChild(e,this.previewPdf),this.previewPdf=e}catch(e){}try{this.previewAud.pause(),this.previewAud.currentTime=0,this.previewAud.src="",this.previewAud.removeAttribute("src")}catch(e){}try{this.previewVid.pause(),this.previewVid.currentTime=0,this.previewAud.src="",this.previewAud.removeAttribute("src")}catch(e){}},ze.App.prototype.flashTimer=null,ze.App.prototype.flashElement=function(e,t,r,i,p,o){clearTimeout(this.flashTimer);var n=null==p?e.style.backgroundColor:p,a=o||0,s=this,E=function(){e.style.backgroundColor=0==a%2?t:n,a++,a<2*r&&(s.flashTimer=setTimeout(bindFn(s.flashElement,s,e,t,r,i,n,a),i))};E()},ze.App.INDENT_PX=24,ze.App.BASE_INDENT_PX=0,ze.App.checkboxIdCounter=0,ze.App.UNCHECKED_COLOR="#888",ze.App.clearTable=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},ze.App.disableCheckboxesForChildren=function(e){for(var t in e.children){var r=e.children[t];ze.App.getCheckboxButtonForEntry(r).disabled=!0,r.directory&&ze.App.disableCheckboxesForChildren(r)}},ze.App.generateZipTable=function(e,t,r){ze.App.execLater(bindFn(ze.App.generateZipTableInternal,null,e,t),r)},ze.App.generateZipTableInternal=function(e,t){ze.App.generateZipTableChildren(e,t,0,0);var r=e.lastElementChild;r&&r.classList.add("lastZipTableRow")},ze.App.generateZipTableChildren=function(e,t,r,i){for(var p in t.children){var o=t.children[p],n=ze.App.generateFileTableRow(o,r);o.tableRow=n,o.tableRowIndex=i++,e.appendChild(n),o.directory&&(i=ze.App.generateZipTableChildren(e,o,r+1,i))}return i},ze.App.handleRowClick=function(t,r){var e="";if(r&&r.target&&r.target.className&&(e=r.target.className),e.indexOf){if(-1!=e.indexOf("button"))return;if(-1!=e.indexOf("icon"))return;if(-1!=e.indexOf("zipStatusIcon"))return;if(-1!=e.indexOf("statusCell"))return}else return;ze.App.previewItem(t)},ze.App.openEntryInDrive=function(e){ze.App.openItemInDrive(e.driveFileId)},ze.App.openItemInDrive=function(e){var t=window.open("https://drive.google.com/open?id="+e,"_blank");t&&t.focus()},ze.App.previewItem=function(e){MAINAPP.previewItem(e)},ze.App.isEntryDownloadable=function(e){return!e.directory},ze.App.generateFileTableRow=function(t,r){var i=document.createElement("div");i.className=t.directory?"zipTableRow directoryRow":"zipTableRow",i.onclick=bindFn(ze.App.handleRowClick,this,t),i.entry=t;var p=document.createElement("div");i.appendChild(p),p.className=t.directory?"zipTableCell filenameCell directoryCell":"zipTableCell filenameCell";var o=document.createElement("div");i.appendChild(o),o.className="zipTableCell sizeCell";var n=document.createElement("div");i.appendChild(n),n.className="zipTableCell statusCell";var a=document.createElement("div");n.appendChild(a),a.className="statusCellIcon",a.style.display="none";var s=document.createElement("i");a.appendChild(s),s.className="material-icons zipStatusIcon",s.tabIndex=0,s.textContent="add";var E=ze.App.createSpinner();n.appendChild(E);var d=ze.App.createMaterialCheckbox(!0);n.appendChild(d),d.onclick=function(r){var e=ze.App.isCheckboxIconButtonChecked(r.target);ze.App.setCheckboxIconButtonChecked(d,!e),ze.App.handleCheckboxClick(t,!e)},p.style.paddingLeft=ze.App.BASE_INDENT_PX+ze.App.INDENT_PX*r+"px";var l=document.createElement("div");l.className="tableRowName",l.textContent=t.name;var A=document.createElement("i");return p.appendChild(A),A.className="material-icons tableRowIcon",A.tabIndex=-1,A.textContent=ze.App.getMaterialIconIdForEntry(t),p.appendChild(l),o.textContent=t.directory?"":ze.App.formatSize(t.uncompressedSize),i},ze.App.createSpinner=function(){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttributeNS(null,"class","spinner zipStatusSpinner"),e.setAttributeNS(null,"width","18px"),e.setAttributeNS(null,"height","18px"),e.setAttributeNS(null,"viewBox","0 0 66 66"),e.style.display="none";var t=document.createElementNS("http://www.w3.org/2000/svg","circle");return t.setAttributeNS(null,"class","spinnerSvgPath"),t.setAttributeNS(null,"fill","none"),t.setAttributeNS(null,"stroke-width","6"),t.setAttributeNS(null,"stroke-linecap","round"),t.setAttributeNS(null,"cx","33"),t.setAttributeNS(null,"cy","33"),t.setAttributeNS(null,"r","30"),e.appendChild(t),e},ze.App.createMaterialCheckbox=function(e,t){var r=document.createElement("button");r.className="ze-button ze-icon-button ze-button--colored zipEntryCheckboxButton",t&&(r.id=t);var i=document.createElement("i");return i.className="material-icons ze-icon-button-icon ze-checkbox-button",r.appendChild(i),ze.App.setCheckboxIconButtonChecked(r,e),r},ze.App.getEntryStatusIconMaterialId=function(e,t){return e===ze.App.ESTATE.DEFAULT?t?"lock":"__":e===ze.App.ESTATE.ADDED_TO_ZIP?t?"lock":"check_circle_outline":e===ze.App.ESTATE.CREATED_ZIP_SAVED_TO_DRIVE?"check_circle":e===ze.App.ESTATE.QUEUED?"cloud_queue":e===ze.App.ESTATE.QUEUED_PENDING_RETRY?"info_outline":e===ze.App.ESTATE.REQUEUED_AFTER_ERROR?"cloud_queue":e===ze.App.ESTATE.SKIPPED?"cloud_off":e===ze.App.ESTATE.PENDING?"cloud_upload":e===ze.App.ESTATE.WAITING?"cloud":e===ze.App.ESTATE.DECOMPRESSION_COMPLETE?"cloud_queue":e===ze.App.ESTATE.BEGIN_UPLOAD?"backup":e===ze.App.ESTATE.UPLOAD_PROGRESS?"cloud_upload":e===ze.App.ESTATE.UPLOAD_ERROR?"warning":e===ze.App.ESTATE.DECOMPRESSION_ERROR?"warning":e===ze.App.ESTATE.UPLOAD_ALL_BYTES_TRANSFERRED?"cached":e===ze.App.ESTATE.UPLOAD_COMPLETE?"cloud_done":e===ze.App.ESTATE.CANCELED?"error_outline":e===ze.App.ESTATE.UPLOAD_ABORTED?"error_outline":"add"},ze.App.SIZE_BYTE_UNITS=["KB","MB","GB","TB"],ze.App.formatSize=function(e){if(null==e)return"? KB";if(0===e)return"0 KB";if(1e3>e)return e.toString()+" B";var t=0;do e/=1024,t++;while(1024<e);var r=Math.max(e,.1),p;return p=1==t?Math.ceil(r):Math.round(r*Math.pow(10,1))/Math.pow(10,1),p+" "+ze.App.SIZE_BYTE_UNITS[t-1]},ze.App.TYPES_MAP={image:{"*":"photo",bmp:2,jpg:2,gif:2,png:2,tif:2,tiff:2,jpeg:2,svg:2,raw:2,webp:2,ico:2,heic:2,heif:2},text:{"*":"description",txt:2,rtf:2,htm:2,html:2,mhtml:2,mxml:2,xml:2,log:2,tex:2,cls:2,bak:2,rels:2,bat:2,stp:2,ini:2,inf:2,mbox:2,msg:2,lic:2,eml:2,text:2,latex:2,conf:2,smi:2,sub:2,srt:2,asc:2,lst:2,bas:2,reg:2,manifest:2,ascii:2,yml:2,eng:2,xsl:2,xslt:2,enc:2,ps1:2,ino:2,url:2,vcf:2,aux:2,toc:2,properties:2},code:{"*":"code",c:2,h:2,m:2,md:2,cc:2,cs:2,pl:2,pm:2,rb:2,sh:2,ts:2,tsx:2,js:2,css:2,scss:2,java:2,py:2,cpp:2,hpp:2,php:2,perl:2,ipynb:2,asp:2,aspx:2,jsp:2,json:2,yaml:2,bsh:2,csh:2,cyc:2,cv:2},csv:{"*":"grid_on",csv:2},video:{"*":"videocam",mp4:2,ogv:2,mpg:2,mpeg:2,mov:2,webm:2,m4v:2,mkv:2,"3gp":3,wmv:1,avi:3,flv:3},audio:{"*":"audiotrack",mp3:2,m4a:2,wav:2,flac:2,aac:2,mid:2,ogg:2,oga:2,opus:2,weba:2,aif:1,aiff:1},font:{"*":"font_download",ttf:3,otf:3},pdf:{"*":"picture_as_pdf",pdf:2,xps:3},drawing:{"*":"category",dwg:3,odg:3,eps:3,psd:3,ps:3,ai:3,dxf:3},archive:{"*":"business_center",zip:2,gz:2,whl:2,jar:2,tar:2,tgz:2,rar:2,bzip:2,bzip2:2,bz2:2,tbz:2,lzma:2,tlz:2,"7z":2},office:{"*":"assignment",ppt:3,pptx:3,pptm:1,doc:3,docm:3,docx:3,xls:3,xlsx:3,xlsm:3,odt:3,ods:3,odp:3},executable:{"*":"dns",exe:1}},ze.App.TYPES_MAP_KEYS=Object.keys(ze.App.TYPES_MAP),ze.App.getMaterialIconIdForEntry=function(e){if(e.directory)return"folder";var t=e.name;if(!t)return"error_outline";var r=ze.App.getFileExtension(t);if(ze.App.startsWith(e.name,"._")||!r||""===r)return"insert_drive_file";var i=ze.App.getTypesMapEntryByExtension(r);return null==i?"insert_drive_file":i["*"]},ze.App.getPreviewableState=function(e,t){var r=ze.App.getTypesMapEntryByKeyName(e);return null==r?null:r[t]},ze.App.getTypesMapEntryByKeyName=function(e){return null==e?null:ze.App.TYPES_MAP[e]},ze.App.getTypesMapEntryByExtension=function(e){var t=ze.App.getTypesMapKeyNameByExtension(e);return ze.App.getTypesMapEntryByKeyName(t)},ze.App.getTypesMapKeyNameByExtension=function(e){for(var t=0;t<ze.App.TYPES_MAP_KEYS.length;t++)if(null!=ze.App.TYPES_MAP[ze.App.TYPES_MAP_KEYS[t]][e])return ze.App.TYPES_MAP_KEYS[t];return null},ze.App.setEntryChecked=function(e,t,r){var i=ze.App.getCheckboxButtonForEntry(e);ze.App.setCheckboxIconButtonChecked(i,t,r),ze.App.updateEntryRowStyle(e,t)},ze.App.setCheckboxIconButtonChecked=function(e,t,r){e.firstElementChild.textContent=t?r?"indeterminate_check_box":"check_box":"check_box_outline_blank"},ze.App.isCheckboxIconButtonChecked=function(e){var t="i"==e.tagName.toLowerCase()?e:e.firstElementChild;return"check_box"==t.textContent||"indeterminate_check_box"==t.textContent},ze.App.updateEntryRowStyle=function(e,t){e.tableRow.style.color=t?"inherit":ze.App.UNCHECKED_COLOR,this.getFilenameCell(e).style.textDecoration=t?"inherit":"line-through"},ze.App.handleCheckboxClick=function(e,t){if(ze.App.updateEntryRowStyle(e,t),t){ze.App.setParentEntriesCheckState(e,!0,!0)}else ze.App.setParentEntriesCheckState(e,!0,!0);!t&&e.directory&&ze.App.setChildEntriesCheckState(e,!1)},ze.App.setChildEntriesCheckState=function(e,t){for(var r in e.children){var i=e.children[r];ze.App.setEntryChecked(i,t),i.directory&&ze.App.setChildEntriesCheckState(i,t)}},ze.App.setParentEntriesCheckState=function(e,t){var r=e.parentEntry;r&&!r.root&&(ze.App.setEntryChecked(r,t),ze.App.setParentEntriesCheckState(r,t))},ze.App.getCheckboxButtonForEntry=function(e){return e.tableRow.children[2].children[2]},ze.App.isChecked=function(e){return ze.App.isCheckboxIconButtonChecked(ze.App.getCheckboxButtonForEntry(e))},ze.App.translateEntryState=function(e,t){return e===ze.App.ESTATE.QUEUED?"Queued":e===ze.App.ESTATE.QUEUED_PENDING_RETRY?"Queued (Pending resolution of error on parent folder)":e===ze.App.ESTATE.SKIPPED?"Skipped":e===ze.App.ESTATE.PENDING?"Pending creation of parent folder":e===ze.App.ESTATE.WAITING?"Waiting":e===ze.App.ESTATE.BEGIN_DECOMPRESSION?"Decompressing File...":e===ze.App.ESTATE.DECOMPRESSION_PROGRESS?"Decompressing File...":e===ze.App.ESTATE.DECOMPRESSION_COMPLETE?"Decompressed File":e===ze.App.ESTATE.BEGIN_UPLOAD?"Extracting to Google Drive...":e===ze.App.ESTATE.UPLOAD_PROGRESS?"Extracting to Google Drive...":e===ze.App.ESTATE.UPLOAD_ERROR?"Extraction to Drive Error ("+t.message+")":e===ze.App.ESTATE.DECOMPRESSION_ERROR?"Decompression Error ("+t.message+")":e===ze.App.ESTATE.UPLOAD_ALL_BYTES_TRANSFERRED?"Finishing...":e===ze.App.ESTATE.UPLOAD_COMPLETE?"Extracted to Google Drive":e===ze.App.ESTATE.CANCELED?"Canceled":e===ze.App.ESTATE.UPLOAD_ABORTED?"Aborted":""},ze.App.getFilenameCell=function(e){return e.tableRow.children[0].children[1]},ze.App.getIconCell=function(e){return e.tableRow.children[0].children[0]},ze.App.prototype.showPicker=function(e,t,r,i){var p=bindFn(this.showPickerInternal,this,e,t,r,i);gapi.load("picker",{callback:p})},ze.App.prototype.showPickerInternal=function(e,t,r,i){t?this.showFolderPicker(bindFn(this.pickerFolderChosenInternalCallback,this,e)):this.showFilePicker(bindFn(this.pickerFileChosenInternalCallback,this,e),r,i)},ze.App.prototype.pickerFileChosenInternalCallback=function(e,t){if(!(t.action==google.picker.Action.PICKED))logImpression("show_file_picker","picker","other_data_action: "+t.action);else if(t.docs&&0<t.docs.length){logImpression("show_file_picker","picker","file_picked");var r=t.docs[0];e(r)}else logImpression("show_file_picker","picker","no_file_picked_in_data")},ze.App.prototype.pickerFolderChosenInternalCallback=function(e,t){if(!(t.action==google.picker.Action.PICKED))logImpression("show_folder_picker","picker","other_data_action: "+t.action);else if(t.docs&&0<t.docs.length){logImpression("show_folder_picker","picker","folder_picked");var r=t.docs[0];e(r)}else logImpression("show_folder_picker","picker","no_folder_picked_in_data")},ze.App.prototype.showFilePicker=function(e,t,r){logImpression("show_file_picker","picker","show");var i=new google.picker.DocsView(google.picker.ViewId.DOCS).setSelectFolderEnabled(!1).setIncludeFolders(!1).setMode(google.picker.DocsViewMode.LIST).setMimeTypes("application/zip,application/x-zip,application/x-zip-compressed,application/x-7z-compressed,application/tar,application/x-tar,application/rar,application/x-rar,application/x-rar-compressed,application/vnd.rar,application/x-gzip,application/gzip,application/gzip-compressed,application/x-gzip-compressed,application/x-gtar,application/x-tgz,application/tar+gzip,application/x-gtar-compressedapplication/bzip2,application/x-bzip,application/x-bzip2,application/x-bz2");t&&i.setParent(t);var p=new google.picker.PickerBuilder().enableFeature(google.picker.Feature.NAV_HIDDEN).setAppId(APP_CONFIG.appId).setOAuthToken(getAccessToken()).setDeveloperKey(APP_CONFIG.apiKey).setCallback(e).addView(i).setTitle(r||"Open ZIP file from Google Drive").build();p.setVisible(!0)},ze.App.prototype.showFolderPicker=function(e){logImpression("show_folder_picker","picker","show");var t=new google.picker.DocsView(google.picker.ViewId.DOCS).setSelectFolderEnabled(!0).setIncludeFolders(!0).setMode(google.picker.DocsViewMode.LIST).setMimeTypes(ze.Dapi.MimeType.FOLDER),r=detectDevice(),i="phone"==r?"Select a Google Drive folder":"Select a Google Drive folder for extracted files",p=new google.picker.PickerBuilder().enableFeature(google.picker.Feature.NAV_HIDDEN).setAppId(APP_CONFIG.appId).setOAuthToken(getAccessToken()).setDeveloperKey(APP_CONFIG.apiKey).setCallback(e).addView(t).setTitle(i).build();p.setVisible(!0)},ze.App.prototype.executeSession=function(e){e&&(this.sessionHasBeenRetried=!0),this.isSessionAborted=!1,this.highestZipEntryIndexUploadedInSession=0,this.fileTableContainer.scrollTop=0,this.queueEntry(this.zipEntryTree),this.queueEntryChildren(this.zipEntryTree),this.currentSessionProgress=0,this.totalSessionSize=ze.App.computeSessionSize(this.zipEntryTree),this.updateSecondaryProgressString(),this.asyncWorkQueue.init(),ze.App.entryIsUploadable(this.zipEntryTree)?(this.asyncWorkQueue.enqueue(this.generateWorkItem(this.zipEntryTree,this.parentFolderId)),this.updateEntryState(this.zipEntryTree,ze.App.ESTATE.PENDING),this.runWorkQueue()):this.processEntryTreeChildren(this.zipEntryTree,this.zipEntryTree.driveFileId,e)},ze.App.prototype.abortSession=function(){this.isSessionAborted=!0,this.asyncWorkQueue.stop(),ze.Dapi.abortAllRequests(),this.cancelAllUnstartedEntries(),this.checkForExtractionComplete()},ze.App.prototype.closeSession=function(e){this.isSessionClosed,ze.App.resetPageTitle(),this.asyncWorkQueue.close(),this.zipEntryStateMap={},this.zipEntriesInProcessMap={},this.totalSessionSize=0,this.currentSessionProgress=0,this.isSessionClosed=!0,this.highestZipEntryIndexUploadedInSession=0,this.isInZipEditMode=!1,this.wasZipFileCreatedLocally=!1,this.zipFilename=null,this.zipEntryTree=null,this.zipBlob=null,this.lastDownloadId=null,this.hasDownloadBeenAutoRetried=!1,this.isSessionAborted=!1,this.fileIdToOpen=null,this.parentFolderId=null,this.createdZipSavedToDriveId=null,this.isSavingToDrive=!1,this.wasSaveToDriveCancelled=!1,this.addFilesToZipOrEncryptZipCancelRequested=!1,this.doResumeOpenFromGoogleDriveAfterManualAuth=!1,this.doResumeExtractToGoogleDriveAfterManualAuth=!1,this.doResumeSavePreviewItemToGoogleDriveAfterManualAuth=!1,this.doResumeSaveZipToDriveAfterManualAuth=!1,this.createZipFromFileAssociatedExtension=null,this.currentAutodetectedEncoding=null,clearState(),ze.App.clearTable(this.fileTableItems),this.startNewManualSession(e)},ze.App.prototype.processEntryTreeChildren=function(e,t,r){for(var i in e.children){var p=e.children[i];this.isSessionAborted?this.updateEntryState(p,ze.App.ESTATE.CANCELED):ze.App.entryIsUploadable(p)?(this.asyncWorkQueue.enqueue(this.generateWorkItem(p,t)),this.updateEntryState(p,ze.App.ESTATE.PENDING)):p.directory&&p.state==ze.App.ESTATE.UPLOAD_COMPLETE&&this.processEntryTreeChildren(p,p.folder.id,r)}this.isSessionAborted||this.runWorkQueue()},ze.App.computeSessionSize=function(e){return ze.App.getEntrySize(e)+ze.App.computeChildEntriesSize(e)},ze.App.computeChildEntriesSize=function(e){var t=0;for(var r in e.children){var i=e.children[r],p=ze.App.getEntrySize(i),o=i.directory?ze.App.computeChildEntriesSize(i):0;t+=p+o}return t},ze.App.getEntrySize=function(e){if(!ze.App.entryIsUploadable(e))return 0;var t=0;return t=e.directory?0:e.uncompressedSize,t+ze.App.ENTRY_OVERHEAD_BYTES},ze.App.prototype.queueEntry=function(e){var t=this.isTableEntrySelected(e),r="";e.state==ze.App.ESTATE.DEFAULT||e.state==ze.App.ESTATE.CANCELED||e.state==ze.App.ESTATE.UPLOAD_ABORTED||e.state==ze.App.ESTATE.CREATED_ZIP_SAVED_TO_DRIVE||e.state==ze.App.ESTATE.ADDED_TO_ZIP?(r=t?ze.App.ESTATE.QUEUED:ze.App.ESTATE.SKIPPED,this.updateEntryState(e,r)):e.state==ze.App.ESTATE.UPLOAD_ERROR?(r=t?ze.App.ESTATE.REQUEUED_AFTER_ERROR:ze.App.ESTATE.SKIPPED,this.updateEntryState(e,r)):e.state==ze.App.ESTATE.REQUEUED_AFTER_ERROR&&(r=t?ze.App.ESTATE.QUEUED:ze.App.ESTATE.SKIPPED,this.updateEntryState(e,r))},ze.App.prototype.queueEntryChildren=function(e){for(var t in e.children){var r=e.children[t];this.queueEntry(r),r.directory&&this.queueEntryChildren(r)}},ze.App.prototype.cancelAllUnstartedEntries=function(){this.cancelUnstartedEntry(this.zipEntryTree),this.cancelUnstartedChildEntries(this.zipEntryTree)},ze.App.prototype.cancelUnstartedEntry=function(e){ze.App.entryIsTerminal(e)||ze.App.entryIsInProgress(e)||this.updateEntryState(e,ze.App.ESTATE.CANCELED)},ze.App.prototype.cancelUnstartedChildEntries=function(e){for(var t in e.children){var r=e.children[t];this.cancelUnstartedEntry(r),r.directory&&this.cancelUnstartedChildEntries(r)}},ze.App.prototype.runWorkQueue=function(){this.asyncWorkQueue.run(bindFn(this.workQueueExecutionComplete,this))},ze.App.prototype.updateEntryState=function(e,t,r,i){e.error=r||"",e.message=i||"",this.updateZipEntryStateMap(e,t),e.state=t,this.updateZipEntryUi(e)},ze.App.prototype.incrementSessionProgress=function(e,t){if(this.isSessionAborted)return-1;this.currentSessionProgress+=t;var r=this.handleProgress(this.currentSessionProgress,this.totalSessionSize);return r},ze.App.prototype.updateZipEntryStateMap=function(e,t){var r=e.state,i=e.path,p=this.zipEntryStateMap[t];p||(p={},this.zipEntryStateMap[t]=p),p[i]=e;var o=this.zipEntryStateMap[r];o&&o.hasOwnProperty(i)&&delete o[i],ze.App.isTerminalState(t)?delete this.zipEntriesInProcessMap[i]:this.zipEntriesInProcessMap[i]=e},ze.App.prototype.areAllStatesTerminal=function(){return 0===Object.keys(this.zipEntriesInProcessMap).length},ze.App.entryIsTerminal=function(e){return ze.App.isTerminalState(e.state)},ze.App.isTerminalState=function(e){return e==ze.App.ESTATE.UPLOAD_COMPLETE||e==ze.App.ESTATE.UPLOAD_ERROR||e==ze.App.ESTATE.DECOMPRESSION_ERROR||e==ze.App.ESTATE.SKIPPED||e==ze.App.ESTATE.CANCELED||e==ze.App.ESTATE.QUEUED_PENDING_RETRY||e==ze.App.ESTATE.UPLOAD_ABORTED||e==ze.App.ESTATE.ADDED_TO_ZIP||e==ze.App.ESTATE.CREATED_ZIP_SAVED_TO_DRIVE||e==ze.App.ESTATE.DEFAULT},ze.App.entryIsUploadable=function(e){var t=e.state;return t==ze.App.ESTATE.QUEUED||t==ze.App.ESTATE.QUEUED_PENDING_RETRY||t==ze.App.ESTATE.REQUEUED_AFTER_ERROR||t==ze.App.ESTATE.UPLOAD_ERROR},ze.App.entryIsCanceled=function(e){var t=e.state;return t==ze.App.ESTATE.CANCELED||t==ze.App.ESTATE.UPLOAD_ABORTED},ze.App.entryIsInProgress=function(e){var t=e.state;return t==ze.App.ESTATE.BEGIN_UPLOAD||t==ze.App.ESTATE.UPLOAD_PROGRESS||t==ze.App.ESTATE.UPLOAD_ALL_BYTES_TRANSFERRED},ze.App.prototype.generateWorkItem=function(e,t){e.parentId=t;var r=e.directory?this.processFolder:this.processFile;return bindFn(r,this,e,t)},ze.App.prototype.processFolder=function(e,t,r){if(this.isSessionAborted)return void this.updateEntryState(e,ze.App.ESTATE.CANCELED);e.uploadPrev=0,e.uploadCurrent=0,e.uploadTotal=0,this.updateEntryState(e,ze.App.ESTATE.BEGIN_UPLOAD);var i=ze.Dapi.generateCallbacks(bindFn(this.folderInsertComplete,this,e,r,bindFn(this.processEntryTreeChildren,this,e)),bindFn(this.folderInsertError,this,e,r),void 0,bindFn(this.folderInsertAborted,this,e,r));ze.Dapi.createFolder(i,e.name,t)},ze.App.prototype.processFile=function(e,t,r){return this.isSessionAborted?void this.updateEntryState(e,ze.App.ESTATE.CANCELED):void(e.decompressionPrev=0,e.decompressionCurrent=0,e.decompressionTotal=0,e.uploadPrev=0,e.uploadCurrent=0,e.uploadTotal=0,this.updateEntryState(e,ze.App.ESTATE.BEGIN_DECOMPRESSION),logImpression("decompress_start",this.currentArchiveTypeString.toLowerCase()),ze.ZipLib.decompressEntry(this.zipBlob,e,!0,bindFn(this.decompressionComplete,this,e,t,r),bindFn(this.uploadDecompressionError,this,e,r),bindFn(this.handleDecompressionProgress,this,e),this.getZipPasswordCharCodeByteArray()))},ze.App.prototype.uploadDecompressionError=function(e,t,r){logImpression("decompress_error",this.currentArchiveTypeString.toLowerCase(),r);this.updateEntryState(e,ze.App.ESTATE.DECOMPRESSION_ERROR,"Decompression Error",r),this.incrementSessionProgress(e,ze.App.TRANSFER_DECOMPRESS_MULTIPLIER*e.uncompressedSize),this.incrementSessionProgress(e,ze.App.ENTRY_OVERHEAD_BYTES),t(),this.checkForExtractionComplete()},ze.App.prototype.handleDecompressionProgress=function(e,t,r){this.isSessionAborted||(e.decompressionPrev=e.decompressionCurrent?e.decompressionCurrent:0,e.decompressionCurrent=t,e.decompressionTotal=r)},ze.App.prototype.decompressionComplete=function(e,t,r,i){return logImpression("decompress_success",this.currentArchiveTypeString.toLowerCase()),this.isSessionAborted?(this.updateEntryState(e,ze.App.ESTATE.CANCELED),void this.checkForExtractionComplete()):void(this.updateEntryState(e,ze.App.ESTATE.DECOMPRESSION_COMPLETE),this.uploadFile(e,t,i,r))},ze.App.prototype.uploadFile=function(e,t,r,i){if(this.isSessionAborted)return this.updateEntryState(e,ze.App.ESTATE.CANCELED),void this.checkForExtractionComplete();this.updateEntryState(e,ze.App.ESTATE.BEGIN_UPLOAD),!e.directory&&e.tableRowIndex>this.highestZipEntryIndexUploadedInSession&&(this.highestZipEntryIndexUploadedInSession=e.tableRowIndex,e.tableRow.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"}));var p=ze.Dapi.generateCallbacks(bindFn(this.fileUploadComplete,this,e,i),bindFn(this.fileUploadError,this,e,i),bindFn(this.fileUploadProgress,this,e),bindFn(this.fileUploadAborted,this,e,i));ze.Dapi.uploadFile(p,r,e.name,t)},ze.App.prototype.fileUploadComplete=function(e,t,r){e.file=r,e.driveFileId=r.id,this.updateEntryState(e,ze.App.ESTATE.UPLOAD_COMPLETE),this.updateUiForFileComplete(e),this.incrementSessionProgress(e,ze.App.ENTRY_OVERHEAD_BYTES);var i=this.handleProgress(this.currentSessionProgress,this.totalSessionSize);this.updateSecondaryProgressString(i),t(),this.checkForExtractionComplete()},ze.App.prototype.maybeRefreshCredentials=function(e){(e==ze.Dapi.ErrType.AUTH_ERROR||401==e)&&authorize(!0,void 0,void 0,void 0,CURRENT_AUTH_USER,!1,"maybeRefreshCredentials")},ze.App.prototype.fileUploadError=function(e,t,r,i){logImpression("upload_file","save_to_drive","error: "+r),this.incrementSessionProgress(e,ze.App.ENTRY_OVERHEAD_BYTES),this.incrementSessionProgress(e,ze.App.TRANSFER_DECOMPRESS_MULTIPLIER*e.uncompressedSize),this.updateSecondaryProgressString(),this.updateEntryState(e,ze.App.ESTATE.UPLOAD_ERROR,r,i),t(),this.checkForExtractionComplete(),this.maybeRefreshCredentials(r)},ze.App.prototype.fileUploadAborted=function(e,t,r){logImpression("upload_file","save_to_drive","aborted"),this.incrementSessionProgress(e,ze.App.ENTRY_OVERHEAD_BYTES),this.updateSecondaryProgressString();this.updateEntryState(e,ze.App.ESTATE.UPLOAD_ABORTED,"Upload Aborted",r),t(),this.checkForExtractionComplete()},ze.App.prototype.fileUploadProgress=function(e,t,r){if(!this.isSessionAborted){e.uploadPrev=e.uploadCurrent?e.uploadCurrent:0,e.uploadCurrent=t,e.uploadTotal=r,this.updateEntryState(e,ze.App.ESTATE.UPLOAD_PROGRESS),t===r&&this.updateEntryState(e,ze.App.ESTATE.UPLOAD_ALL_BYTES_TRANSFERRED);var i=e.uploadCurrent-e.uploadPrev,p=e.uncompressedSize/r*i,o=this.incrementSessionProgress(e,ze.App.TRANSFER_DECOMPRESS_MULTIPLIER*p);this.updateSecondaryProgressString(o)}},ze.App.prototype.folderInsertComplete=function(e,t,r,i){e.folder=i,e.driveFileId=i.id,this.updateEntryState(e,ze.App.ESTATE.UPLOAD_COMPLETE),this.updateUiForFileComplete(e);var p=this.incrementSessionProgress(e,ze.App.ENTRY_OVERHEAD_BYTES);this.updateSecondaryProgressString(p),r(i.id),t(),this.isSessionAborted&&this.checkForExtractionComplete()},ze.App.prototype.folderInsertError=function(e,t,r,i){logImpression("create_folder","save_to_drive","error: "+r),this.incrementSessionProgress(e,ze.App.ENTRY_OVERHEAD_BYTES),this.updateSecondaryProgressString(),this.updateEntryState(e,ze.App.ESTATE.UPLOAD_ERROR,r,i),this.setAllChildEntriesQueuedPendingRetry(e),t(),this.checkForExtractionComplete(),this.maybeRefreshCredentials(r)},ze.App.prototype.folderInsertAborted=function(e,t,r){logImpression("create_folder","save_to_drive","aborted"),this.incrementSessionProgress(e,ze.App.ENTRY_OVERHEAD_BYTES),this.updateSecondaryProgressString();this.updateEntryState(e,ze.App.ESTATE.UPLOAD_ABORTED,"Folder Create Aborted",r),this.cancelAllChildEntries(e),t(),this.checkForExtractionComplete()},ze.App.prototype.cancelAllChildEntries=function(e){for(var t in e.children){var r=e.children[t];this.updateEntryState(r,ze.App.ESTATE.CANCELED),r.directory&&this.cancelAllChildEntries(r)}},ze.App.prototype.setAllChildEntriesQueuedPendingRetry=function(e){for(var t in e.children){var r=e.children[t];r.state!=ze.App.ESTATE.SKIPPED&&(this.updateEntryState(r,ze.App.ESTATE.QUEUED_PENDING_RETRY),this.incrementSessionProgress(r,ze.App.ENTRY_OVERHEAD_BYTES),r.directory&&this.setAllChildEntriesQueuedPendingRetry(r))}},ze.App.prototype.workQueueExecutionComplete=function(){this.checkForExtractionComplete()},ze.App.prototype.checkForExtractionComplete=function(){this.areAllStatesTerminal()&&this.handleExtractionComplete(this.isSessionAborted)},ze.App.prototype.updateZipEntryUi=function(e,t){if(e.root)return t?(this.showEl(this.selectAllCheckbox,!0),this.showEl(this.rootStatusSpinner,!1),void this.showEl(this.rootStatusIconContainer,!1)):void this.updateRootEntryUi(e,e.isEncrypted);var r=e.state,i=e.tableRow;if(!i&&e.zipTreeEntry&&(i=e.zipTreeEntry.tableRow),!!i){var p=i.children[2],o=p.children[0],n=o.children[0],a=p.children[1],s=p.children[2];if(t)return this.showEl(o,!1),this.showEl(a,!1),void this.showEl(s,!0);if(r==ze.App.ESTATE.BEGIN_DECOMPRESSION)this.showEl(o,!1),this.showEl(a,!0),this.showEl(s,!1),a.title="Decompressing file...";else if(r==ze.App.ESTATE.DECOMPRESSION_PROGRESS);else if(r==ze.App.ESTATE.BEGIN_UPLOAD)this.showEl(o,!1),this.showEl(a,!0),this.showEl(s,!1),a.title="Extracting file to Google Drive...";else if(r==ze.App.ESTATE.UPLOAD_ALL_BYTES_TRANSFERRED);else if(r==ze.App.ESTATE.UPLOAD_PROGRESS);else{var E=ze.App.getEntryStatusIconMaterialId(r,e.isEncrypted);n.style.color="warning"==E||"error_outline"==E?"#d00000":"lock"==E?"#DCA93B":"",E||(E="whatshot"),n.textContent=E,this.showEl(o,!0),this.showEl(a,!1),this.showEl(s,!1),n.title=ze.App.translateEntryState(r,e)}}},ze.App.prototype.updateRootEntryUi=function(e,t){if(e.state==ze.App.ESTATE.BEGIN_UPLOAD)this.showEl(this.rootStatusSpinner,!0),this.showEl(this.rootStatusIconContainer,!1);else{var r=this.rootStatusIcon,i=ze.App.getEntryStatusIconMaterialId(e.state,t);r.style.color="warning"==i||"error_outline"==i?"#d00000":"lock"==i?"#DCA93B":"",i||(i="whatshot"),r.textContent=i,this.showEl(this.rootStatusSpinner,!1),this.showEl(this.rootStatusIconContainer,!0)}this.showEl(this.selectAllCheckbox,!1)},ze.App.prototype.loadScriptAsync=function(e,t){var r=document.createElement("script");r.type="text/javascript",r.onload=function(){t&&t()},r.src=e,document.head.appendChild(r)},ze.AsyncWorkQueue=function(e){this.maxWorkers=e,this.workQueue=null,this.runCompleteCallback=null,this.numCurrentWorkers=-1,this.isRunning=!1,this.init()},ze.AsyncWorkQueue.prototype.init=function(){this.workQueue=[],this.numCurrentWorkers=0,this.runCompleteCallback=null},ze.AsyncWorkQueue.prototype.close=function(){this.init()},ze.AsyncWorkQueue.prototype.enqueue=function(e){this.workQueue.push(e)},ze.AsyncWorkQueue.prototype.run=function(e){this.runCompleteCallback=e,this.isRunning=!0,this.processQueue()},ze.AsyncWorkQueue.prototype.processQueue=function(){for(;this.numCurrentWorkers<this.maxWorkers&&!this.isEmpty();)this.executeNextWorkItem()},ze.AsyncWorkQueue.prototype.stop=function(){this.workQueue.length=0,this.isRunning=!1},ze.AsyncWorkQueue.prototype.isEmpty=function(){return 0===this.workQueue.length},ze.AsyncWorkQueue.prototype.isActive=function(){return this.isRunning||!this.isDone()},ze.AsyncWorkQueue.prototype.isDone=function(){return 0===this.numCurrentWorkers&&this.isEmpty()},ze.AsyncWorkQueue.prototype.executeNextWorkItem=function(){var e=this.workQueue.shift();if(this.numCurrentWorkers>this.maxWorkers)throw new Error("Error: too many workers. Current # of Workers: "+this.numCurrentWorkers+"; max: "+this.maxWorkers);this.numCurrentWorkers++,e(bindFn(this.workItemComplete,this))},ze.AsyncWorkQueue.prototype.workItemComplete=function(){if(this.isRunning){if(this.numCurrentWorkers--,0>this.numCurrentWorkers)throw new Error("Error: too few workers. Current # of Workers: "+this.numCurrentWorkers+"; min: 0");var e=this.isDone();e?(this.isRunning=!1,this.runCompleteCallback&&this.runCompleteCallback()):this.processQueue()}},ze.Dapi={},ze.Dapi.activeRequests=[],ze.Dapi.ApiUrl={UPLOAD:"https://www.googleapis.com/upload/drive/v3/files/",FILES:"https://www.googleapis.com/drive/v3/files/"},ze.Dapi.ErrType={FORBIDDEN:"forbidden",FILE_NOT_FOUND:"fileNotFound",DEADLINE_EXCEEDED:"deadlineExceeded",SERVER_ERROR:"serverError",AUTH_ERROR:"authError",BAD_REQUEST:"badRequest",REQUEST_ABORTED:"requestAborted",UNKNOWN:"unknown"},ze.Dapi.ErrMsg={FORBIDDEN:"There was a problem with the server request; please try again",FILE_NOT_FOUND:"You do not have read access to this file; try a different Google account",DEADLINE_EXCEEDED:"The server took too long to respond; please try again",SERVER_ERROR:"An internal server error occurred; please try again",AUTH_ERROR:"An authorization error occured; please refresh this page and re-authorize",BAD_REQUEST:"The server request could not be understood; please report this error to the developers",REQUEST_ABORTED:"The request was aborted when it was still in progress",UNKNOWN:"An unknown error occurred; please try again or report this error to the developers",XHR_NETWORK:"Network request failed. Please check that you are online and try again"},ze.Dapi.XHR_ERROR_CODES={403:ze.Dapi.ErrType.FORBIDDEN,404:ze.Dapi.ErrType.FILE_NOT_FOUND,500:ze.Dapi.ErrType.SERVER_ERROR,503:ze.Dapi.ErrType.DEADLINE_EXCEEDED,401:ze.Dapi.ErrType.AUTH_ERROR,400:ze.Dapi.ErrType.BAD_REQUEST,0:ze.Dapi.ErrType.REQUEST_ABORTED},ze.Dapi.getErrorMessage=function(e,t){return e===ze.Dapi.ErrType.FORBIDDEN?ze.Dapi.ErrMsg.FORBIDDEN+(t?" ("+t+")":""):e===ze.Dapi.ErrType.FILE_NOT_FOUND?ze.Dapi.ErrMsg.FILE_NOT_FOUND:e===ze.Dapi.ErrType.SERVER_ERROR?ze.Dapi.ErrMsg.SERVER_ERROR:e===ze.Dapi.ErrType.DEADLINE_EXCEEDED?ze.Dapi.ErrMsg.DEADLINE_EXCEEDED:e===ze.Dapi.ErrType.AUTH_ERROR?ze.Dapi.ErrMsg.AUTH_ERROR:e===ze.Dapi.ErrType.BAD_REQUEST?ze.Dapi.ErrMsg.BAD_REQUEST:e===ze.Dapi.ErrType.REQUEST_ABORTED?ze.Dapi.ErrMsg.REQUEST_ABORTED:ze.Dapi.ErrMsg.UNKNOWN},ze.Dapi.DEFAULT_FIELDS_GET="id,name,size,parents,mimeType",ze.Dapi.DEFAULT_FIELDS_CREATE="id",ze.Dapi.Method={POST:"POST",GET:"GET",PUT:"PUT",PATCH:"PATCH",DELETE:"DELETE"},ze.Dapi.CbType={SUCCESS:"success",ERROR:"error",PROGRESS:"progress",ABORT:"abort"},ze.Dapi.MimeType={JSON:"application/json",FOLDER:"application/vnd.google-apps.folder"},ze.Dapi.XhrResponseType={BLOB:"blob",JSON:"json",TEXT:"text"},ze.Dapi.CRLF="\r\n",ze.Dapi.MULTIPART_BOUNDARY_STRING="314159265358979323846",ze.Dapi.MULTIPART_DELIMITER=ze.Dapi.CRLF+"--"+ze.Dapi.MULTIPART_BOUNDARY_STRING+ze.Dapi.CRLF,ze.Dapi.MULTIPART_CLOSE_DELIMITER=ze.Dapi.CRLF+"--"+ze.Dapi.MULTIPART_BOUNDARY_STRING+"--",ze.Dapi.MULTIPART_CONTENT_TYPE="multipart/related; boundary=\""+ze.Dapi.MULTIPART_BOUNDARY_STRING+"\"",ze.Dapi.generateCallbacks=function(e,t,r,i){var p={};return p[ze.Dapi.CbType.SUCCESS]=e,p[ze.Dapi.CbType.ERROR]=t,r&&(p[ze.Dapi.CbType.PROGRESS]=r),i&&(p[ze.Dapi.CbType.ABORT]=i),p},ze.Dapi.abortDownload=function(){var e=ze.Dapi.getDownloadXhr();e&&e.abort()},ze.Dapi.getDownloadXhr=function(){return 0<ze.Dapi.activeRequests.length?ze.Dapi.activeRequests[0]:null},ze.Dapi.get=function(e,t){var r={fields:ze.Dapi.DEFAULT_FIELDS_GET,supportsAllDrives:"true"};ze.Dapi.sendXhr(t,ze.Dapi.Method.GET,ze.Dapi.ApiUrl.FILES+e,r)},ze.Dapi.blobToBase64=function(e,t,r){var i=new FileReader;i.onload=function(p){var e=i.result;if(null==e&&p&&p.target&&(e=p.target.result),null==e)r("dataUrl was null in blobToBase64()");else try{var o=e.split(",")[1];t(o)}catch(e){r(e)}},i.onerror=function(){var e=i.error;r(e)},i.readAsDataURL(e)},ze.Dapi.uploadFile=function(e,t,r,i){ze.Dapi.blobToBase64(t,bindFn(ze.Dapi.doUploadFile,this,e,r,i),bindFn(ze.Dapi.blobToBase64ErrorFn,this,e))},ze.Dapi.blobToBase64ErrorFn=function(e,t){ze.Dapi.invokeCallback(e,ze.Dapi.CbType.ERROR,"Error: blobToBase64() failed in uploadFile()",t)},ze.Dapi.doUploadFile=function(e,t,r,i){var p={uploadType:"multipart",fields:ze.Dapi.DEFAULT_FIELDS_CREATE,supportsAllDrives:"true"},o={name:t};r&&(o.parents=[r]),null==i&&(i="");var n=ze.Dapi.MULTIPART_DELIMITER+"Content-Type: "+ze.Dapi.MimeType.JSON+"; charset=UTF-8"+ze.Dapi.CRLF+ze.Dapi.CRLF+JSON.stringify(o)+ze.Dapi.MULTIPART_DELIMITER+"Content-Transfer-Encoding: base64"+ze.Dapi.CRLF+ze.Dapi.CRLF+i+ze.Dapi.MULTIPART_CLOSE_DELIMITER;ze.Dapi.sendXhr(e,ze.Dapi.Method.POST,ze.Dapi.ApiUrl.UPLOAD,p,n,ze.Dapi.MULTIPART_CONTENT_TYPE,ze.Dapi.XhrResponseType.JSON)},ze.Dapi.createFolder=function(e,t,r){var i={name:t,mimeType:ze.Dapi.MimeType.FOLDER};r&&(i.parents=[r]);var p={fields:ze.Dapi.DEFAULT_FIELDS_CREATE,supportsAllDrives:"true"};ze.Dapi.sendXhr(e,ze.Dapi.Method.POST,ze.Dapi.ApiUrl.FILES,p,JSON.stringify(i),ze.Dapi.MimeType.JSON,ze.Dapi.XhrResponseType.JSON)},ze.Dapi.sendXhr=function(t,r,i,p,o,n,a,s){var E=new XMLHttpRequest;ze.Dapi.activeRequests.push(E);var d=n||ze.Dapi.MimeType.JSON,l=a||ze.Dapi.XhrResponseType.JSON;if(E.onreadystatechange=function(){if(4==E.readyState)if(ze.Dapi.removePendingXhr(E),200==E.status&&null!=E.response&&null!=E.response||204==E.status&&!E.response){var e=E.response;e&&""===E.responseType&&"string"==typeof E.response&&(e=JSON.parse(E.response)),ze.Dapi.invokeCallback(t,ze.Dapi.CbType.SUCCESS,e)}else if(0===E.status||200==E.status&&(null==E.response||null==E.response)){logImpression("xhr_aborted","xhr",null=="xhr_status="+E.status+", xhr_response == null? "+E.response);var i=ze.Dapi.getErrorMessage(ze.Dapi.ErrType.REQUEST_ABORTED);ze.Dapi.invokeCallback(t,ze.Dapi.CbType.ABORT,i)}else{var p=ze.Dapi.XHR_ERROR_CODES[E.status],o=E.statusText||"",n="",a=E.response;if(a&&""===E.responseType&&"string"==typeof a&&(a=JSON.parse(a)),a&&a.error&&(n=a.error.message||"",n&&(o?o+=" - "+n:o=n)),E.response&&E.response instanceof Blob&&"application/json"===E.response.type){var s=new FileReader;s.onload=function(i){var e="";try{var n=JSON.parse(i.target.result);if(n&&n.error)e=n.error.errors&&0<n.error.errors.length?n.error.errors[0].reason:n.error;else{e=(n||"")+" ("+i.target.result+")"}}catch(t){e="Error parsing response BLOB JSON ("+t+")"}var a=p+" "+E.status+" ["+e+"]"+(o?" ("+o+")":"");logImpression("xhr_http_error","xhr","method="+r+"; error: "+a),ze.Dapi.invokeCallback(t,ze.Dapi.CbType.ERROR,p,ze.Dapi.getErrorMessage(p,e))},s.readAsText(E.response)}else{var d=p+" "+E.status+(o?" ("+o+")":"");logImpression("xhr_http_error2","xhr","method="+r+"; error: "+d),ze.Dapi.invokeCallback(t,ze.Dapi.CbType.ERROR,p,ze.Dapi.getErrorMessage(p,n))}}},t[ze.Dapi.CbType.PROGRESS]){var A=function(r){if(r&&r.lengthComputable){var e=r.loaded,i=r.total;400==E.status||401==E.status||403==E.status||404==E.status||500==E.status||503==E.status||ze.Dapi.invokeCallback(t,ze.Dapi.CbType.PROGRESS,e,i)}};r==ze.Dapi.Method.GET?E.onprogress=A:E.upload.onprogress=A}t[ze.Dapi.CbType.ERROR]&&(E.onerror=function(r){var e=ze.Dapi.ErrMsg.XHR_NETWORK,i="";E.statusText&&(i+=E.statusText+" - "),r&&(r.target&&r.target.status&&(i+=" - "+r.target.status),r.error&&(i+=" - "+r.error));var p=e+(i?" ("+i+")":"");logImpression("xhr_network_error","xhr","error: "+p),ze.Dapi.removePendingXhr(E),ze.Dapi.invokeCallback(t,ze.Dapi.CbType.ERROR,e,i)});var c=ze.Dapi.buildCorsUrl(i,p||{});E.open(r,c,!0),E.responseType=l,E.setRequestHeader("Authorization","Bearer "+getAccessToken()),d&&E.setRequestHeader("Content-Type",d),s&&E.setRequestHeader("Range","bytes="+s),E.send(o||void 0)},ze.Dapi.buildCorsUrl=function(e,t){var r=e,i=ze.Dapi.buildQuery(t),p=!1;return i&&(r+="?"+i,p=!0),r},ze.Dapi.buildQuery=function(e){return e=e||{},Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")},ze.Dapi.removePendingXhr=function(e){var t=ze.Dapi.activeRequests.indexOf(e);-1!=t&&ze.Dapi.activeRequests.splice(t,1)},ze.Dapi.abortAllRequests=function(){for(var e=ze.Dapi.activeRequests.slice(0),t=0,r;t<e.length;t++)r=e[t],r&&r.abort&&r.abort()},ze.Dapi.invokeCallback=function(e,t,r,i){var p=e[t];p&&p(r,i)},ze.Dapi.downloadFileBytes=function(e,t,r,i){var p={alt:"media",supportsAllDrives:"true"};i&&(p.acknowledgeAbuse=!0),ze.Dapi.sendXhr(t,ze.Dapi.Method.GET,ze.Dapi.ApiUrl.FILES+e,p,void 0,void 0,ze.Dapi.XhrResponseType.BLOB,r)},ze.RarLib={},ze.RarLib.RAR_DECODER_SCRIPT_NAME="rardecode4-min.js",ze.RarLib.ENCRYPTION_MODE_RAR="rar-all",ze.RarLib.RAR_HEADER_V1=String.fromCharCode(82,69,126,94),ze.RarLib.RAR_HEADER_V4=String.fromCharCode(82,97,114,33,26,7,0),ze.RarLib.RAR_HEADER_V5=String.fromCharCode(82,97,114,33,26,7,1,0),ze.RarLib.HEADER_MAGIC_BYTES_SIZE=8,ze.RarLib.ARCHIVE_HEADER_MIN_SIZE=18,ze.RarLib.FILE_HEADER_PREAMBLE_SIZE=11,ze.RarLib.METHOD_STORE=48,ze.RarLib.METHOD_FASTEST=49,ze.RarLib.METHOD_FAST=50,ze.RarLib.METHOD_NORMAL=51,ze.RarLib.METHOD_GOOD=52,ze.RarLib.METHOD_BEST=53,ze.RarLib.MARKER_BLOCK_SIG_BYTE=114,ze.RarLib.ARCHIVE_HEADER_SIG_BYTE=115,ze.RarLib.FILE_HEADER_SIG_BYTE=116,ze.RarLib.ENTRY_OS_LIST=["MS-DOS","OS/2","Windows","Unix","Mac","BeOS"],ze.RarLib.rarDecoderLibraryPendingLoad=!1,ze.RarLib.additionalPendingRarDecoderLibCallbackFn=null,ze.RarLib.loadRarDecoderLib=function(e,t){if(ze.RarLib.isRarDecoderLibLoaded())return void(e&&e());if(ze.RarLib.rarDecoderLibraryPendingLoad)return void(ze.RarLib.additionalPendingRarDecoderLibCallbackFn=e);if(ze.RarLib.rarDecoderLibraryPendingLoad=!0,logImpression("load_rar_lib","rar"),!t){var r=MAINAPP.appState;MAINAPP.setAppState(ze.App.APP_STATE.RARDECODE_LIBRARY_LOADING)}var i=document.createElement("script");i.type="text/javascript",i.onload=function(){ze.RarLib.rarDecoderLibraryPendingLoad=!1,t||MAINAPP.setAppState(r),e&&e(),ze.RarLib.additionalPendingRarDecoderLibCallbackFn&&(ze.RarLib.additionalPendingRarDecoderLibCallbackFn(),ze.RarLib.additionalPendingRarDecoderLibCallbackFn=null)},i.src=ze.RarLib.RAR_DECODER_SCRIPT_NAME,document.head.appendChild(i)},ze.RarLib.isRarDecoderLibLoaded=function(){return"rarDecode"in window},ze.RarLib.verifyRarFile=function(e,t,r){return e.size<ze.RarLib.ARCHIVE_HEADER_MIN_SIZE?void r("RAR file size is less than required header size."):void ze.ZipLib.blobToString(e,0,ze.RarLib.HEADER_MAGIC_BYTES_SIZE,function(e){return ze.RarLib.RAR_HEADER_V4==e.slice(0,ze.RarLib.RAR_HEADER_V4.length)?void t(ze.RarLib.RAR_HEADER_V4):ze.RarLib.RAR_HEADER_V1==e.slice(0,ze.RarLib.RAR_HEADER_V1.length)?void r("Older RAR Version 1 format is not yet supported."):ze.RarLib.RAR_HEADER_V5==e.slice(0,ze.RarLib.RAR_HEADER_V5.length)?void t(ze.RarLib.RAR_HEADER_V5):void r("File does not appear to be a RAR file (\""+e+"\"")},r)},ze.RarLib.parseEntryOS=function(e){return 0>e||5<e?"Unknown":ze.RarLib.ENTRY_OS_LIST[e]},ze.RarLib.getRarEntries=function(e,t,r,i,p){if(logImpression("read_rar_all","rar","start"),e.size<=ze.RarLib.ARCHIVE_HEADER_MIN_SIZE)throw new Error("RAR file insufficient size ("+e.size+")");if(p==ze.RarLib.RAR_HEADER_V5||p==ze.RarLib.RAR_HEADER_V4){logImpression("read_rar_V5","rar","check_lib_loaded");if(console.log("reading rarv5 native including for v4."),!ze.RarLib.isRarDecoderLibLoaded()){logImpression("read_rar_V5","rar","initiate_lib_load");var o=bindFn(ze.RarLib.getRarEntriesV5Native,this,e,"",t,r,i);return void ze.RarLib.loadRarDecoderLib(o)}ze.RarLib.getRarEntriesV5Native(e,"",t,r,i)}},ze.RarLib.getRarEntriesV5Native=function(e,t,r,i,p){logImpression("read_rar_V5","rar","start"),ze.ZipLib.blobToByteArrayAsync(e,0,e.size,function(e){var o=null;try{o=getRarEntriesNative_("temprarfilename.rar",e,t,p),r(o)}catch(e){i("An error occured when reading the RAR file: "+e)}},i)},ze.RarLib.decompressRarEntry=function(e,t,r,i,p,o,n){if(!ze.RarLib.isRarDecoderLibLoaded()){var a=bindFn(ze.RarLib.decompressRarEntry,this,e,t,r,i,p,o,n);return void ze.RarLib.loadRarDecoderLib(a)}try{window.rarDecode.decompressRarEntry_(e,t,r,i,p,o,n)}catch(t){o("General RAR Decompression error: "+t)}},ze.LzmaLib={},ze.LzmaLib.LZMA_HEADER_SIZE=13,ze.LzmaLib.decompressLzmaEntry=function(e,t,r,i,p,o){try{var n=lzma.decompressWithProperties(r,e.buffer,e.byteOffset,e.length,t,o);i(new Blob([n]))}catch(e){return void p(e)}},ze.LzmaLib.verifyLzmaFile=function(e,t,r){return e.size<ze.LzmaLib.LZMA_HEADER_SIZE?void r("LZMA file size is less than required header size."):void ze.ZipLib.blobToByteArrayAsync(e,0,ze.LzmaLib.LZMA_HEADER_SIZE,function(e){return void t(e)},r)},ze.LzmaLib.getLzmaEntry=function(e,t,r,i,p){var o={type:"lzma",decoderProperties:p.slice(0,5)},n=new DataView(p.buffer,5),a=n.getUint32(0,!0),s=n.getUint32(4,!0);if(4294967295!=a&&4294967295!=s){var E=a+Math.pow(2,32)*s;Number.isSafeInteger(E)?o.uncompressedSize=E:console.warn(E,"exceeds MAX_SAFE_INTEGER. Precision may be lost")}t=t||"";var d=t.toLowerCase().indexOf("tlz",t.length-"tlz".length);if(-1!==d)t=t.substring(0,d),t+="tar";else{var l=t.toLowerCase().indexOf("lzma",t.length-"lzma".length);-1!==l&&(t=t.substring(0,l-1))}o.filename=t,o.offset=ze.LzmaLib.LZMA_HEADER_SIZE,o.compressedSize=e.size-ze.LzmaLib.LZMA_HEADER_SIZE,r(o,o.filename)},ze.BzipLib={},ze.BzipLib.BZIP_LZMA_SEVENZ_LIB_SCRIPT_NAME="bzip-lzma-sevenz-lib6-min.js",ze.BzipLib.BZIP_SIGNATURE_SIZE=3,ze.BzipLib.HEADER_SIGNATURE_BYTE_0=66,ze.BzipLib.HEADER_SIGNATURE_BYTE_1=90,ze.BzipLib.HEADER_SIGNATURE_BYTE_2=104,ze.BzipLib.bzipLzmaLibraryPendingLoad=!1,ze.BzipLib.additionalPendingBzipLibCallbackFn=null,ze.BzipLib.verifyBzipFile=function(e,t,r){return e.size<ze.BzipLib.BZIP_SIGNATURE_SIZE?void r("BZIP file size is less than required signature size."):void ze.ZipLib.blobToByteArrayAsync(e,0,ze.BzipLib.BZIP_SIGNATURE_SIZE,function(e){var i=e[0]==ze.BzipLib.HEADER_SIGNATURE_BYTE_0&&e[1]==ze.BzipLib.HEADER_SIGNATURE_BYTE_1&&e[2]==ze.BzipLib.HEADER_SIGNATURE_BYTE_2;if(i)return void t(e);var p=ze.ZipLib.getStringFromBytes(e);r("File does not appear to be a Bzip file (\""+p+"\")")},r)},ze.BzipLib.getBzipEntry=function(e,t){var r={};r.type="bzip",e=e||"",r.filename=ze.App.trimLastFileExtension(e),t(r)},ze.BzipLib.decompressBzipEntry=function(e,t,r,i){try{var p=Bunzip.decode(e,i);t(new Blob([p]))}catch(e){return void r(e)}},ze.BzipLib.isBzipLzmaSevenZDecoderLibLoaded=function(){return"Bunzip"in window},ze.BzipLib.loadBzipLzmaSevenZDecoderLib=function(e,t,r,i){if(ze.BzipLib.isBzipLzmaSevenZDecoderLibLoaded())return void(e&&e());if(ze.BzipLib.bzipLzmaLibraryPendingLoad)return void(ze.BzipLib.additionalPendingBzipLibCallbackFn=e);if(ze.BzipLib.bzipLzmaLibraryPendingLoad=!0,r?logImpression("load_lzma_lib","zip"):i?logImpression("load_7z_lib","7z"):logImpression("load_bzip_lib","bzip"),!t){var p=MAINAPP.appState;MAINAPP.setAppState(ze.App.APP_STATE.BZIP_LIBRARY_LOADING)}var o=document.createElement("script");o.type="text/javascript",o.onload=function(){ze.BzipLib.bzipLzmaLibraryPendingLoad=!1,t||MAINAPP.setAppState(p),e&&e(),ze.BzipLib.additionalPendingBzipLibCallbackFn&&(ze.BzipLib.additionalPendingBzipLibCallbackFn(),ze.BzipLib.additionalPendingBzipLibCallbackFn=null)},o.src=ze.BzipLib.BZIP_LZMA_SEVENZ_LIB_SCRIPT_NAME,document.head.appendChild(o)},ze.GzipLib={},ze.GzipLib.HEADER_SIGNATURE_BYTE_0=31,ze.GzipLib.HEADER_SIGNATURE_BYTE_1=139,ze.GzipLib.COMPRESSION_MODE_DEFLATE=8,ze.GzipLib.GZIP_HEADER_SIZE=2,ze.GzipLib.GZIP_FOOTER_SIZE=8,ze.GzipLib.FLAG_FTEXT=1,ze.GzipLib.FLAG_FHCRC=2,ze.GzipLib.FLAG_FEXTRA=4,ze.GzipLib.FLAG_FNAME=8,ze.GzipLib.FLAG_FCOMMENT=16,ze.GzipLib.verifyGzipFile=function(e,t,r){return e.size<ze.GzipLib.GZIP_HEADER_SIZE?void r("GZIP file size is less than required header size."):void ze.ZipLib.blobToByteArrayAsync(e,0,ze.GzipLib.GZIP_HEADER_SIZE,function(e){var i=e[0]==ze.GzipLib.HEADER_SIGNATURE_BYTE_0&&e[1]==ze.GzipLib.HEADER_SIGNATURE_BYTE_1;if(i)return void t(e);var p=ze.ZipLib.getStringFromBytes(e);r("File does not appear to be a Gzip file (\""+p+"\")")},r)},ze.GzipLib.getGzipEntry=function(e,t,r,i){var p={type:"gzip"},o=2;ze.ZipLib.blobToDataViewAsync(e,0,e.size,function(n){if(p.compressionMethod=n.getUint8(o),o+=1,p.compressionMethod!=ze.GzipLib.COMPRESSION_MODE_DEFLATE)return void i("Error: GZIP does not have DEFLATE compression method ("+p.compressionMethod+")");var a=n.getUint8(o);if(p.flags=a,o+=1,p.ftext=!!(a&ze.GzipLib.FLAG_FTEXT),p.mtime=n.getUint32(o,!0),o+=4,p.xflags=n.getUint8(o),o+=1,p.os=n.getUint8(o),o+=1,a&ze.GzipLib.FLAG_FEXTRA&&(p.xlen=n.getUint16(o,!0),o+=2,p.xbytes=new Uint8Array(n.buffer,o,o+p.xlen),o+=p.xlen),a&ze.GzipLib.FLAG_FNAME){var s=ze.ZipLib.getNullTerminatedStringFromDataView(n,o);p.filename=s,o+=s.length,o+=1}else{t=t||"";var E=t.toLowerCase().indexOf("tgz",t.length-3);if(-1!==E)t=t.substring(0,E),t+="tar";else{var d=t.toLowerCase().indexOf("gz",t.length-2);-1!==d&&(t=t.substring(0,d-1))}p.filename=t}if(a&ze.GzipLib.FLAG_FCOMMENT){var l=ze.ZipLib.getNullTerminatedStringFromDataView(n,o);p.comment=l,o+=l.length,o+=1}a&ze.GzipLib.FLAG_FHCRC&&(p.fhcrc16=n.getUint16(o,!0),o+=2),p.offset=o;var A=e.size-o-ze.GzipLib.GZIP_FOOTER_SIZE;return p.compressedSize=A,o+=A,p.crc32=n.getUint32(o,!0),0===p.crc32&&(p.crc32=null),o+=4,p.uncompressedSize=n.getUint32(o,!0),o+=4,o==e.size?void r(p,p.filename):void i("Error: Expected Current Index to be GZIP size.")})},ze.GzipLib.decompressGzipEntry=function(e,t,r,i,p,o,n){ze.ZipLib.inflate(new Worker(ze.ZipLib.INFLATE_JS),e,[],0,t,r,i,p,o,n,!0)},ze.SevenZLibCore={},ze.SevenZLibCore.SEVENZ_SIGNATURE=[55,122,188,175,39,28],ze.SevenZLibCore.SEVENZ_SIGNATURE_STRING=String.fromCharCode(55,122,188,175,39,28),ze.SevenZLibCore.SEVENZ_SIGNATURE_SIZE=6,ze.SevenZLibCore.SEVENZ_HEADER_SIZE=12,ze.SevenZLibCore.verifySevenZFile=function(e,t,r){return e.size<ze.SevenZLibCore.SEVENZ_HEADER_SIZE?void r("SevenZ file size is less than required header size."):void ze.ZipLib.blobToString(e,0,ze.SevenZLibCore.SEVENZ_SIGNATURE_SIZE,function(e){var i=ze.SevenZLibCore.SEVENZ_SIGNATURE_STRING==e;return i?void t():void r("File does not appear to be a 7z file (\""+e+"\")")},r)},ze.SevenZLibCore.getSevenZEntries=function(e,t,r,i,p){ze.ZipLib.blobToDataViewAsync(e,0,e.size,function(e){var o=e.getUint8(6),n=e.getUint8(7);0==o?ze.SevenZLib.getEntries(e,t,r,i,p):r("Unsupported 7z version: ("+o+", "+n)},r)},ze.TarLib={},ze.TarLib.TAR_TYPE_FILE=0,ze.TarLib.TAR_TYPE_DIR=5,ze.TarLib.TAR_HEADER_SIZE=512,ze.TarLib.TAR_USTAR_MAGIC_BYTES_OFFSET=257,ze.TarLib.TAR_USTAR_MAGIC_BYTES_SIZE=5,ze.TarLib.TAR_TYPE_OFFSET=156,ze.TarLib.TAR_TYPE_SIZE=1,ze.TarLib.TAR_LINKNAME_OFFSET=157,ze.TarLib.TAR_LINKNAME_SIZE=100,ze.TarLib.TAR_SIZE_OFFSET=124,ze.TarLib.TAR_SIZE_SIZE=12,ze.TarLib.TAR_NAME_OFFSET=0,ze.TarLib.TAR_NAME_SIZE=100,ze.TarLib.TAR_PREFIX_OFFSET=345,ze.TarLib.TAR_PREFIX_SIZE=155,ze.TarLib.TAR_USTAR_MAGIC_BYTES_STRING="ustar",ze.TarLib.verifyTarFile=function(e,t,r){return e.size<ze.TarLib.TAR_HEADER_SIZE?void r("TAR file size is less than required header size."):void ze.ZipLib.blobToByteArrayAsync(e,ze.TarLib.TAR_USTAR_MAGIC_BYTES_OFFSET,ze.TarLib.TAR_USTAR_MAGIC_BYTES_OFFSET+ze.TarLib.TAR_USTAR_MAGIC_BYTES_SIZE,function(e){var i=ze.ZipLib.getStringFromBytes(e),p=i==ze.TarLib.TAR_USTAR_MAGIC_BYTES_STRING,o=0==e[0]&&0==e[1]&&0==e[2]&&0==e[3]&&0==e[4];return p||o?void t(!0):void r("File does not appear to be a TAR file (\""+i+"\")")},r)},ze.TarLib.getTarEntries=function(e,t,r,i){ze.ZipLib.blobToByteArrayAsync(e,0,e.size,function(e){ze.TarLib.doGetTarEntries_(e,t,r,i)},r)},ze.TarLib.doGetTarEntries_=function(e,t){for(var r=0,i=[],p;r+ze.TarLib.TAR_HEADER_SIZE<e.length;){p=ze.TarLib.getTarEntryFromFileHeader(e,r),null!=p&&""!=p.filename&&"."!=p.filename&&".."!=p.filename&&(p.offset=r,i.push(p));var o=p?p.compressedSize:0;if(r+=o+ze.TarLib.TAR_HEADER_SIZE,0<r%ze.TarLib.TAR_HEADER_SIZE){var n=0|r/ze.TarLib.TAR_HEADER_SIZE;r=(n+1)*ze.TarLib.TAR_HEADER_SIZE}}t(i)},ze.TarLib.getTarEntryFromFileHeader=function(e,t){var r={type:"tar"};try{var i=ze.ZipLib.getStringFromBytes(e,t+ze.TarLib.TAR_NAME_OFFSET,t+ze.TarLib.TAR_NAME_OFFSET+ze.TarLib.TAR_NAME_SIZE),p=i.replace(/\0/g,"");if(r.filename=p,0===p.length)return void(r.lastBlock=!0);var o=ze.ZipLib.getStringFromBytes(e,t+ze.TarLib.TAR_SIZE_OFFSET,t+ze.TarLib.TAR_SIZE_OFFSET+ze.TarLib.TAR_SIZE_SIZE),n=parseInt(o,8);r.compressedSize=n,r.uncompressedSize=n;var a=ze.ZipLib.getStringFromBytes(e,t+ze.TarLib.TAR_TYPE_OFFSET,t+ze.TarLib.TAR_TYPE_OFFSET+ze.TarLib.TAR_TYPE_SIZE),s=0|a,E=s==ze.TarLib.TAR_TYPE_DIR;r.directory=E;var d=0==e[t+ze.TarLib.TAR_LINKNAME_OFFSET];if(!d){var l=ze.ZipLib.getStringFromBytes(e,t+ze.TarLib.TAR_LINKNAME_OFFSET,t+ze.TarLib.TAR_LINKNAME_OFFSET+ze.TarLib.TAR_LINKNAME_SIZE);r.linkname=l}r.tarChecksum=-1;var A=ze.ZipLib.getStringFromBytes(e,t+ze.TarLib.TAR_USTAR_MAGIC_BYTES_OFFSET,t+ze.TarLib.TAR_USTAR_MAGIC_BYTES_OFFSET+ze.TarLib.TAR_USTAR_MAGIC_BYTES_SIZE),c=A==ze.TarLib.TAR_USTAR_MAGIC_BYTES_STRING;if(c){var T=0==e[t+ze.TarLib.TAR_PREFIX_OFFSET];if(!T){var _=ze.ZipLib.getStringFromBytes(e,t+ze.TarLib.TAR_PREFIX_OFFSET,t+ze.TarLib.TAR_PREFIX_OFFSET+ze.TarLib.TAR_PREFIX_SIZE);null!=_&&0<_.length&&(r.filename=_+"/"+r.filename)}}return s===ze.TarLib.TAR_TYPE_FILE||s===ze.TarLib.TAR_TYPE_DIR?r:null}catch(e){return r.err=e,r}},ze.ZipLib={},ze.ZipLib.ZIP_EXTRACTOR_EXTRA_FIELD_SIGNATURE=17754,ze.ZipLib.ERR_HEADER_BAD_FORMAT="This file does not appear to be a ZIP file.",ze.ZipLib.ERR_HEADER_READ="Error when reading the ZIP header.",ze.ZipLib.ERR_ENTRY_BAD_FORMAT="ZIP entry format error",ze.ZipLib.ERR_ENCRYPTED="Password-protected ZIP files are not yet supported",ze.ZipLib.ERR_ZIP64="This ZIP file is in Zip64 format for very large files; this is not yet supported.",ze.ZipLib.ERR_READ_GETDATA="Error while reading ZIP file array data",ze.ZipLib.ERR_READ_GETENTRIES="Error while reading ZIP file header",ze.ZipLib.ERR_WRITE_DATA="Error while writing file data",ze.ZipLib.ERR_INFLATION="Error while decompressing ZIP entry",ze.ZipLib.ERR_READ_DATA="Error while reading file data",ze.ZipLib.ERR_READ_DATA_CRC="Error while reading file data (CRC32 check failed)",ze.ZipLib.ERR_INCORRECT_PASSWORD="Incorrect password provided",ze.ZipLib.INFLATE_CHUNK_SIZE=524288,ze.ZipLib.INFLATE_JS="inflate-min8.js",ze.ZipLib.INFLATE_MESSAGE_EVENT="message",ze.ZipLib.CENTRAL_DIRECTORY_HEADER_SIZE=46,ze.ZipLib.LOCAL_FILE_HEADER_ENTRY_FIXED_SIZE_BYTES=30,ze.ZipLib.EOCDR_SIZE=22,ze.ZipLib.ZIPCRYPTO_ENCRYPTION_HEADER_LENGTH=12,ze.ZipLib.ZIP_COMMENT_MAX_LEN=65536,ze.ZipLib.ZIP64_EOCDR_LOCATOR_SIZE=20,ze.ZipLib.ZIP64_EXTENSIBLE_DATA_SECTOR_MAX_SIZE=4096,ze.ZipLib.ZIP64_EOCDR_FIXED_SIZE=56,ze.ZipLib.ZIP64_EXTENDED_INFO_EXTRA_FIELD_SIGNATURE=1,ze.ZipLib.ZIP64_EXTENDED_INFO_EXTRA_FIELD_SIZE=28,ze.ZipLib.UNICODE_PATH_EXTRA_DATA_SIGNATURE=28789,ze.ZipLib.UNICODE_COMMENT_EXTRA_DATA_SIGNATURE=25461,ze.ZipLib.UNICODE_PATH_PREAMBLE_SIZE=5,ze.ZipLib.AES_EXTRA_DATA_SIGNATURE=39169,ze.ZipLib.AES_EXTRA_DATA_SIZE=7,ze.ZipLib.MAX_EOCDR_HEADER_SEEK_LEN=ze.ZipLib.EOCDR_SIZE+ze.ZipLib.ZIP_COMMENT_MAX_LEN+ze.ZipLib.ZIP64_EOCDR_LOCATOR_SIZE+ze.ZipLib.ZIP64_EXTENSIBLE_DATA_SECTOR_MAX_SIZE+ze.ZipLib.ZIP64_EOCDR_FIXED_SIZE,ze.ZipLib.COMPRESSION_MODE_STORE=0,ze.ZipLib.COMPRESSION_MODE_DEFLATE=8,ze.ZipLib.COMPRESSION_MODE_BZIP=12,ze.ZipLib.COMPRESSION_MODE_LZMA=14,ze.ZipLib.COMPRESSION_MODE_PPMD=98,ze.ZipLib.COMPRESSION_MODE_XZ=95,ze.ZipLib.COMPRESSION_MODE_WINZIPENCRYPTED=99,ze.ZipLib.ZIP_CENTRAL_DIRECTORY_HEADER_SIGNATURE=1347092738,ze.ZipLib.ZIP_LOCAL_FILE_HEADER_SIGNATURE=1347093252,ze.ZipLib.ZIP_DATA_DESCRIPTOR_SIGNATURE=1347094280,ze.ZipLib.ZIP_DATA_ARCHIVE_EXTRA_DATA_SIGNATURE=1347094024,ze.ZipLib.ZIP_64_EOCDR_DIGITAL_HEADER_SIGNATURE=1347093765,ze.ZipLib.ZIP_64_EOCDR_SIGNATURE=1347094022,ze.ZipLib.ZIP_64_EOCDR_LOCATOR_SIGNATURE=1347094023,ze.ZipLib.EOCDR_SIGNATURE=1347093766,ze.ZipLib.ASCII_TABLE=["\xC7","\xFC","\xE9","\xE2","\xE4","\xE0","\xE5","\xE7","\xEA","\xEB","\xE8","\xEF","\xEE","\xEC","\xC4","\xC5","\xC9","\xE6","\xC6","\xF4","\xF6","\xF2","\xFB","\xF9","\xFF","\xD6","\xDC","\xF8","\xA3","\xD8","\xD7","\u0192","\xE1","\xED","\xF3","\xFA","\xF1","\xD1","\xAA","\xBA","\xBF","\xAE","\xAC","\xBD","\xBC","\xA1","\xAB","\xBB","_","_","_","\xA6","\xA6","\xC1","\xC2","\xC0","\xA9","\xA6","\xA6","+","+","\xA2","\xA5","+","+","-","-","+","-","+","\xE3","\xC3","+","+","-","-","\xA6","-","+","\xA4","\xF0","\xD0","\xCA","\xCB","\xC8","i","\xCD","\xCE","\xCF","+","+","_","_","\xA6","\xCC","_","\xD3","\xDF","\xD4","\xD2","\xF5","\xD5","\xB5","\xFE","\xDE","\xDA","\xDB","\xD9","\xFD","\xDD","\xAF","\xB4","\xAD","\xB1","_","\xBE","\xB6","\xA7","\xF7","\xB8","\xB0","\xA8","\xB7","\xB9","\xB3","\xB2","_"," "],ze.ZipLib.decodeASCIIBytes=function(e){for(var t="",r=0,p;r<e.length;r++)p=e[r],t+=127<p?ze.ZipLib.ASCII_TABLE[p-128]:String.fromCharCode(p);return t},ze.ZipLib.isValidUtf8=function(e){for(var t=0,r=0,p=0,o=e.length;p!=e.length;){var n=255&e[p];if(127>=n){p+=1;continue}if(194<=n&&223>=n)t=2;else if(224<=n&&239>=n)t=3;else if(240<=n&&244>=n)t=4;else return!1;if(p+(t-1)>=o)return!1;for(i=1;i<t;i++)if(128!=(192&e[p+i]))return!1;if(2==t)r=((31&e[p])<<6)+(63&e[p+1]);else if(3==t){if(r=((15&e[p])<<12)+((63&e[p+1])<<6)+(63&e[p+2]),2048>r)return!1;if(27==r>>11)return!1}else if(4==t&&(r=((7&e[p])<<18)+((63&e[p+1])<<12)+((63&e[p+2])<<6)+(63&e[p+3]),65536>r||1114111<r))return!1;p+=t}return!0},ze.ZipLib.decodeUTF8Bytes=function(e){var t,r,p,o,n,a;for(t="",p=e.length,r=0;r<p;)switch(o=e[r++],o>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=String.fromCharCode(e[r-1]);break;case 12:case 13:n=e[r++],t+=String.fromCharCode((31&o)<<6|63&n);break;case 14:n=e[r++],a=e[r++],t+=String.fromCharCode((15&o)<<12|(63&n)<<6|(63&a)<<0);}return t},ze.ZipLib.decodeStringFromDataView=function(e,t,r,i,p){var o=new Uint8Array(e.buffer,t,r);return ze.ZipLib.decodeStringFromTypedArray(o,i,p)},ze.ZipLib.decodeStringFromTypedArray=function(e,t,r){try{return r?new TextDecoder(r).decode(e):t?ze.App.TEXTDECODER_UTF8?ze.App.TEXTDECODER_UTF8.decode(e):ze.ZipLib.decodeUTF8Bytes(e):ze.App.TEXTDECODER_ASCII?ze.App.TEXTDECODER_ASCII.decode(e):ze.ZipLib.decodeASCIIBytes(e)}catch(t){logImpression("decode_string_error","misc",t);try{return ze.ZipLib.decodeASCIIBytes(e)}catch(e){return"Error: "+e}}},ze.ZipLib.convertDate=function(e){var t=(4294901760&e)>>16,r=65535&e;try{return new Date(1980+((65024&t)>>9),((480&t)>>5)-1,31&t,(63488&r)>>11,(2016&r)>>5,2*(31&r),0)}catch(t){return null}},ze.ZipLib.bindFn=function(e){return e.call.apply(e.bind,arguments)},ze.ZipLib.generateNewCrcTable=function(){var e=[],r,p,o;for(r=0;256>r;r++){for(o=r,p=0;8>p;p++)1&o?o=3988292384^o>>>1:o>>>=1;e[r]=o}return e},ze.ZipLib.Crc32=function(){var e=-1,t=ze.ZipLib.generateNewCrcTable(),r=this;r.append=function(r){var i=0;for(i=0;i<r.length;i++)e=e>>>8^t[255&(e^r[i])]},r.get=function(){return~e}},ze.ZipLib.getStringFromBytes=function(e,t,r){for(var p="",o=null==t?0:t,n=null==r?e.length:r,a=o;a<n;a++)p+=String.fromCharCode(e[a]);return p},ze.ZipLib.getNullTerminatedStringFromDataView=function(e,t){for(var r="",p=e.byteLength,o=null,n=t;n<p;n++){if(o=e.getUint8(n),0===o)return r;r+=String.fromCharCode(o)}return r},ze.ZipLib.blobToString=function(e,t,r,i,p){var o=null==t?0:t,n=null==r?e.size:r;ze.ZipLib.blobToByteArrayAsync(e,o,n,function(e){i(ze.ZipLib.getStringFromBytes(e))},p)},ze.ZipLib.blobToDataViewAsync=function(e,t,r,i,p){ze.ZipLib.blobToArrayLikeAsync(!0,e,t,r,i,p)},ze.ZipLib.blobToByteArrayAsync=function(e,t,r,i,p){ze.ZipLib.blobToArrayLikeAsync(!1,e,t,r,i,p)},ze.ZipLib.blobToArrayLikeAsync=function(t,r,i,p,o,n){var a=new FileReader;if(a.onload=function(r){var e=r.target.result;null==e&&(e=a.result),t?o(new DataView(e)):o(new Uint8Array(e))},a.onerror=function(){var e=a.error;n(e)},0==i&&p==r.size)a.readAsArrayBuffer(r);else{var s=r.slice(i,p);a.readAsArrayBuffer(s)}},ze.ZipLib.readHeaderMetadataFromEocdr=function(e,t,r,i){ze.ZipLib.blobToDataViewAsync(e,Math.max(0,e.size-ze.ZipLib.MAX_EOCDR_HEADER_SEEK_LEN),e.size,ze.ZipLib.bindFn(ze.ZipLib.readZipHeaderRecordMetadata_,null,r,i,t),i)},ze.ZipLib.readZipHeaderRecordMetadata_=function(e,t,r,p){if(p.byteLength<ze.ZipLib.EOCDR_SIZE)return void t(ze.ZipLib.ERR_HEADER_BAD_FORMAT+" - Data not large enough for EOCDR");for(var o=-1,n=p.byteLength-ze.ZipLib.EOCDR_SIZE;n<p.byteLength-4;n++)if(p.getUint32(n)==ze.ZipLib.EOCDR_SIGNATURE){o=n;break}var a=0;if(-1==o){var s=Math.max(0,p.byteLength-ze.ZipLib.MAX_EOCDR_HEADER_SEEK_LEN);for(a=s;a<p.byteLength-4;a++)if(p.getUint32(a)==ze.ZipLib.EOCDR_SIGNATURE){o=a;break}}if(-1==o)return void t(ze.ZipLib.ERR_HEADER_BAD_FORMAT+" - Did not find EOCDR signature");var E={};if(0<=o-ze.ZipLib.ZIP64_EOCDR_LOCATOR_SIZE){var d=p.getUint32(o-20);if(d==ze.ZipLib.ZIP_64_EOCDR_LOCATOR_SIGNATURE){E.isZip64=!0;var l=p.getUint32(o-8,!0);if(0<l)return void t(ze.ZipLib.ERR_HEADER_BAD_FORMAT+" - ZIP64 EOCDR Offset > Integer.MAX_VALUE, requires long.");var A=p.getUint32(o-12,!0),c=p.byteLength-(r-A);if(E.zip64Index=c,0>c)return void t(ze.ZipLib.ERR_HEADER_BAD_FORMAT+" - Not enough bytes to reverse-seek to ZIP64 EOCDR.");var T=p.getUint32(c);if(T!=ze.ZipLib.ZIP_64_EOCDR_SIGNATURE)return void t(ze.ZipLib.ERR_HEADER_BAD_FORMAT+" - Did not find ZIP64 EOCDR signature where expected.");var _=p.getUint32(c+4,!0),u=p.getUint32(c+8,!0);if(0<u)return void t(ze.ZipLib.ERR_HEADER_BAD_FORMAT+" - ZIP64 EocdrSize > Integer.MAX_VALUE, requires long.");E.zip64EocdrSize=_;var S=p.getUint32(c+24,!0),R=p.getUint32(c+28,!0);if(0<R)return void t(ze.ZipLib.ERR_HEADER_BAD_FORMAT+" - ZIP64 TotalEntriesOnDisk > Integer.MAX_VALUE, requires long.");E.zip64TotalEntriesOnDisk=S;var P=p.getUint32(c+32,!0),I=p.getUint32(c+36,!0);if(0<I)return void t(ze.ZipLib.ERR_HEADER_BAD_FORMAT+" - ZIP64 TotalEntriesInCd > Integer.MAX_VALUE, requires long.");E.zip64TotalEntriesInCd=P;var D=p.getUint32(c+40,!0),y=p.getUint32(c+44,!0);if(0<y)return void t(ze.ZipLib.ERR_HEADER_BAD_FORMAT+" - ZIP64 CdSize > Integer.MAX_VALUE, requires long.");E.zip64CdSize=D;var h=p.getUint32(c+48,!0),b=p.getUint32(c+52,!0);if(0<b)return void t(ze.ZipLib.ERR_HEADER_BAD_FORMAT+" - ZIP64 CdOffsetOfStart > Integer.MAX_VALUE, requires long.");E.zip64CdOffsetOfStart=h;var L=_-ze.ZipLib.ZIP64_EOCDR_FIXED_SIZE+12;E.zip64ExtensibleDataSectorSize=L}}else;var C=p.getUint16(o+8,!0);65535==C&&E.isZip64&&(C=E.zip64TotalEntriesInCd);var w=p.getUint32(o+12,!0);4294967295==w&&E.isZip64&&(w=E.zip64CdSize);var g=p.getUint32(o+16,!0);4294967295==g&&E.isZip64&&(g=E.zip64CdOffsetOfStart);var m=E.isZip64?E.zip64Index:o,O=p.byteLength-m,v=p.getUint16(o+20,!0),N="";0<v&&(N=ze.ZipLib.decodeStringFromDataView(p,o+22,v,!0)),E.numFiles=C,E.cdrAbsoluteOffset=g,E.cdrSize=w,E.eocdrStartDistanceFromEnd=O,E.zipFileComment=N,E.cdrStartDistanceFromEnd=O+w,e(E)},ze.ZipLib.readEntriesFromCentralDirectory=function(e,t,r,i){return t.size<e.cdrStartDistanceFromEnd?void i(ze.ZipLib.ERR_HEADER_READ+" - Tail blob size not large enough for CDR"):void ze.ZipLib.blobToDataViewAsync(t,t.size-e.cdrStartDistanceFromEnd,t.size,ze.ZipLib.bindFn(ze.ZipLib.doReadEntriesFromCdr_,null,r,i,e.numFiles,!!e.isZip64,e.encoding),i)},ze.ZipLib.doReadEntriesFromCdr_=function(e,t,r,i,p,o){for(var n=0,a=[],s=0;s<r;s++){if(o.getUint32(n)!=ze.ZipLib.ZIP_CENTRAL_DIRECTORY_HEADER_SIGNATURE)return void t(ze.ZipLib.ERR_HEADER_BAD_FORMAT+" - Expected Header Signature for this file's record");var E={};try{E=ze.ZipLib.generateEntryFromHeaderRecord_(o,n+4,i,p)}catch(e){E.error="Entry Parse Error from CDR: "+e,logImpression("entry_parse_error_cdr","zip",e)}null==E.compressionMethod||ze.ZipLib.isZipCompressionMethodSupported(E.compressionMethod)||(E.error="Unsupported ZIP compression method: "+E.compressionMethod,logImpression("entry_unsupported_compression_method","zip",E.compressionMethod)),ze.App.isSystemFile(E.filename,null,E.directory)||a.push(E),n+=ze.ZipLib.CENTRAL_DIRECTORY_HEADER_SIZE+E.filenameLength+E.extraFieldLength+E.commentLength}e(a)},ze.ZipLib.isZipCompressionMethodSupported=function(e){return!(e!=ze.ZipLib.COMPRESSION_MODE_DEFLATE&&e!=ze.ZipLib.COMPRESSION_MODE_STORE&&e!=ze.ZipLib.COMPRESSION_MODE_BZIP&&e!=ze.ZipLib.COMPRESSION_MODE_LZMA&&e!=ze.ZipLib.COMPRESSION_MODE_WINZIPENCRYPTED)},ze.ZipLib.generateEntryFromHeaderRecord_=function(e,t,r,p){var o={};o.type="zip",o.madeByVersion=e.getUint16(t,!0),o.version=e.getUint16(t+2,!0),o.bitFlag=e.getUint16(t+4,!0),o.compressionMethod=e.getUint16(t+6,!0),o.lastModDateRaw=e.getUint32(t+8,!0),o.lastModDate=ze.ZipLib.convertDate(o.lastModDateRaw),ze.ZipLib.populateEntryEncryptionDetails_(o);var n=!1,a=!1,s=!1;if(o.crc32=e.getUint32(t+12,!0),0===o.crc32&&(o.crc32=null),o.compressedSize=e.getUint32(t+16,!0),o.uncompressedSize=e.getUint32(t+20,!0),4294967295===o.uncompressedSize||4294967295===o.compressedSize){if(!r)return o.error="Entry uncompressedSize / compressedSize is 0xFFFFFFFF but ZIP is not in Zip64 format.",o;o.isZip64=!0,4294967295===o.uncompressedSize&&(a=!0),4294967295===o.compressedSize&&(n=!0)}o.filenameLength=e.getUint16(t+24,!0),o.extraFieldLength=e.getUint16(t+26,!0),o.commentLength=e.getUint16(t+28,!0),o.directory=16==(16&e.getUint8(t+34));var E=e.getUint32(t+38,!0);if(4294967295===E){if(!r)return o.error="Entry offset is 0xFFFFFFFF but ZIP is not in Zip64 format.",o;o.isZip64=!0,s=!0}o.offset=E;var d=t+42+o.filenameLength,l=ze.ZipLib.readExtraFields(e,d,o.extraFieldLength);if(r&&o.isZip64){var A=0;if(a&&(A+=8),n&&(A+=8),s&&(A+=8),0<A){if(!(ze.ZipLib.ZIP64_EXTENDED_INFO_EXTRA_FIELD_SIGNATURE in l))return o.error="Did not find ZIP64_EXTENDED_INFO_EXTRA_FIELD for this Zip64 entry.",o;var c=l[ze.ZipLib.ZIP64_EXTENDED_INFO_EXTRA_FIELD_SIGNATURE];if(c.dataSize<A)return o.error="Error: Expected Extra Field Length >= "+A+" for Zip64.",o;var T=c.dataStart;if(a){var _=e.getUint32(T,!0),u=e.getUint32(T+4,!0);if(0<u)return o.error="Error: ZIP64 Entry Uncompressed Size > Integer.MAX_VALUE, requires long.",o;o.uncompressedSize=_,T+=8}if(n){var S=e.getUint32(T,!0),R=e.getUint32(T+4,!0);if(0<R)return o.error="Error: ZIP64 Entry Compressed Size > Integer.MAX_VALUE, requires long.",o;o.compressedSize=S,T+=8}if(s){var P=e.getUint32(c.dataStart+16,!0),I=e.getUint32(c.dataStart+20,!0);if(0<I)return o.error="Error: ZIP64 Entry Offset > Integer.MAX_VALUE, requires long.",o;o.offset=P,T+=8}}}var D=!1,y=2048==(2048&o.bitFlag);if(ze.ZipLib.UNICODE_PATH_EXTRA_DATA_SIGNATURE in l){var h=l[ze.ZipLib.UNICODE_PATH_EXTRA_DATA_SIGNATURE],b=h.dataStart+ze.ZipLib.UNICODE_PATH_PREAMBLE_SIZE,L=h.dataSize-ze.ZipLib.UNICODE_PATH_PREAMBLE_SIZE;try{o.filename=ze.ZipLib.decodeStringFromDataView(e,b,L,!0,void 0),D=!0}catch(e){logImpression("unicode_path_extra_data_parse_error","zip","error: "+e)}}if(!D){var C=new Uint8Array(e.buffer,t+42,o.filenameLength),w=!1;if(!y){for(var g=!1,m=0;m<C.length;m++)if(127<C[m]){g=!0,o.filenameHasExtendedChar=!0;break}if(o.rawFilenameBytes=C,!g)w=!1,logImpression("no_language_encoding_flag_no_extended_char","encoding");else{var O=ze.ZipLib.isValidUtf8(C);w=O,logImpression("no_language_encoding_flag_has_extended_char","encoding","isValidUtf8: "+O)}}else w=!0,logImpression("utf8_language_encoding_flag_specified","encoding");o.filename=ze.ZipLib.decodeStringFromTypedArray(C,w,p)}if(o.directory||"/"!=o.filename.charAt(o.filename.length-1)||(o.directory=!0),o.comment=0<o.commentLength?ze.ZipLib.decodeStringFromDataView(e,t+42+o.filenameLength+o.extraFieldLength,o.commentLength,y,void 0):"",o.encryptionMode==ze.ZipLib.ENCRYPTION_MODE_WINZIPAES){if(!(ze.ZipLib.AES_EXTRA_DATA_SIGNATURE in l))return o.error="Error: Did not find AES Extra Data Record Extra Fields Map.",o;var v=l[ze.ZipLib.AES_EXTRA_DATA_SIGNATURE];if(v.dataSize<ze.ZipLib.AES_EXTRA_DATA_SIZE)return o.error="Error: Expected Extra Field Length >= 7 for AES encryption format.",o;try{var N=ze.ZipCrypt.Aes.readAesExtraDataRecord(e,v.dataStart,v.dataSize);null!=N&&(o.compressionMethod=N.compressionMethod,o.aesKeyStrengthBits=N.keyStrengthBits)}catch(e){return o.error="Error reading Encryption Data Record: "+e,o}}return o},ze.ZipLib.readExtraFields=function(e,t,r){var i={},p=t;for(null==r&&(r=0);p<t+r;){var o=e.getUint16(p,!0);p+=2;var n=e.getUint16(p,!0);p+=2;var a={dataStart:p,dataSize:n};p+=n,i[o]=a}return i},ze.ZipLib.ENCRYPTION_MODE_NONE="none",ze.ZipLib.ENCRYPTION_MODE_UNKNOWN="unknown",ze.ZipLib.ENCRYPTION_MODE_PKZIPSTANDARD="pkzipstandard",ze.ZipLib.ENCRYPTION_MODE_PKZIPSTRONG="pkzipstrong",ze.ZipLib.ENCRYPTION_MODE_WINZIPAES="winzipaes",ze.ZipLib.ENCRYPTION_MODE_PKZIPOTHER="pkzipother",ze.ZipLib.ENCRYPTION_MODE_ENCRYPTEDCDR="encryptedcdr",ze.ZipLib.populateEntryEncryptionDetails_=function(e){if(e.encryptionMode=ze.ZipLib.ENCRYPTION_MODE_NONE,e.isEncrypted=1==(1&e.bitFlag),e.hasEncryptedCdr=8192==(8192&e.bitFlag),e.isEncrypted)if(e.hasEncryptedCdr)e.encryptionMode=ze.ZipLib.ENCRYPTION_MODE_ENCRYPTEDCDR;else if(e.encryptionMode=ze.ZipLib.ENCRYPTION_MODE_UNKNOWN,e.compressionMethod==ze.ZipLib.COMPRESSION_MODE_WINZIPENCRYPTED)e.encryptionMode=ze.ZipLib.ENCRYPTION_MODE_WINZIPAES;else{var t=64==(64&e.bitFlag);e.encryptionMode=t?ze.ZipLib.ENCRYPTION_MODE_PKZIPSTRONG:10==e.version||20==e.version||788==e.version?ze.ZipLib.ENCRYPTION_MODE_PKZIPSTANDARD:e.compressionMethod==ze.ZipLib.COMPRESSION_MODE_BZIP||e.compressionMethod==ze.ZipLib.COMPRESSION_MODE_LZMA?ze.ZipLib.ENCRYPTION_MODE_PKZIPSTANDARD:ze.ZipLib.ENCRYPTION_MODE_PKZIPOTHER}},ze.ZipLib.decompressEntry=function(e,t,r,i,p,o,n){if("7z"==t.type)try{ze.SevenZLib.getDecodedBlobForEntry(t,i,p,o,n,!0)}catch(e){p("7z Entry Decompress Error: "+e)}else if("tar"==t.type){var a=null;try{a=e.slice(t.offset+ze.TarLib.TAR_HEADER_SIZE,t.offset+ze.TarLib.TAR_HEADER_SIZE+t.compressedSize),i(a)}catch(e){p("TAR Slice Error: "+e)}}else if("rar"==t.type){if(t.isEncrypted&&(null==n||0==n.length))return void p("RAR file is password protected but no password was provided");ze.ZipLib.blobToByteArrayAsync(e,0,e.size,function(e){ze.RarLib.decompressRarEntry("temprarfilename2.rar",e,t.filename,n,i,p,o)},p)}else if("bzip"==t.type)ze.ZipLib.blobToByteArrayAsync(e,0,e.size,function(e){ze.BzipLib.decompressBzipEntry(e,i,p,o)},p);else if("gzip"==t.type)ze.ZipLib.blobToDataViewAsync(e,t.offset,t.offset+t.compressedSize,function(e){ze.GzipLib.decompressGzipEntry(e,t.compressedSize,t.uncompressedSize,t.crc32,i,p,o)},p);else if("lzma"==t.type){var s=null==t.uncompressedSize?-1:t.uncompressedSize;ze.ZipLib.blobToByteArrayAsync(e,t.offset,t.offset+t.compressedSize,function(e){ze.LzmaLib.decompressLzmaEntry(e,s,t.decoderProperties,i,p,o)},p)}else if("zip"==t.type){if(t.isEncrypted&&(null==n||0==n.length))return void p(ze.ZipLib.ERR_INFLATION+" - ZIP file is password protected but no password was provided");var E=ze.ZipLib.LOCAL_FILE_HEADER_ENTRY_FIXED_SIZE_BYTES+t.compressedSize+65536+ze.ZipLib.ZIPCRYPTO_ENCRYPTION_HEADER_LENGTH;ze.ZipLib.decompressLocalFileBlob_(e.slice(t.offset,Math.min(t.offset+E,e.size)),t.compressedSize,t.uncompressedSize,t.bitFlag,r?t.crc32:null,t.compressionMethod,t.lastModDateRaw,t.encryptionMode,i,p,o,n,t.aesKeyStrengthBits)}},ze.ZipLib.decompressLocalFileBlob_=function(e,t,r,i,p,o,n,a,s,E,d,l,A){ze.ZipLib.blobToDataViewAsync(e,0,e.size,function(e){try{ze.ZipLib.decompressEntryData_(e,t,r,i,p,o,n,a,s,E,d,l,A)}catch(e){E("decompressEntryData_ error: "+e)}},E)},ze.ZipLib.decompressEntryData_=function(e,t,r,p,o,n,s,E,d,l,A,c,T){if(0==e.byteLength)return void l(ze.ZipLib.ERR_ENTRY_BAD_FORMAT+" - Empty Entry Data Payload in DataView");if(4>e.byteLength)return void l(ze.ZipLib.ERR_ENTRY_BAD_FORMAT+" - Not enough bytes in entry data payload for local file signature");if(e.getUint32(0)!=ze.ZipLib.ZIP_LOCAL_FILE_HEADER_SIGNATURE)return void l(ze.ZipLib.ERR_ENTRY_BAD_FORMAT+" - Did not find Local File Header signature for this entry");if(e.byteLength<ze.ZipLib.LOCAL_FILE_HEADER_ENTRY_FIXED_SIZE_BYTES)return void l(ze.ZipLib.ERR_ENTRY_BAD_FORMAT+" - Not enough bytes in entry data payload");var _=e.getUint16(26,!0),u=e.getUint16(28,!0),S=ze.ZipLib.LOCAL_FILE_HEADER_ENTRY_FIXED_SIZE_BYTES+_+u,R=1==(1&p),P=null;if(R&&E==ze.ZipLib.ENCRYPTION_MODE_PKZIPSTANDARD){if(null==c||0==c.length)return void l(ze.ZipLib.ERR_INFLATION+" - ZIP file is password protected but no password was provided");t-=ze.ZipLib.ZIPCRYPTO_ENCRYPTION_HEADER_LENGTH;try{var I=new Int8Array(e.buffer.slice(S,S+ze.ZipLib.ZIPCRYPTO_ENCRYPTION_HEADER_LENGTH));P=ze.ZipCrypt.deriveZipCryptoKeys(c,I)}catch(e){return void l(ze.ZipLib.ERR_INFLATION+" - "+e)}S+=ze.ZipLib.ZIPCRYPTO_ENCRYPTION_HEADER_LENGTH;for(var D=new Uint8Array(e.buffer),y=P.keys,h=S+t,b=2|y[2],L=S;L<h;L++)D[L]^=Math.imul(b,1^b)>>>8,y[0]=y[0]>>>8^CRC_TABLE2[255&(y[0]^D[L])],y[1]=Math.imul(y[1]+(255&y[0]),134775813)+1,y[2]=y[2]>>>8^CRC_TABLE2[255&(y[2]^y[1]>>24)],b=2|y[2];logImpression("decrypted_encrypted_entry","crypto")}else if(R&&E==ze.ZipLib.ENCRYPTION_MODE_WINZIPAES){if(null==c||0==c.length)return void l(ze.ZipLib.ERR_INFLATION+" - ZIP file is AES password protected but no password was provided");if(null==T)return void l(ze.ZipLib.ERR_INFLATION+" - ZIP file is AES password protected but AES Key Strength was not provided");if(S=ze.ZipLib.LOCAL_FILE_HEADER_ENTRY_FIXED_SIZE_BYTES+_+u,S+t>e.byteLength)return void l("Decryption error: Encrypted Preamble ("+(t+S)+") extends past dataView ("+e.byteLength+")");var C=T/16,w=new Uint8Array(e.buffer,S,C),g=S+C,m=new Uint8Array(e.buffer,g,ze.ZipCrypt.Aes.PASSWORD_VERIFIER_LENGTH),O=t-C-ze.ZipCrypt.Aes.PASSWORD_VERIFIER_LENGTH-ze.ZipCrypt.Aes.AUTHENTICATION_CODE_LENGTH;if(t=O,!ze.ZipLib.isZipCompressionMethodSupported(n))return void l("Decryption error: Unsupported compression method: "+n);var v=S+C+ze.ZipCrypt.Aes.PASSWORD_VERIFIER_LENGTH+O,N=new Uint8Array(e.buffer,v,ze.ZipCrypt.Aes.AUTHENTICATION_CODE_LENGTH),Z=T/8,B=Z,f=function(e){var t=new sjcl.misc.hmac(e,sjcl.hash.sha1);this.hasher=t,this.encrypt=function(){return t.encrypt.apply(t,arguments)},this.digest=function(){return t.digest.apply(t,arguments)},this.update=function(){return t.update.apply(t,arguments)}},F=Z+B+ze.ZipCrypt.Aes.PASSWORD_VERIFIER_LENGTH,z=sjcl.misc.pbkdf2(sjcl.codec.bytes.toBits(c),sjcl.codec.bytes.toBits(w),ze.ZipCrypt.Aes.PBKDF2_ITERATIONS,8*F,f),M=sjcl.codec.bytes.fromBits(z);if(M.length!=F)return void l("AES Decryption error: derivedKeyBytes length ("+M.length+") does not match expected ("+F+")");var U=M.slice(0,Z),x=M.slice(Z,Z+B),G=M.slice(Z+B,Z+B+ze.ZipCrypt.Aes.PASSWORD_VERIFIER_LENGTH);if(m[0]!=G[0]||m[1]!=G[1])return void l("Incorrect Password. Password did not match verification bytes.");for(var H=S+C+ze.ZipCrypt.Aes.PASSWORD_VERIFIER_LENGTH,Y=new Uint8Array(e.buffer,H,O),W=new f(sjcl.codec.bytes.toBits(x)),V=1,X=new Uint8Array(ze.ZipCrypt.Aes.AES_BLOCK_SIZE),K=new sjcl.cipher.aes(sjcl.codec.bytes.toBits(U)),Q=0;Q<O;Q+=ze.ZipCrypt.Aes.AES_BLOCK_SIZE){var q=Q+ze.ZipCrypt.Aes.AES_BLOCK_SIZE<=O?ze.ZipCrypt.Aes.AES_BLOCK_SIZE:O-Q,J=sjcl.codec.bytes.toBits(Y.slice(Q,Q+q));W.update(J),X[0]=V,X[1]=V>>8,X[2]=V>>16,X[3]=V>>24,X[4]=0,X[5]=0,X[6]=0,X[7]=0,X[8]=0,X[9]=0,X[10]=0,X[11]=0,X[12]=0,X[13]=0,X[14]=0,X[15]=0;var $=sjcl.codec.bytes.toBits(X),ee=sjcl.mode.ctr.decrypt(K,J,$),te=sjcl.codec.bytes.fromBits(ee);if(te.length!=q)return void l("Decryption error: decrypted block bytes length ("+te.length+") does not match expected loop block size ("+q+")");for(var re=0;re<q;re++)Y[Q+re]=te[re];V++}var ie=W.digest(),pe=sjcl.codec.bytes.fromBits(ie);if(!pe||pe.length<ze.ZipCrypt.Aes.AUTHENTICATION_CODE_LENGTH)return void l("Could not get minimum 10 bytes from final Mac digest to authenticate.");for(var oe=!0,ne=0;ne<ze.ZipCrypt.Aes.AUTHENTICATION_CODE_LENGTH;ne++)if(N[ne]!=pe[ne]){oe=!1;break}if(!oe)return void l("Message authentication code did not match. Password is invalid or ZIP file data has been corrupted.");S=H}if(n===ze.ZipLib.COMPRESSION_MODE_STORE)ze.ZipLib.copy(e,[],S,t,r,o,d,l,A,P);else if(n===ze.ZipLib.COMPRESSION_MODE_BZIP){var ae=new Uint8Array(e.buffer,S,t);ze.BzipLib.isBzipLzmaSevenZDecoderLibLoaded()?ze.BzipLib.decompressBzipEntry(ae,d,l,A):MAINAPP.loadScriptAsync(ze.BzipLib.BZIP_LZMA_SEVENZ_LIB_SCRIPT_NAME,function(){ze.BzipLib.decompressBzipEntry(ae,d,l,A)})}else if(n===ze.ZipLib.COMPRESSION_MODE_LZMA){var se=e.getUint16(S,!0),Ee=e.getUint16(S+2,!0);if(5!=Ee)return void l("ZIP file LZMA header properties size must be 5 bytes, but was "+Ee);var de=new Uint8Array(e.buffer,e.byteOffset+S+4,Ee),le=2==(2&p)?-1:r,Ae=0<t?t-4-Ee:-1;if(-1==Ae)return void l("ZIP file LZMA payload size was -1, because compressedSize was "+t);var ce=new Uint8Array(e.buffer,S+4+Ee,t-Ee);ze.BzipLib.isBzipLzmaSevenZDecoderLibLoaded()?ze.LzmaLib.decompressLzmaEntry(ce,le,de,d,l,A):MAINAPP.loadScriptAsync(ze.BzipLib.BZIP_LZMA_SEVENZ_LIB_SCRIPT_NAME,function(){ze.LzmaLib.decompressLzmaEntry(ce,le,de,d,l,A)})}else ze.ZipLib.inflate(new Worker(ze.ZipLib.INFLATE_JS),e,[],S,t,r,o,d,l,A,P)},ze.ZipLib.copy=function(e,t,r,i,p,o,n,a,s){for(var E=null==o?null:new ze.ZipLib.Crc32,d=0;d<i;){var l=r+d,A=Math.min(ze.ZipLib.INFLATE_CHUNK_SIZE,i-d),c=new Uint8Array(e.buffer,l,A);try{t.push(c),null!=o&&E.append(c)}catch(e){return void a(ze.ZipLib.ERR_WRITE_DATA+" - copy() - "+e)}d+=ze.ZipLib.INFLATE_CHUNK_SIZE,s&&s(Math.min(d,i),i)}var T=null==o?null:E.get();ze.ZipLib.checkCrcAndCallbackWithBlob(t,o,T,n,a)},ze.ZipLib.inflate=function(e,t,r,i,p,o,n,a,s,E,d){function l(t){var i=t.data;if(i.onflush&&A(i.crc32),i.progress&&E&&E(T+i.current,p,d),i.onappend){if(i.isError)return e.terminate(),void s(ze.ZipLib.ERR_INFLATION+" - "+i.errorMessage);if(null==i.data)return e.terminate(),void s(ze.ZipLib.ERR_INFLATION+" - Inflated data chunk was null");var a=i.data;u+=a.length;try{r.push(a)}catch(t){return e.terminate(),void s(ze.ZipLib.ERR_WRITE_DATA+" - inflate() - "+t)}c(o,null!=n),E&&E(Math.min(T,p),p,d)}}function A(t){e.removeEventListener(ze.ZipLib.INFLATE_MESSAGE_EVENT,l,!1),e.terminate(),ze.ZipLib.checkCrcAndCallbackWithBlob(r,n,t,a,s)}function c(r,o){if(T=_*ze.ZipLib.INFLATE_CHUNK_SIZE,T<=p){var n=i+T,a=Math.min(ze.ZipLib.INFLATE_CHUNK_SIZE,p-T),s=new Uint8Array(t.buffer.slice(n,n+a));e.postMessage({append:!0,computeCrc32:!!o,data:s},[s.buffer]),_++}else e.postMessage({flush:!0,computeCrc32:!!o})}var T=0,_=0,u=0;u=0,e.addEventListener(ze.ZipLib.INFLATE_MESSAGE_EVENT,l,!1);c(o,null!=n),E&&E(0,p,d)},ze.ZipLib.checkCrcAndCallbackWithBlob=function(e,t,r,i,p,o){if(null!=t){if(t!=r>>>0)return void p(ze.ZipLib.ERR_READ_DATA_CRC)}i(new Blob(e),o)},ze.ZipCrypt={},ze.ZipCrypt.ENCRYPTION_HEADER_LENGTH=12;for(var CRC_TABLE2=new Int32Array(256),i=0,r;256>i;i++){r=i;for(var j=0;8>j;j++)1==(1&r)?r=3988292384^r>>>1:r>>>=1;CRC_TABLE2[i]=r}ze.ZipCrypt.crc32=function(e,t){return e>>>8^CRC_TABLE2[255&(e^t)]},ze.ZipCrypt.update_keys_from_byte=function(e,t){return e[0]=ze.ZipCrypt.crc32(e[0],t),e[1]+=255&e[0],e[1]=Math.imul(e[1],134775813)+1,e[2]=ze.ZipCrypt.crc32(e[2],255&e[1]>>24),t},ze.ZipCrypt.deriveZipCryptoKeys=function(e,t){if(!(t&&t.length==ze.ZipCrypt.ENCRYPTION_HEADER_LENGTH))throw new Error("Encrypted Header must be 12 bytes long.");var r=new Int32Array(3);r[0]=305419896,r[1]=591751049,r[2]=878082192;for(var p=new Int8Array(1),o=0,n=0;n<e.length;n++)ze.ZipCrypt.update_keys_from_byte(r,e[n]),o=2|r[2],p[0]=Math.imul(o,1^o)>>>8;for(var a=new Int8Array(ze.ZipCrypt.ENCRYPTION_HEADER_LENGTH),s=0;s<ze.ZipCrypt.ENCRYPTION_HEADER_LENGTH;s++)a[s]=ze.ZipCrypt.update_keys_from_byte(r,t[s]^p[0]),o=2|r[2],p[0]=Math.imul(o,1^o)>>>8;return{keys:r,decryptorByte:p,passwordCheckByte:a[ze.ZipCrypt.ENCRYPTION_HEADER_LENGTH-1]}},ze.ZipCrypt.verifyPassword=function(e,t,r,i,p){var o=255&r>>8,n=255&t>>24;return p?e==o||e==n:e==(i?o:n)},ze.ZipCrypt.Aes={},ze.ZipCrypt.Aes.PASSWORD_VERIFIER_LENGTH=2,ze.ZipCrypt.Aes.AUTHENTICATION_CODE_LENGTH=10,ze.ZipCrypt.Aes.VENDOR_ID_SIGNATURE=17729,ze.ZipCrypt.Aes.EXTRA_DATA_RECORD_LENGTH=11,ze.ZipCrypt.Aes.AE1_SIGNATURE_BYTE=1,ze.ZipCrypt.Aes.AE2_SIGNATURE_BYTE=2,ze.ZipCrypt.Aes.ENCRYPTION_STRENGTH_128=1,ze.ZipCrypt.Aes.ENCRYPTION_STRENGTH_192=2,ze.ZipCrypt.Aes.ENCRYPTION_STRENGTH_256=3,ze.ZipCrypt.Aes.AES_BLOCK_SIZE=16,ze.ZipCrypt.Aes.PBKDF2_ITERATIONS=1e3,ze.ZipCrypt.Aes.readAesExtraDataRecord=function(e,t){var r={},i=e.getUint16(t,!0);r.vendorVersion=i,r.encryptionMode=i==ze.ZipCrypt.Aes.AE1_SIGNATURE_BYTE?"AE-1":i==ze.ZipCrypt.Aes.AE2_SIGNATURE_BYTE?"AE-2":"Unknown";var p=e.getUint16(t+2,!0);if(r.vendorId=p,p!=ze.ZipCrypt.Aes.VENDOR_ID_SIGNATURE)throw new Error("Expected \"AE\" for Vendor ID, instead found: "+p);var o=e.getUint8(t+4,!0);if(r.encryptionStrengthMode=o,r.keyStrengthBits=o==ze.ZipCrypt.Aes.ENCRYPTION_STRENGTH_128?128:o==ze.ZipCrypt.Aes.ENCRYPTION_STRENGTH_192?192:o==ze.ZipCrypt.Aes.ENCRYPTION_STRENGTH_256?256:-1,-1==r.keyStrengthBits)throw new Error("Invalid AES Encryption Strength: "+r.keyStrengthBits+" ("+r.encryptionStrengthMode+")");return r.compressionMethod=e.getUint16(t+5,!0),r};var winOpen=window.open;window.open=function(){try{if(arguments&&2<arguments.length){var e=arguments[2];if(null!=e){var t=window.screen.width,r=window.screen.height,i="height=",p=e.indexOf(i),o=e.indexOf(",",p);if(-1!=p&&-1!=o){var n=parseInt(e.substring(p+i.length,o)),a=Math.round(Math.min(660,r));e=e.substring(0,p+i.length)+a+e.substring(o);var s=e.indexOf("top="),E=e.indexOf(",",s);if(-1!=s&&-1!=E){var d=parseInt(e.substring(s+"top=".length,E));e=e.substring(0,s+"top=".length)+(d-(a-n)/2)+e.substring(E)}arguments[2]=e}}}}catch(e){logImpression("window_open_height_update_err","app_load",e)}var l=winOpen.apply(this,arguments);try{var A=arguments&&1<arguments.length?arguments[1]:null;A&&A.indexOf&&-1!=A.indexOf("authPopup")&&(authWindowMap[A]=l,authWindowMap.last=l,authWindowList.push(l))}catch(e){logImpression("window_open_overload_err","app_load",e)}return l};